const _0x37471e=_0x11fc;(function(_0x533ab1,_0x201ccf){const _0x4e4a9b=_0x11fc,_0x3f54be=_0x533ab1();while(!![]){try{const _0x266ada=-parseInt(_0x4e4a9b(0x13e))/0x1+-parseInt(_0x4e4a9b(0x130))/0x2+parseInt(_0x4e4a9b(0x10a))/0x3*(parseInt(_0x4e4a9b(0xe2))/0x4)+-parseInt(_0x4e4a9b(0xe6))/0x5+-parseInt(_0x4e4a9b(0x114))/0x6*(parseInt(_0x4e4a9b(0xe1))/0x7)+parseInt(_0x4e4a9b(0xef))/0x8+parseInt(_0x4e4a9b(0x13d))/0x9*(parseInt(_0x4e4a9b(0x119))/0xa);if(_0x266ada===_0x201ccf)break;else _0x3f54be['push'](_0x3f54be['shift']());}catch(_0x24303c){_0x3f54be['push'](_0x3f54be['shift']());}}}(_0x3dfe,0x512f6));function _0x3dfe(){const _0x51f1e5=['.js','📂\x20La\x20base\x20de\x20datos\x20EDPLUS\x20ya\x20existe,\x20no\x20se\x20creó\x20nuevamente.','networkInterfaces','privateNotifications','17700670rGuadR','0.0.0.0','userId','connection','success','./router/links','getAllTheOrders','dotenv','database','connect-flash','map','pack_company','message','extname','push','internal','release','public/img/uploads','socket.io','query','\x27.\x20Inténtalo\x20de\x20nuevo.\x20😳','CREATE\x20DATABASE\x20edplus','json','286144NEPbni','user','image','messageStatus','connectionRejected','SELECT\x201\x20FROM\x20pg_database\x20WHERE\x20datname\x20=\x20\x27edplus\x27','saveANewOrder','sendAllTheOrders','\x27\x20no\x20existe.\x20🤔','readdirSync','address','Un\x20usuario\x20se\x20ha\x20conectado','get_max_employee_of_this_company','9wdqorU','474645dCwpjF','main','broadcast','./lib/system','views','✅\x20SQL\x20ejecutado\x20correctamente','connect','multer','./lib/addFrom','engine','statSync','morgan','http','/links','dev','split','router/links','\x27\x20no\x20existe\x20🤔','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27','Este\x20email\x20\x27','❌\x20Error\x20ejecutando\x20SQL:','PORT','./lib/handlebars','static','filter','get','privateMessage','single','getTheFirstTenNotifications','express-handlebars','express-session','./keys','rowCount','disconnect','this_email_exist','passport','Server\x20running\x20on\x20port\x20','desktop','FudSession','view\x20engine','Pool','express-recaptcha','./router/authentication','originalname','company','utf8','create_new_chat','emit','env','891583FUWFLU','622072nRzAKP','readFileSync','Nueva\x20notificación:','use','1953305ynkgvT','\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.','sendMessageToUser','127.0.0.1','createServer','config','data','urlencoded','./lib/passport','417376JhPzPP','El\x20usuario\x20\x27','Server\x20running\x20on\x20http://','port','layouts','trim','join','public','length','.hbs','set','node-persist','isFile','locals','postgres','pack_branch','error','get_the_first_notification','family','edplus.sql','endsWith','./router','session','newNotification','log','initialize','Socket\x20','3eqYhoQ','connect-pg-simple','./lib/editFrom','Ups,\x20parece\x20que\x20ya\x20estás\x20conectado\x20en\x20otro\x20dispositivo.','flash','init','listen','sendNotification','forEach','parse','30dHGCTx'];_0x3dfe=function(){return _0x51f1e5;};return _0x3dfe();}const system=require(_0x37471e(0x141)),express=require('express'),morgan=require(_0x37471e(0x149)),{engine}=require(_0x37471e(0xcd)),multer=require(_0x37471e(0x145)),flash=require(_0x37471e(0x122)),session=require(_0x37471e(0xce)),passport=require(_0x37471e(0xd3)),{database}=require(_0x37471e(0xcf)),{v4:uuid}=require('uuid'),path=require('path'),{RecaptchaV2}=require(_0x37471e(0xd9)),nodePersist=require(_0x37471e(0xfa));nodePersist[_0x37471e(0x10f)]({'dir':path[_0x37471e(0xf5)](__dirname,_0x37471e(0xec))});const serverExpress=express();require(_0x37471e(0xee)),require(_0x37471e(0x10c)),serverExpress['set'](_0x37471e(0xf2),process[_0x37471e(0xe0)][_0x37471e(0xc5)]||0xfa0),serverExpress[_0x37471e(0xf9)](_0x37471e(0x142),path[_0x37471e(0xf5)](__dirname,_0x37471e(0x142))),serverExpress[_0x37471e(0x147)](_0x37471e(0xf8),engine({'defaultLayout':_0x37471e(0x13f),'layoutsDir':path[_0x37471e(0xf5)](serverExpress['get'](_0x37471e(0x142)),_0x37471e(0xf3)),'partialsDir':path[_0x37471e(0xf5)](serverExpress['get'](_0x37471e(0x142)),'partials'),'extname':_0x37471e(0xf8),'helpers':require(_0x37471e(0xc6))})),serverExpress[_0x37471e(0xf9)](_0x37471e(0xd7),'.hbs'),require(_0x37471e(0x120))[_0x37471e(0xeb)]();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process[_0x37471e(0xe0)],pg=require('pg'),fs=require('fs'),adminPool=new pg[(_0x37471e(0xd8))]({'user':APP_PG_USER,'host':APP_PG_HOST,'password':APP_PG_PASSWORD,'port':APP_PG_PORT,'database':_0x37471e(0xfd)}),importSQLFile=async _0x5b11f9=>{const _0x4b3d64=_0x37471e,_0x17a65f=path[_0x4b3d64(0xf5)](__dirname,_0x4b3d64(0x121),_0x4b3d64(0x102)),_0x3b6889=fs[_0x4b3d64(0xe3)](_0x17a65f,_0x4b3d64(0xdd)),_0x10c642=_0x3b6889[_0x4b3d64(0x14d)](/;\s*$/m)[_0x4b3d64(0x123)](_0x36bf5c=>_0x36bf5c[_0x4b3d64(0xf4)]())[_0x4b3d64(0xc8)](_0x520764=>_0x520764[_0x4b3d64(0xf7)]>0x0),_0x1b9fd8=await _0x5b11f9[_0x4b3d64(0x144)]();try{for(const _0x2f2614 of _0x10c642){await _0x1b9fd8[_0x4b3d64(0x12c)](_0x2f2614);}console[_0x4b3d64(0x107)](_0x4b3d64(0x143));}catch(_0x591d25){console[_0x4b3d64(0xff)](_0x4b3d64(0xc4),_0x591d25[_0x4b3d64(0x125)]);}finally{_0x1b9fd8[_0x4b3d64(0x129)]();}},createDatabase=async()=>{const _0x3b2a38=_0x37471e,_0x2c3bb6=await adminPool[_0x3b2a38(0x12c)](_0x3b2a38(0x135));_0x2c3bb6[_0x3b2a38(0xd0)]===0x0?(await adminPool['query'](_0x3b2a38(0x12e)),importSQLFile(adminPool),console[_0x3b2a38(0x107)]('📦\x20Base\x20de\x20datos\x20EDPLUS\x20creada')):console[_0x3b2a38(0x107)](_0x3b2a38(0x116));};createDatabase();const pgPool=new pg[(_0x37471e(0xd8))]({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress[_0x37471e(0xe5)](session({'secret':_0x37471e(0xd6),'resave':![],'saveUninitialized':![],'store':new(require(_0x37471e(0x10b))(session))({'pool':pgPool,'tableName':_0x37471e(0x105)})})),serverExpress[_0x37471e(0xe5)](flash()),serverExpress[_0x37471e(0xe5)](morgan(_0x37471e(0x14c))),serverExpress[_0x37471e(0xe5)](express[_0x37471e(0xed)]({'extended':![]})),serverExpress[_0x37471e(0xe5)](express[_0x37471e(0x12f)]()),serverExpress['use'](passport[_0x37471e(0x108)]()),serverExpress[_0x37471e(0xe5)](passport[_0x37471e(0x105)]());const storageImages=multer['diskStorage']({'destination':path['join'](__dirname,_0x37471e(0x12a)),'filename':(_0x1a2f6f,_0x481eaa,_0x23fad5)=>{const _0xe32772=_0x37471e;_0x23fad5(null,uuid()+path[_0xe32772(0x126)](_0x481eaa[_0xe32772(0xdb)]));}});serverExpress['use'](multer({'storage':storageImages})[_0x37471e(0xcb)](_0x37471e(0x132))),serverExpress['use']((_0x504b64,_0x35b9d6,_0x3648e7)=>{const _0x4318db=_0x37471e;serverExpress['locals']['success']=_0x504b64['flash'](_0x4318db(0x11d)),serverExpress[_0x4318db(0xfc)][_0x4318db(0x125)]=_0x504b64[_0x4318db(0x10e)](_0x4318db(0x125)),serverExpress[_0x4318db(0xfc)][_0x4318db(0x131)]=_0x504b64[_0x4318db(0x131)],serverExpress['locals'][_0x4318db(0xdc)]=_0x504b64['company'],serverExpress[_0x4318db(0xfc)][_0x4318db(0x124)]=0x0,serverExpress[_0x4318db(0xfc)][_0x4318db(0xfe)]=0x0,_0x3648e7();});const http=require(_0x37471e(0x14a)),serverSocket=http[_0x37471e(0xea)](serverExpress),{Server}=require(_0x37471e(0x12b)),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require('./services/chat.js');serverSocket[_0x37471e(0x110)](serverExpress['get'](_0x37471e(0xf2)),()=>{const _0x25409c=_0x37471e;console[_0x25409c(0x107)](_0x25409c(0xd4)+serverExpress[_0x25409c(0xc9)](_0x25409c(0xf2)));}),io['on'](_0x37471e(0x11c),async _0x1a5548=>{const _0x217c7a=_0x37471e;console[_0x217c7a(0x107)](_0x217c7a(0x13b)),_0x1a5548['on']('registerUser',async(_0x5d4443,_0x57a054)=>{const _0x5a0944=_0x217c7a,_0x163ee7=connectedEmployees[_0x57a054]||[],_0x3baf1d=_0x163ee7['some'](_0x4ed6db=>_0x4ed6db[_0x5a0944(0x11b)]===_0x5d4443);if(_0x3baf1d){_0x1a5548[_0x5a0944(0xdf)](_0x5a0944(0x134),_0x5a0944(0x10d));return;}if(system!=_0x5a0944(0xd5)){!companyLimitsCache[_0x57a054]&&(companyLimitsCache[_0x57a054]=await chat[_0x5a0944(0x13c)](_0x57a054));const _0x5dc131=companyLimitsCache[_0x57a054];if(_0x163ee7[_0x5a0944(0xf7)]>=_0x5dc131){_0x1a5548[_0x5a0944(0xdf)](_0x5a0944(0x134),'Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20límite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresía.');return;}}_0x1a5548['companyId']=_0x57a054,_0x163ee7[_0x5a0944(0x127)]({'userId':_0x5d4443,'socketId':_0x1a5548['id']}),connectedEmployees[_0x57a054]=_0x163ee7;const _0x574dd8=await chat[_0x5a0944(0x100)](_0x5d4443,0xa);io['to'](_0x5d4443)[_0x5a0944(0xdf)](_0x5a0944(0x118),{'notifications':_0x574dd8});});async function _0x3a1565(_0x275779){const _0x470c2f=_0x217c7a,_0x1bbc02=users[_0x275779];let _0x5ba279=_0x1bbc02;!_0x1bbc02&&(_0x5ba279=await chat[_0x470c2f(0xd2)](toUserId));const _0x3dc730={'canSend':_0x5ba279,'theUserIsConnect':_0x1bbc02};return _0x3dc730;}_0x1a5548['on']('sendNotificationToUser',async({userEmail:_0x18c182,toUserEmail:_0x402817,message:_0x52425f})=>{const _0x4fb92a=_0x217c7a,_0x150243=await _0x3a1565(_0x402817);_0x150243['canSend']?await chat['create_notification'](_0x18c182,_0x402817,_0x52425f)?(_0x150243['theUserIsConnect']&&io['to'](recipientSocketId)[_0x4fb92a(0xdf)]('privateMessage',{'userId':userId,'message':_0x52425f}),_0x1a5548[_0x4fb92a(0xdf)](_0x4fb92a(0x133),{'success':!![],'message':'Mensaje\x20enviado\x20con\x20éxito.\x20👌'})):_0x1a5548[_0x4fb92a(0xdf)](_0x4fb92a(0x133),{'success':![],'message':_0x4fb92a(0xc2)+_0x402817+_0x4fb92a(0x12d)}):_0x1a5548[_0x4fb92a(0xdf)](_0x4fb92a(0x133),{'success':![],'message':_0x4fb92a(0xf0)+_0x402817+_0x4fb92a(0x138)});}),_0x1a5548['on'](_0x217c7a(0xcc),async({userEmail:_0x106ebe})=>{const _0x5a0e4f=_0x217c7a,_0x3eb926=await chat[_0x5a0e4f(0x100)](_0x106ebe,0xa);io['to'](recipientSocketId)['emit'](_0x5a0e4f(0x118),{'notifications':_0x3eb926});}),_0x1a5548['on'](_0x217c7a(0xe8),async({userId:_0x599e69,toUserId:_0x5df3cc,message:_0xb3f441})=>{const _0x385c4d=_0x217c7a,_0x14fba1=users[_0x5df3cc];let _0x17f37e=_0x14fba1;!_0x14fba1&&(_0x17f37e=await chat[_0x385c4d(0xd2)](_0x5df3cc));if(_0x17f37e){const _0x190296=await chat[_0x385c4d(0xde)](_0x599e69,_0x5df3cc);await chat['send_new_message'](_0x190296,_0x599e69,_0xb3f441)&&(_0x14fba1&&io['to'](_0x14fba1)[_0x385c4d(0xdf)](_0x385c4d(0xca),{'userId':_0x599e69,'message':_0xb3f441})),_0x1a5548[_0x385c4d(0xdf)](_0x385c4d(0x133),{'success':!![],'message':'Mensaje\x20enviado\x20con\x20éxito'});}else _0x1a5548[_0x385c4d(0xdf)]('messageStatus',{'success':![],'message':_0x385c4d(0xc3)+_0x5df3cc+_0x385c4d(0xc1)});}),_0x1a5548['on'](_0x217c7a(0xd1),()=>{const _0x43fd59=_0x217c7a,{companyId:_0x2fd921}=_0x1a5548;_0x2fd921&&connectedEmployees[_0x2fd921]?(connectedEmployees[_0x2fd921]=connectedEmployees[_0x2fd921][_0x43fd59(0xc8)](_0x31f07c=>_0x31f07c['socketId']!==_0x1a5548['id']),connectedEmployees[_0x2fd921][_0x43fd59(0xf7)]===0x0&&delete connectedEmployees[_0x2fd921]):console[_0x43fd59(0x107)](_0x43fd59(0x109)+_0x1a5548['id']+_0x43fd59(0xe7));}),_0x1a5548['on'](_0x217c7a(0x111),_0xb0693c=>{const _0x9284ad=_0x217c7a;console['log'](_0x9284ad(0xe4),_0xb0693c),_0x1a5548[_0x9284ad(0x140)][_0x9284ad(0xdf)](_0x9284ad(0x106),_0xb0693c);}),_0x1a5548['on'](_0x217c7a(0x137),_0x256f09=>{const _0x42ab54=_0x217c7a;_0x1a5548[_0x42ab54(0xdf)](_0x42ab54(0x11f),{'orderKitchen':orderKitchen});}),_0x1a5548['on'](_0x217c7a(0x136),_0x36d046=>{const _0x406ad3=_0x217c7a,_0x3f99a3=JSON[_0x406ad3(0x113)](_0x36d046);_0x3f99a3['id']=orderKitchen[_0x406ad3(0xf7)]+0x1,orderKitchen['push'](_0x3f99a3);});});const companyName=_0x37471e(0x14b);serverExpress[_0x37471e(0xe5)](require(_0x37471e(0x104))),serverExpress[_0x37471e(0xe5)](require(_0x37471e(0xda))),serverExpress['use'](companyName,require(_0x37471e(0x11e)));function _0x11fc(_0x1c0f01,_0x5230fc){const _0x3dfefd=_0x3dfe();return _0x11fc=function(_0x11fc0c,_0x2cb65){_0x11fc0c=_0x11fc0c-0xc1;let _0xc02e71=_0x3dfefd[_0x11fc0c];return _0xc02e71;},_0x11fc(_0x1c0f01,_0x5230fc);}const routesPath=path[_0x37471e(0xf5)](__dirname,_0x37471e(0x14e));fs[_0x37471e(0x139)](routesPath)[_0x37471e(0x112)](_0x12c10d=>{const _0x904a07=_0x37471e,_0x2bc7e8=path[_0x904a07(0xf5)](routesPath,_0x12c10d);fs[_0x904a07(0x148)](_0x2bc7e8)[_0x904a07(0xfb)]()&&_0x12c10d[_0x904a07(0x103)](_0x904a07(0x115))&&serverExpress[_0x904a07(0xe5)](companyName,require(_0x2bc7e8));}),serverExpress[_0x37471e(0xe5)](require(_0x37471e(0x146))),serverExpress['use'](express[_0x37471e(0xc7)](path[_0x37471e(0xf5)](__dirname,_0x37471e(0xf6))));const os=require('os');function getLocalIP(){const _0xea732d=_0x37471e,_0x13a020=os[_0xea732d(0x117)]();for(let _0x5b4877 in _0x13a020){for(let _0x5f16ca=0x0;_0x5f16ca<_0x13a020[_0x5b4877][_0xea732d(0xf7)];_0x5f16ca++){const _0x20cf9f=_0x13a020[_0x5b4877][_0x5f16ca];if(_0x20cf9f[_0xea732d(0x101)]==='IPv4'&&!_0x20cf9f[_0xea732d(0x128)])return _0x20cf9f[_0xea732d(0x13a)];}}return _0xea732d(0xe9);}serverExpress[_0x37471e(0x110)](serverExpress[_0x37471e(0xc9)](_0x37471e(0xf2)),_0x37471e(0x11a),()=>{const _0x4cb1f6=_0x37471e;console['log'](_0x4cb1f6(0xf1)+getLocalIP()+':'+serverExpress[_0x4cb1f6(0xc9)]('port'));});