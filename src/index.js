const _0x5c50ed=_0x1fd0;(function(_0x43b9de,_0x138a79){const _0x10fa96=_0x1fd0,_0x10ae12=_0x43b9de();while(!![]){try{const _0x26defe=-parseInt(_0x10fa96(0x1b3))/0x1+parseInt(_0x10fa96(0x191))/0x2+parseInt(_0x10fa96(0x176))/0x3+parseInt(_0x10fa96(0x1b2))/0x4*(parseInt(_0x10fa96(0x185))/0x5)+-parseInt(_0x10fa96(0x16e))/0x6+parseInt(_0x10fa96(0x17a))/0x7*(parseInt(_0x10fa96(0x196))/0x8)+-parseInt(_0x10fa96(0x154))/0x9*(parseInt(_0x10fa96(0x194))/0xa);if(_0x26defe===_0x138a79)break;else _0x10ae12['push'](_0x10ae12['shift']());}catch(_0x4eabaf){_0x10ae12['push'](_0x10ae12['shift']());}}}(_0x509b,0x2c4c8));const system=require(_0x5c50ed(0x1a0)),express=require(_0x5c50ed(0x19f)),morgan=require(_0x5c50ed(0x190)),{engine}=require('express-handlebars'),multer=require(_0x5c50ed(0x15c)),flash=require('connect-flash'),session=require(_0x5c50ed(0x175)),passport=require(_0x5c50ed(0x195)),{database}=require(_0x5c50ed(0x19d)),{v4:uuid}=require(_0x5c50ed(0x150)),path=require(_0x5c50ed(0x14a)),{RecaptchaV2}=require(_0x5c50ed(0x181)),nodePersist=require(_0x5c50ed(0x1ab));nodePersist[_0x5c50ed(0x14e)]({'dir':path['join'](__dirname,_0x5c50ed(0x16b))});const serverExpress=express();function _0x1fd0(_0x4b908d,_0x4000ee){const _0x509be9=_0x509b();return _0x1fd0=function(_0x1fd05f,_0x3981db){_0x1fd05f=_0x1fd05f-0x142;let _0x305487=_0x509be9[_0x1fd05f];return _0x305487;},_0x1fd0(_0x4b908d,_0x4000ee);}require(_0x5c50ed(0x158)),require('./lib/editFrom'),serverExpress[_0x5c50ed(0x189)](_0x5c50ed(0x15b),process[_0x5c50ed(0x171)][_0x5c50ed(0x144)]||0xfa0),serverExpress['set'](_0x5c50ed(0x147),path[_0x5c50ed(0x1b5)](__dirname,'views')),serverExpress['engine']('.hbs',engine({'defaultLayout':_0x5c50ed(0x188),'layoutsDir':path[_0x5c50ed(0x1b5)](serverExpress[_0x5c50ed(0x1b0)](_0x5c50ed(0x147)),_0x5c50ed(0x186)),'partialsDir':path[_0x5c50ed(0x1b5)](serverExpress['get'](_0x5c50ed(0x147)),_0x5c50ed(0x155)),'extname':_0x5c50ed(0x16f),'helpers':require(_0x5c50ed(0x153))})),serverExpress[_0x5c50ed(0x189)](_0x5c50ed(0x1a6),'.hbs'),require(_0x5c50ed(0x1a1))[_0x5c50ed(0x179)]();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process['env'],pg=require('pg'),fs=require('fs'),adminPool=new pg[(_0x5c50ed(0x157))]({'user':APP_PG_USER,'host':APP_PG_HOST,'password':APP_PG_PASSWORD,'port':APP_PG_PORT,'database':_0x5c50ed(0x19e)}),importSQLFile=async _0x4a2bd0=>{const _0x1f417f=_0x5c50ed,_0x3efe8e=path['join'](__dirname,_0x1f417f(0x180),'edplus.sql'),_0x4f3375=fs[_0x1f417f(0x1be)](_0x3efe8e,_0x1f417f(0x198)),_0x2e1ea2=_0x4f3375['split'](/;\s*$/m)['map'](_0x2cf887=>_0x2cf887[_0x1f417f(0x1a5)]())[_0x1f417f(0x1b1)](_0x3fda08=>_0x3fda08[_0x1f417f(0x1aa)]>0x0),_0x37de91=await _0x4a2bd0[_0x1f417f(0x193)]();try{for(const _0x4bc133 of _0x2e1ea2){await _0x37de91[_0x1f417f(0x1ad)](_0x4bc133);}console[_0x1f417f(0x159)](_0x1f417f(0x1ae));}catch(_0x309988){console[_0x1f417f(0x18c)](_0x1f417f(0x183),_0x309988[_0x1f417f(0x161)]);}finally{_0x37de91[_0x1f417f(0x149)]();}},createDatabase=async()=>{const _0x365040=_0x5c50ed,_0x3c809d=await adminPool[_0x365040(0x1ad)](_0x365040(0x1c2));_0x3c809d['rowCount']===0x0?(await adminPool[_0x365040(0x1ad)](_0x365040(0x156)),importSQLFile(adminPool),console[_0x365040(0x159)](_0x365040(0x18a))):console[_0x365040(0x159)](_0x365040(0x19b));};createDatabase();const pgPool=new pg[(_0x5c50ed(0x157))]({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress[_0x5c50ed(0x18d)](session({'secret':_0x5c50ed(0x1b4),'resave':![],'saveUninitialized':![],'store':new(require(_0x5c50ed(0x192))(session))({'pool':pgPool,'tableName':_0x5c50ed(0x18e)})})),serverExpress[_0x5c50ed(0x18d)](flash()),serverExpress['use'](morgan(_0x5c50ed(0x15f))),serverExpress['use'](express[_0x5c50ed(0x162)]({'extended':![]})),serverExpress[_0x5c50ed(0x18d)](express[_0x5c50ed(0x163)]()),serverExpress[_0x5c50ed(0x18d)](passport[_0x5c50ed(0x1a3)]()),serverExpress[_0x5c50ed(0x18d)](passport[_0x5c50ed(0x18e)]());const storageImages=multer[_0x5c50ed(0x1a2)]({'destination':path[_0x5c50ed(0x1b5)](__dirname,_0x5c50ed(0x172)),'filename':(_0x3c7420,_0x324331,_0x868a1b)=>{const _0x9c5edc=_0x5c50ed;_0x868a1b(null,uuid()+path[_0x9c5edc(0x177)](_0x324331[_0x9c5edc(0x14c)]));}});function _0x509b(){const _0x27a0e4=['env','public/img/uploads','address','Server\x20running\x20on\x20port\x20','express-session','661494Fvalxh','extname','Socket\x20','config','21TbCdnP','privateMessage','broadcast','\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.','Server\x20running\x20on\x20http://','0.0.0.0','database','express-recaptcha','./router/links','❌\x20Error\x20ejecutando\x20SQL:','\x27.\x20Inténtalo\x20de\x20nuevo.\x20😳','9015wUAlSQ','layouts','Este\x20email\x20\x27','main','set','📦\x20Base\x20de\x20datos\x20EDPLUS\x20creada','router/links','error','use','session','userId','morgan','356822nOUtxO','connect-pg-simple','connect','1431410QyuOun','passport','587288ljPOHd','registerUser','utf8','networkInterfaces','IPv4','📂\x20La\x20base\x20de\x20datos\x20EDPLUS\x20ya\x20existe,\x20no\x20se\x20creó\x20nuevamente.','listen','./keys','postgres','express','./lib/system','dotenv','diskStorage','initialize','isFile','trim','view\x20engine','image','emit','sendNotificationToUser','length','node-persist','Nueva\x20notificación:','query','✅\x20SQL\x20ejecutado\x20correctamente','endsWith','get','filter','604RLyLhD','214609yNmrzX','FudSession','join','static','get_the_first_notification','.js','El\x20usuario\x20\x27','privateNotifications','./lib/addFrom','push','Mensaje\x20enviado\x20con\x20éxito.\x20👌','readFileSync','Un\x20usuario\x20se\x20ha\x20conectado','public','socketId','SELECT\x201\x20FROM\x20pg_database\x20WHERE\x20datname\x20=\x20\x27edplus\x27','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27','connectionRejected','send_new_message','PORT','Ups,\x20parece\x20que\x20ya\x20estás\x20conectado\x20en\x20otro\x20dispositivo.','canSend','views','desktop','release','path','locals','originalname','messageStatus','init','127.0.0.1','uuid','flash','success','./lib/handlebars','9AWKrxD','partials','CREATE\x20DATABASE\x20edplus','Pool','./lib/passport','log','sendMessageToUser','port','multer','Mensaje\x20enviado\x20con\x20éxito','\x27\x20no\x20existe.\x20🤔','dev','getTheFirstTenNotifications','message','urlencoded','json','family','connection','user','http','pack_company','createServer','theUserIsConnect','data','some','company','2113182MAIBjm','.hbs','single'];_0x509b=function(){return _0x27a0e4;};return _0x509b();}serverExpress[_0x5c50ed(0x18d)](multer({'storage':storageImages})[_0x5c50ed(0x170)](_0x5c50ed(0x1a7))),serverExpress[_0x5c50ed(0x18d)]((_0x509f7e,_0x14a9c9,_0x4efc04)=>{const _0x3c8400=_0x5c50ed;serverExpress[_0x3c8400(0x14b)]['success']=_0x509f7e[_0x3c8400(0x151)](_0x3c8400(0x152)),serverExpress[_0x3c8400(0x14b)][_0x3c8400(0x161)]=_0x509f7e[_0x3c8400(0x151)](_0x3c8400(0x161)),serverExpress[_0x3c8400(0x14b)][_0x3c8400(0x166)]=_0x509f7e[_0x3c8400(0x166)],serverExpress[_0x3c8400(0x14b)][_0x3c8400(0x16d)]=_0x509f7e[_0x3c8400(0x16d)],serverExpress[_0x3c8400(0x14b)][_0x3c8400(0x168)]=0x0,serverExpress[_0x3c8400(0x14b)]['pack_branch']=0x0,_0x4efc04();});const http=require(_0x5c50ed(0x167)),serverSocket=http[_0x5c50ed(0x169)](serverExpress),{Server}=require('socket.io'),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require('./services/chat.js');serverSocket[_0x5c50ed(0x19c)](serverExpress[_0x5c50ed(0x1b0)](_0x5c50ed(0x15b)),()=>{const _0x5028ef=_0x5c50ed;console[_0x5028ef(0x159)](_0x5028ef(0x174)+serverExpress[_0x5028ef(0x1b0)]('port'));}),io['on'](_0x5c50ed(0x165),async _0x1bf747=>{const _0x402057=_0x5c50ed;console[_0x402057(0x159)](_0x402057(0x1bf)),_0x1bf747['on'](_0x402057(0x197),async(_0x1203cb,_0x28d05b)=>{const _0x4ffb1b=_0x402057,_0x1e84c5=connectedEmployees[_0x28d05b]||[],_0x360402=_0x1e84c5[_0x4ffb1b(0x16c)](_0x4b6a10=>_0x4b6a10[_0x4ffb1b(0x18f)]===_0x1203cb);if(_0x360402){_0x1bf747[_0x4ffb1b(0x1a8)](_0x4ffb1b(0x142),_0x4ffb1b(0x145));return;}if(system!=_0x4ffb1b(0x148)){!companyLimitsCache[_0x28d05b]&&(companyLimitsCache[_0x28d05b]=await chat['get_max_employee_of_this_company'](_0x28d05b));const _0x143785=companyLimitsCache[_0x28d05b];if(_0x1e84c5[_0x4ffb1b(0x1aa)]>=_0x143785){_0x1bf747[_0x4ffb1b(0x1a8)]('connectionRejected','Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20límite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresía.');return;}}_0x1bf747['companyId']=_0x28d05b,_0x1e84c5[_0x4ffb1b(0x1bc)]({'userId':_0x1203cb,'socketId':_0x1bf747['id']}),connectedEmployees[_0x28d05b]=_0x1e84c5;const _0x16d9ab=await chat[_0x4ffb1b(0x1b7)](_0x1203cb,0xa);io['to'](_0x1203cb)[_0x4ffb1b(0x1a8)]('privateNotifications',{'notifications':_0x16d9ab});});async function _0x2ae034(_0xb91eb4){const _0x3e6c9b=users[_0xb91eb4];let _0x534206=_0x3e6c9b;!_0x3e6c9b&&(_0x534206=await chat['this_email_exist'](toUserId));const _0x35dc2d={'canSend':_0x534206,'theUserIsConnect':_0x3e6c9b};return _0x35dc2d;}_0x1bf747['on'](_0x402057(0x1a9),async({userEmail:_0x26a309,toUserEmail:_0x1712d7,message:_0x521c44})=>{const _0x29c851=_0x402057,_0x26eabc=await _0x2ae034(_0x1712d7);_0x26eabc[_0x29c851(0x146)]?await chat['create_notification'](_0x26a309,_0x1712d7,_0x521c44)?(_0x26eabc[_0x29c851(0x16a)]&&io['to'](recipientSocketId)['emit'](_0x29c851(0x17b),{'userId':userId,'message':_0x521c44}),_0x1bf747['emit'](_0x29c851(0x14d),{'success':!![],'message':_0x29c851(0x1bd)})):_0x1bf747[_0x29c851(0x1a8)](_0x29c851(0x14d),{'success':![],'message':_0x29c851(0x1c3)+_0x1712d7+_0x29c851(0x184)}):_0x1bf747[_0x29c851(0x1a8)]('messageStatus',{'success':![],'message':_0x29c851(0x1b9)+_0x1712d7+_0x29c851(0x15e)});}),_0x1bf747['on'](_0x402057(0x160),async({userEmail:_0x496fd2})=>{const _0x300d65=_0x402057,_0x5af339=await chat[_0x300d65(0x1b7)](_0x496fd2,0xa);io['to'](recipientSocketId)[_0x300d65(0x1a8)](_0x300d65(0x1ba),{'notifications':_0x5af339});}),_0x1bf747['on'](_0x402057(0x15a),async({userId:_0x2b47d1,toUserId:_0x3af3b8,message:_0x4ce71f})=>{const _0xcb8ad1=_0x402057,_0x382c75=users[_0x3af3b8];let _0x39ab30=_0x382c75;!_0x382c75&&(_0x39ab30=await chat['this_email_exist'](_0x3af3b8));if(_0x39ab30){const _0x498df6=await chat['create_new_chat'](_0x2b47d1,_0x3af3b8);await chat[_0xcb8ad1(0x143)](_0x498df6,_0x2b47d1,_0x4ce71f)&&(_0x382c75&&io['to'](_0x382c75)[_0xcb8ad1(0x1a8)](_0xcb8ad1(0x17b),{'userId':_0x2b47d1,'message':_0x4ce71f})),_0x1bf747[_0xcb8ad1(0x1a8)]('messageStatus',{'success':!![],'message':_0xcb8ad1(0x15d)});}else _0x1bf747[_0xcb8ad1(0x1a8)](_0xcb8ad1(0x14d),{'success':![],'message':_0xcb8ad1(0x187)+_0x3af3b8+'\x27\x20no\x20existe\x20🤔'});}),_0x1bf747['on']('disconnect',()=>{const _0x19fc27=_0x402057,{companyId:_0x1b6a70}=_0x1bf747;_0x1b6a70&&connectedEmployees[_0x1b6a70]?(connectedEmployees[_0x1b6a70]=connectedEmployees[_0x1b6a70][_0x19fc27(0x1b1)](_0x1a879f=>_0x1a879f[_0x19fc27(0x1c1)]!==_0x1bf747['id']),connectedEmployees[_0x1b6a70][_0x19fc27(0x1aa)]===0x0&&delete connectedEmployees[_0x1b6a70]):console['log'](_0x19fc27(0x178)+_0x1bf747['id']+_0x19fc27(0x17d));}),_0x1bf747['on']('sendNotification',_0x826de5=>{const _0x8a3a24=_0x402057;console[_0x8a3a24(0x159)](_0x8a3a24(0x1ac),_0x826de5),_0x1bf747[_0x8a3a24(0x17c)][_0x8a3a24(0x1a8)]('newNotification',_0x826de5);}),_0x1bf747['on']('sendAllTheOrders',_0x2e42a0=>{const _0x634369=_0x402057;_0x1bf747[_0x634369(0x1a8)]('getAllTheOrders',{'orderKitchen':orderKitchen});}),_0x1bf747['on']('saveANewOrder',_0x2add47=>{const _0x233794=_0x402057,_0x46e3bb=JSON['parse'](_0x2add47);_0x46e3bb['id']=orderKitchen[_0x233794(0x1aa)]+0x1,orderKitchen[_0x233794(0x1bc)](_0x46e3bb);});});const companyName='/links';serverExpress[_0x5c50ed(0x18d)](require('./router')),serverExpress['use'](require('./router/authentication')),serverExpress[_0x5c50ed(0x18d)](companyName,require(_0x5c50ed(0x182)));const routesPath=path[_0x5c50ed(0x1b5)](__dirname,_0x5c50ed(0x18b));fs['readdirSync'](routesPath)['forEach'](_0x13c1a7=>{const _0x550527=_0x5c50ed,_0x4922f3=path[_0x550527(0x1b5)](routesPath,_0x13c1a7);fs['statSync'](_0x4922f3)[_0x550527(0x1a4)]()&&_0x13c1a7[_0x550527(0x1af)](_0x550527(0x1b8))&&serverExpress[_0x550527(0x18d)](companyName,require(_0x4922f3));}),serverExpress[_0x5c50ed(0x18d)](require(_0x5c50ed(0x1bb))),serverExpress['use'](express[_0x5c50ed(0x1b6)](path[_0x5c50ed(0x1b5)](__dirname,_0x5c50ed(0x1c0))));const os=require('os');function getLocalIP(){const _0x27a626=_0x5c50ed,_0x1eb060=os[_0x27a626(0x199)]();for(let _0x4b5814 in _0x1eb060){for(let _0xb9878c=0x0;_0xb9878c<_0x1eb060[_0x4b5814][_0x27a626(0x1aa)];_0xb9878c++){const _0x393200=_0x1eb060[_0x4b5814][_0xb9878c];if(_0x393200[_0x27a626(0x164)]===_0x27a626(0x19a)&&!_0x393200['internal'])return _0x393200[_0x27a626(0x173)];}}return _0x27a626(0x14f);}serverExpress[_0x5c50ed(0x19c)](serverExpress['get'](_0x5c50ed(0x15b)),_0x5c50ed(0x17f),()=>{const _0x4d1a61=_0x5c50ed;console[_0x4d1a61(0x159)](_0x4d1a61(0x17e)+getLocalIP()+':'+serverExpress[_0x4d1a61(0x1b0)](_0x4d1a61(0x15b)));});