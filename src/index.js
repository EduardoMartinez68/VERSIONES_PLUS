const _0xcd1c83=_0x475d;(function(_0x5a4a44,_0x3e96f0){const _0x44f5b1=_0x475d,_0x4975d4=_0x5a4a44();while(!![]){try{const _0xcf013f=-parseInt(_0x44f5b1(0x13c))/0x1+parseInt(_0x44f5b1(0x147))/0x2+parseInt(_0x44f5b1(0x139))/0x3+-parseInt(_0x44f5b1(0x17b))/0x4*(-parseInt(_0x44f5b1(0x17d))/0x5)+parseInt(_0x44f5b1(0x13e))/0x6*(-parseInt(_0x44f5b1(0x1a8))/0x7)+-parseInt(_0x44f5b1(0x12d))/0x8*(-parseInt(_0x44f5b1(0x18a))/0x9)+parseInt(_0x44f5b1(0x190))/0xa*(-parseInt(_0x44f5b1(0x133))/0xb);if(_0xcf013f===_0x3e96f0)break;else _0x4975d4['push'](_0x4975d4['shift']());}catch(_0x19e00f){_0x4975d4['push'](_0x4975d4['shift']());}}}(_0x20d5,0x5a85e));const system=require(_0xcd1c83(0x14f)),express=require('express'),morgan=require(_0xcd1c83(0x14e)),{engine}=require(_0xcd1c83(0x16a)),multer=require('multer'),flash=require(_0xcd1c83(0x15b)),session=require(_0xcd1c83(0x144)),passport=require('passport'),{database}=require(_0xcd1c83(0x160)),{v4:uuid}=require(_0xcd1c83(0x155)),path=require(_0xcd1c83(0x194)),{RecaptchaV2}=require(_0xcd1c83(0x12c)),nodePersist=require(_0xcd1c83(0x19c));function _0x475d(_0x154677,_0x2a7ac1){const _0x20d530=_0x20d5();return _0x475d=function(_0x475d89,_0x249e89){_0x475d89=_0x475d89-0x126;let _0x36fa70=_0x20d530[_0x475d89];return _0x36fa70;},_0x475d(_0x154677,_0x2a7ac1);}nodePersist[_0xcd1c83(0x1a0)]({'dir':path[_0xcd1c83(0x19d)](__dirname,'data')});const serverExpress=express();require(_0xcd1c83(0x137)),require('./lib/editFrom'),serverExpress[_0xcd1c83(0x18c)](_0xcd1c83(0x19b),process[_0xcd1c83(0x1a1)]['PORT']||0xfa0),serverExpress['set'](_0xcd1c83(0x186),path[_0xcd1c83(0x19d)](__dirname,_0xcd1c83(0x186))),serverExpress[_0xcd1c83(0x197)](_0xcd1c83(0x18b),engine({'defaultLayout':'main','layoutsDir':path[_0xcd1c83(0x19d)](serverExpress['get'](_0xcd1c83(0x186)),_0xcd1c83(0x19a)),'partialsDir':path[_0xcd1c83(0x19d)](serverExpress[_0xcd1c83(0x1a5)](_0xcd1c83(0x186)),_0xcd1c83(0x14d)),'extname':_0xcd1c83(0x18b),'helpers':require(_0xcd1c83(0x154))})),serverExpress['set'](_0xcd1c83(0x132),_0xcd1c83(0x18b)),require(_0xcd1c83(0x15c))[_0xcd1c83(0x128)]();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process[_0xcd1c83(0x1a1)],pg=require('pg'),fs=require('fs'),adminPool=new pg['Pool']({'user':APP_PG_USER,'host':APP_PG_HOST,'password':APP_PG_PASSWORD,'port':APP_PG_PORT,'database':_0xcd1c83(0x157)}),importSQLFile=async _0x3bc996=>{const _0x4989f9=_0xcd1c83,_0x40d70f=path[_0x4989f9(0x19d)](__dirname,'database',_0x4989f9(0x136)),_0x1a2c2a=fs[_0x4989f9(0x16f)](_0x40d70f,'utf8'),_0x5d4960=_0x1a2c2a[_0x4989f9(0x16c)](/;\s*$/m)['map'](_0x36612e=>_0x36612e['trim']())[_0x4989f9(0x127)](_0x4a4076=>_0x4a4076['length']>0x0),_0x1c0948=await _0x3bc996[_0x4989f9(0x158)]();try{for(const _0x49d9fd of _0x5d4960){await _0x1c0948[_0x4989f9(0x131)](_0x49d9fd);}console[_0x4989f9(0x14a)]('✅\x20SQL\x20ejecutado\x20correctamente');}catch(_0x5b0c04){console['error'](_0x4989f9(0x195),_0x5b0c04['message']);}finally{_0x1c0948[_0x4989f9(0x13f)]();}},createDatabase=async()=>{const _0x34289f=_0xcd1c83,_0x2e5c6a=await adminPool[_0x34289f(0x131)]('SELECT\x201\x20FROM\x20pg_database\x20WHERE\x20datname\x20=\x20\x27edplus\x27');_0x2e5c6a[_0x34289f(0x153)]===0x0?(await adminPool[_0x34289f(0x131)]('CREATE\x20DATABASE\x20edplus'),importSQLFile(adminPool),console[_0x34289f(0x14a)](_0x34289f(0x145))):console[_0x34289f(0x14a)](_0x34289f(0x18d));};createDatabase();const pgPool=new pg[(_0xcd1c83(0x15e))]({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress['use'](session({'secret':_0xcd1c83(0x13b),'resave':![],'saveUninitialized':![],'store':new(require(_0xcd1c83(0x164))(session))({'pool':pgPool,'tableName':_0xcd1c83(0x170)})})),serverExpress[_0xcd1c83(0x168)](flash()),serverExpress[_0xcd1c83(0x168)](morgan(_0xcd1c83(0x176))),serverExpress[_0xcd1c83(0x168)](express['urlencoded']({'extended':![]})),serverExpress[_0xcd1c83(0x168)](express['json']()),serverExpress[_0xcd1c83(0x168)](passport['initialize']()),serverExpress[_0xcd1c83(0x168)](passport[_0xcd1c83(0x170)]());const storageImages=multer[_0xcd1c83(0x16d)]({'destination':path['join'](__dirname,_0xcd1c83(0x15f)),'filename':(_0x19aa02,_0x56decd,_0x339f09)=>{const _0x3a5f90=_0xcd1c83;_0x339f09(null,uuid()+path[_0x3a5f90(0x14b)](_0x56decd[_0x3a5f90(0x12b)]));}});serverExpress[_0xcd1c83(0x168)](multer({'storage':storageImages})[_0xcd1c83(0x19e)](_0xcd1c83(0x13d))),serverExpress[_0xcd1c83(0x168)]((_0x49486e,_0x338bd0,_0x2b07e8)=>{const _0x1872d3=_0xcd1c83;serverExpress['locals']['success']=_0x49486e[_0x1872d3(0x129)]('success'),serverExpress[_0x1872d3(0x15a)][_0x1872d3(0x175)]=_0x49486e[_0x1872d3(0x129)](_0x1872d3(0x175)),serverExpress[_0x1872d3(0x15a)][_0x1872d3(0x140)]=_0x49486e['user'],serverExpress['locals'][_0x1872d3(0x185)]=_0x49486e[_0x1872d3(0x185)],serverExpress[_0x1872d3(0x15a)][_0x1872d3(0x187)]=0x0,serverExpress[_0x1872d3(0x15a)]['pack_branch']=0x0,_0x2b07e8();});const http=require(_0xcd1c83(0x138)),serverSocket=http['createServer'](serverExpress),{Server}=require(_0xcd1c83(0x162)),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require('./services/chat.js');serverSocket[_0xcd1c83(0x159)](serverExpress[_0xcd1c83(0x1a5)]('port'),()=>{const _0x58c24d=_0xcd1c83;console['log'](_0x58c24d(0x152)+serverExpress['get'](_0x58c24d(0x19b)));}),io['on'](_0xcd1c83(0x174),async _0x4244c5=>{const _0x10f7e5=_0xcd1c83;console['log'](_0x10f7e5(0x142)),_0x4244c5['on'](_0x10f7e5(0x148),async(_0x1c6a38,_0x20efea)=>{const _0x3dbcda=_0x10f7e5,_0x54886d=connectedEmployees[_0x20efea]||[],_0x488da8=_0x54886d[_0x3dbcda(0x179)](_0xafa739=>_0xafa739[_0x3dbcda(0x193)]===_0x1c6a38);if(_0x488da8){_0x4244c5[_0x3dbcda(0x163)](_0x3dbcda(0x150),_0x3dbcda(0x191));return;}if(system!=_0x3dbcda(0x17c)){!companyLimitsCache[_0x20efea]&&(companyLimitsCache[_0x20efea]=await chat[_0x3dbcda(0x199)](_0x20efea));const _0x558a0b=companyLimitsCache[_0x20efea];if(_0x54886d[_0x3dbcda(0x180)]>=_0x558a0b){_0x4244c5['emit'](_0x3dbcda(0x150),_0x3dbcda(0x126));return;}}_0x4244c5[_0x3dbcda(0x198)]=_0x20efea,_0x54886d['push']({'userId':_0x1c6a38,'socketId':_0x4244c5['id']}),connectedEmployees[_0x20efea]=_0x54886d;const _0x46f9ba=await chat[_0x3dbcda(0x18f)](_0x1c6a38,0xa);io['to'](_0x1c6a38)[_0x3dbcda(0x163)](_0x3dbcda(0x192),{'notifications':_0x46f9ba});});async function _0x3379ff(_0x5e9627){const _0x24be9f=users[_0x5e9627];let _0x378cc6=_0x24be9f;!_0x24be9f&&(_0x378cc6=await chat['this_email_exist'](toUserId));const _0x9317db={'canSend':_0x378cc6,'theUserIsConnect':_0x24be9f};return _0x9317db;}_0x4244c5['on'](_0x10f7e5(0x1a7),async({userEmail:_0x9e26d8,toUserEmail:_0x841984,message:_0x5eeb86})=>{const _0xcae372=_0x10f7e5,_0xa9012c=await _0x3379ff(_0x841984);_0xa9012c[_0xcae372(0x17f)]?await chat[_0xcae372(0x166)](_0x9e26d8,_0x841984,_0x5eeb86)?(_0xa9012c[_0xcae372(0x14c)]&&io['to'](recipientSocketId)['emit'](_0xcae372(0x17a),{'userId':userId,'message':_0x5eeb86}),_0x4244c5[_0xcae372(0x163)]('messageStatus',{'success':!![],'message':_0xcae372(0x135)})):_0x4244c5[_0xcae372(0x163)](_0xcae372(0x181),{'success':![],'message':_0xcae372(0x161)+_0x841984+_0xcae372(0x171)}):_0x4244c5[_0xcae372(0x163)](_0xcae372(0x181),{'success':![],'message':_0xcae372(0x177)+_0x841984+_0xcae372(0x188)});}),_0x4244c5['on'](_0x10f7e5(0x151),async({userEmail:_0x22a76c})=>{const _0x36f7d3=_0x10f7e5,_0x2b4f0c=await chat[_0x36f7d3(0x18f)](_0x22a76c,0xa);io['to'](recipientSocketId)[_0x36f7d3(0x163)](_0x36f7d3(0x192),{'notifications':_0x2b4f0c});}),_0x4244c5['on'](_0x10f7e5(0x16e),async({userId:_0x1b50b6,toUserId:_0x106f2f,message:_0x1107d6})=>{const _0x29752d=_0x10f7e5,_0x54fb2e=users[_0x106f2f];let _0x43dc4d=_0x54fb2e;!_0x54fb2e&&(_0x43dc4d=await chat[_0x29752d(0x165)](_0x106f2f));if(_0x43dc4d){const _0x15c87d=await chat[_0x29752d(0x12e)](_0x1b50b6,_0x106f2f);await chat[_0x29752d(0x1a6)](_0x15c87d,_0x1b50b6,_0x1107d6)&&(_0x54fb2e&&io['to'](_0x54fb2e)[_0x29752d(0x163)](_0x29752d(0x17a),{'userId':_0x1b50b6,'message':_0x1107d6})),_0x4244c5[_0x29752d(0x163)](_0x29752d(0x181),{'success':!![],'message':_0x29752d(0x183)});}else _0x4244c5[_0x29752d(0x163)](_0x29752d(0x181),{'success':![],'message':_0x29752d(0x143)+_0x106f2f+'\x27\x20no\x20existe\x20🤔'});}),_0x4244c5['on']('disconnect',()=>{const _0x42f850=_0x10f7e5,{companyId:_0x2229f9}=_0x4244c5;_0x2229f9&&connectedEmployees[_0x2229f9]?(connectedEmployees[_0x2229f9]=connectedEmployees[_0x2229f9][_0x42f850(0x127)](_0x8976cd=>_0x8976cd[_0x42f850(0x156)]!==_0x4244c5['id']),connectedEmployees[_0x2229f9][_0x42f850(0x180)]===0x0&&delete connectedEmployees[_0x2229f9]):console['log']('Socket\x20'+_0x4244c5['id']+_0x42f850(0x1a2));}),_0x4244c5['on'](_0x10f7e5(0x189),_0x26409d=>{const _0x3ae48e=_0x10f7e5;console[_0x3ae48e(0x14a)](_0x3ae48e(0x19f),_0x26409d),_0x4244c5[_0x3ae48e(0x1a4)]['emit'](_0x3ae48e(0x130),_0x26409d);}),_0x4244c5['on']('sendAllTheOrders',_0x1a37bf=>{const _0x3657ed=_0x10f7e5;_0x4244c5[_0x3657ed(0x163)](_0x3657ed(0x134),{'orderKitchen':orderKitchen});}),_0x4244c5['on']('saveANewOrder',_0x446222=>{const _0x30a5ca=_0x10f7e5,_0x110d80=JSON['parse'](_0x446222);_0x110d80['id']=orderKitchen[_0x30a5ca(0x180)]+0x1,orderKitchen[_0x30a5ca(0x18e)](_0x110d80);});});const companyName=_0xcd1c83(0x17e);serverExpress['use'](require('./router')),serverExpress['use'](require('./router/authentication')),serverExpress['use'](companyName,require(_0xcd1c83(0x13a)));const routesPath=path['join'](__dirname,_0xcd1c83(0x173));fs[_0xcd1c83(0x149)](routesPath)[_0xcd1c83(0x172)](_0x30b1b0=>{const _0x5cf4e2=_0xcd1c83,_0x49ae27=path['join'](routesPath,_0x30b1b0);fs[_0x5cf4e2(0x12f)](_0x49ae27)[_0x5cf4e2(0x12a)]()&&_0x30b1b0['endsWith'](_0x5cf4e2(0x16b))&&serverExpress[_0x5cf4e2(0x168)](companyName,require(_0x49ae27));}),serverExpress[_0xcd1c83(0x168)](require(_0xcd1c83(0x146))),serverExpress[_0xcd1c83(0x168)](express[_0xcd1c83(0x1a3)](path[_0xcd1c83(0x19d)](__dirname,_0xcd1c83(0x141))));const os=require('os');function getLocalIP(){const _0x5e8afe=_0xcd1c83,_0x258299=os[_0x5e8afe(0x182)]();for(let _0x556c56 in _0x258299){for(let _0x3fec82=0x0;_0x3fec82<_0x258299[_0x556c56][_0x5e8afe(0x180)];_0x3fec82++){const _0x3db001=_0x258299[_0x556c56][_0x3fec82];if(_0x3db001['family']===_0x5e8afe(0x169)&&!_0x3db001[_0x5e8afe(0x178)])return _0x3db001[_0x5e8afe(0x15d)];}}return _0x5e8afe(0x167);}serverExpress[_0xcd1c83(0x159)](serverExpress['get'](_0xcd1c83(0x19b)),_0xcd1c83(0x196),()=>{const _0x4341c4=_0xcd1c83;console[_0x4341c4(0x14a)](_0x4341c4(0x184)+getLocalIP()+':'+serverExpress[_0x4341c4(0x1a5)](_0x4341c4(0x19b)));});function _0x20d5(){const _0x3ae4e4=['11824iGxWYC','registerUser','readdirSync','log','extname','theUserIsConnect','partials','morgan','./lib/system','connectionRejected','getTheFirstTenNotifications','Server\x20running\x20on\x20port\x20','rowCount','./lib/handlebars','uuid','socketId','postgres','connect','listen','locals','connect-flash','dotenv','address','Pool','public/img/uploads','./keys','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27','socket.io','emit','connect-pg-simple','this_email_exist','create_notification','127.0.0.1','use','IPv4','express-handlebars','.js','split','diskStorage','sendMessageToUser','readFileSync','session','\x27.\x20Inténtalo\x20de\x20nuevo.\x20😳','forEach','router/links','connection','message','dev','El\x20usuario\x20\x27','internal','some','privateMessage','62380TSPQsd','desktop','95EsnsTr','/links','canSend','length','messageStatus','networkInterfaces','Mensaje\x20enviado\x20con\x20éxito','Server\x20running\x20on\x20http://','company','views','pack_company','\x27\x20no\x20existe.\x20🤔','sendNotification','9sptizi','.hbs','set','📂\x20La\x20base\x20de\x20datos\x20EDPLUS\x20ya\x20existe,\x20no\x20se\x20creó\x20nuevamente.','push','get_the_first_notification','9810CbnhCh','Ups,\x20parece\x20que\x20ya\x20estás\x20conectado\x20en\x20otro\x20dispositivo.','privateNotifications','userId','path','❌\x20Error\x20ejecutando\x20SQL:','0.0.0.0','engine','companyId','get_max_employee_of_this_company','layouts','port','node-persist','join','single','Nueva\x20notificación:','init','env','\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.','static','broadcast','get','send_new_message','sendNotificationToUser','547533QrfFDj','Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20límite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresía.','filter','config','flash','isFile','originalname','express-recaptcha','3704744QBsdnf','create_new_chat','statSync','newNotification','query','view\x20engine','4411OWhZGK','getAllTheOrders','Mensaje\x20enviado\x20con\x20éxito.\x20👌','edplus.sql','./lib/passport','http','1155222bacloE','./router/links','FudSession','151564dHZOtf','image','18rdambg','release','user','public','Un\x20usuario\x20se\x20ha\x20conectado','Este\x20email\x20\x27','express-session','📦\x20Base\x20de\x20datos\x20EDPLUS\x20creada','./lib/addFrom'];_0x20d5=function(){return _0x3ae4e4;};return _0x20d5();}