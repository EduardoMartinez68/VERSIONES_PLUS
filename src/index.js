const _0x55efa2=_0x5d50;(function(_0x66a9ed,_0x5e9838){const _0xa8a2ef=_0x5d50,_0x1d3a38=_0x66a9ed();while(!![]){try{const _0x5dd6c6=-parseInt(_0xa8a2ef(0x123))/0x1+parseInt(_0xa8a2ef(0x154))/0x2+parseInt(_0xa8a2ef(0x120))/0x3+-parseInt(_0xa8a2ef(0x122))/0x4*(parseInt(_0xa8a2ef(0x137))/0x5)+parseInt(_0xa8a2ef(0x11a))/0x6*(parseInt(_0xa8a2ef(0x13b))/0x7)+parseInt(_0xa8a2ef(0x178))/0x8*(-parseInt(_0xa8a2ef(0x166))/0x9)+parseInt(_0xa8a2ef(0x151))/0xa*(parseInt(_0xa8a2ef(0x16a))/0xb);if(_0x5dd6c6===_0x5e9838)break;else _0x1d3a38['push'](_0x1d3a38['shift']());}catch(_0x5b3f2c){_0x1d3a38['push'](_0x1d3a38['shift']());}}}(_0x2b0a,0xa86ad));const system=require(_0x55efa2(0x146)),express=require(_0x55efa2(0x10e)),morgan=require('morgan'),{engine}=require(_0x55efa2(0x10f)),multer=require(_0x55efa2(0xf7)),flash=require('connect-flash'),session=require(_0x55efa2(0x14f)),passport=require('passport'),{database}=require(_0x55efa2(0x15b)),{v4:uuid}=require(_0x55efa2(0x126)),path=require(_0x55efa2(0xfa)),{RecaptchaV2}=require(_0x55efa2(0x136)),serverExpress=express();require('./lib/passport'),require(_0x55efa2(0x133)),serverExpress['set']('port',process[_0x55efa2(0x16d)]['PORT']||0xfa0),serverExpress['set'](_0x55efa2(0x159),path[_0x55efa2(0x14c)](__dirname,_0x55efa2(0x159))),serverExpress[_0x55efa2(0x12e)](_0x55efa2(0x143),engine({'defaultLayout':_0x55efa2(0x141),'layoutsDir':path['join'](serverExpress[_0x55efa2(0x165)]('views'),_0x55efa2(0x109)),'partialsDir':path[_0x55efa2(0x14c)](serverExpress[_0x55efa2(0x165)]('views'),_0x55efa2(0x124)),'extname':'.hbs','helpers':require('./lib/handlebars')})),serverExpress[_0x55efa2(0x13a)](_0x55efa2(0x16e),_0x55efa2(0x143)),require('dotenv')[_0x55efa2(0x12a)]();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process[_0x55efa2(0x16d)],pg=require('pg'),fs=require('fs'),adminPool=new pg[(_0x55efa2(0x10a))]({'user':APP_PG_USER,'host':APP_PG_HOST,'password':APP_PG_PASSWORD,'port':APP_PG_PORT,'database':_0x55efa2(0x14b)}),importSQLFile=async _0x265758=>{const _0x372407=_0x55efa2,_0x4bb33d=path[_0x372407(0x14c)](__dirname,'database',_0x372407(0x14d)),_0x28744b=fs[_0x372407(0x145)](_0x4bb33d,_0x372407(0x155)),_0x440ed6=_0x28744b[_0x372407(0x170)](/;\s*$/m)['map'](_0x3cb1db=>_0x3cb1db['trim']())['filter'](_0x4954ca=>_0x4954ca[_0x372407(0x173)]>0x0),_0x3a38ea=await _0x265758['connect']();try{for(const _0xab190e of _0x440ed6){await _0x3a38ea[_0x372407(0x131)](_0xab190e);}console[_0x372407(0x10c)](_0x372407(0xfd));}catch(_0x213a2d){console[_0x372407(0x116)]('❌\x20Error\x20ejecutando\x20SQL:',_0x213a2d[_0x372407(0x121)]);}finally{_0x3a38ea['release']();}},createDatabase=async()=>{const _0xaeab0e=_0x55efa2,_0x245306=await adminPool[_0xaeab0e(0x131)](_0xaeab0e(0x158));_0x245306[_0xaeab0e(0xfb)]===0x0?(await adminPool[_0xaeab0e(0x131)](_0xaeab0e(0x11b)),importSQLFile(adminPool),console[_0xaeab0e(0x10c)](_0xaeab0e(0x162))):console[_0xaeab0e(0x10c)](_0xaeab0e(0x148));};createDatabase();function _0x5d50(_0x4dbcf6,_0x53e281){const _0x2b0aa6=_0x2b0a();return _0x5d50=function(_0x5d5039,_0x20b60b){_0x5d5039=_0x5d5039-0xf6;let _0x334dd5=_0x2b0aa6[_0x5d5039];return _0x334dd5;},_0x5d50(_0x4dbcf6,_0x53e281);}function _0x2b0a(){const _0x8b26e3=['static','📦\x20Base\x20de\x20datos\x20EDPLUS\x20creada','initialize','saveANewOrder','get','543051qRMcaI','privateNotifications','sendMessageToUser','\x27\x20no\x20existe.\x20🤔','2189OGBJut','registerUser','diskStorage','env','view\x20engine','./router/links/ceo','split','port','0.0.0.0','length','Socket\x20','company','./router/links/cashCut','./router/links/store','128XqpKUh','FudSession','privateMessage','multer','Ups,\x20parece\x20que\x20ya\x20estás\x20conectado\x20en\x20otro\x20dispositivo.','./router','path','rowCount','theUserIsConnect','✅\x20SQL\x20ejecutado\x20correctamente','extname','./router/links/CRM','internal','session','userId','\x27\x20no\x20existe\x20🤔','json','broadcast','some','socket.io','flash','layouts','Pool','./router/links/delivery','log','sendAllTheOrders','express','express-handlebars','./services/chat.js','get_the_first_notification','Mensaje\x20enviado\x20con\x20éxito','companyId','sendNotificationToUser','Server\x20running\x20on\x20http://','error','listen','image','./lib/addFrom','234sRjbdc','CREATE\x20DATABASE\x20edplus','use','127.0.0.1','get_max_employee_of_this_company','locals','750135gfipAb','message','2245448TlFago','455210lfMJHe','partials','./router/authentication','uuid','IPv4','./router/links/fudone','networkInterfaces','config','address','push','getTheFirstTenNotifications','engine','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27','connect-pg-simple','query','./router/links/branch','./lib/editFrom','\x27.\x20Inténtalo\x20de\x20nuevo.\x20😳','originalname','express-recaptcha','10gUjFsb','create_new_chat','success','set','53823yXTVNW','Un\x20usuario\x20se\x20ha\x20conectado','connectionRejected','./router/links/subscription','createServer','socketId','main','create_notification','.hbs','dev','readFileSync','./lib/system','connection','📂\x20La\x20base\x20de\x20datos\x20EDPLUS\x20ya\x20existe,\x20no\x20se\x20creó\x20nuevamente.','getAllTheOrders','user','postgres','join','edplus.sql','public','express-session','parse','108330yFUnnh','Server\x20running\x20on\x20port\x20','disconnect','1055024GITBLl','utf8','./router/links/orders','messageStatus','SELECT\x201\x20FROM\x20pg_database\x20WHERE\x20datname\x20=\x20\x27edplus\x27','views','public/img/uploads','./keys','send_new_message','newNotification','Nueva\x20notificación:','emit','canSend'];_0x2b0a=function(){return _0x8b26e3;};return _0x2b0a();}const pgPool=new pg[(_0x55efa2(0x10a))]({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress[_0x55efa2(0x11c)](session({'secret':_0x55efa2(0x179),'resave':![],'saveUninitialized':![],'store':new(require(_0x55efa2(0x130))(session))({'pool':pgPool,'tableName':_0x55efa2(0x101)})})),serverExpress['use'](flash()),serverExpress[_0x55efa2(0x11c)](morgan(_0x55efa2(0x144))),serverExpress[_0x55efa2(0x11c)](express['urlencoded']({'extended':![]})),serverExpress['use'](express[_0x55efa2(0x104)]()),serverExpress[_0x55efa2(0x11c)](passport[_0x55efa2(0x163)]()),serverExpress[_0x55efa2(0x11c)](passport[_0x55efa2(0x101)]());const storage=multer[_0x55efa2(0x16c)]({'destination':path['join'](__dirname,_0x55efa2(0x15a)),'filename':(_0x99f19,_0x596bf6,_0x2e2781,_0x4e710b)=>{const _0x132274=_0x55efa2;_0x2e2781(null,uuid()+path[_0x132274(0xfe)](_0x596bf6[_0x132274(0x135)]));}});serverExpress[_0x55efa2(0x11c)](multer({'storage':storage})['single'](_0x55efa2(0x118))),serverExpress[_0x55efa2(0x11c)]((_0x5ea86f,_0x4a15fd,_0x53142d)=>{const _0x27f31f=_0x55efa2;serverExpress['locals'][_0x27f31f(0x139)]=_0x5ea86f[_0x27f31f(0x108)](_0x27f31f(0x139)),serverExpress[_0x27f31f(0x11f)][_0x27f31f(0x121)]=_0x5ea86f[_0x27f31f(0x108)]('message'),serverExpress[_0x27f31f(0x11f)][_0x27f31f(0x14a)]=_0x5ea86f[_0x27f31f(0x14a)],serverExpress[_0x27f31f(0x11f)][_0x27f31f(0x175)]=_0x5ea86f['company'],serverExpress['locals']['pack_company']=0x0,serverExpress[_0x27f31f(0x11f)]['pack_branch']=0x0,_0x53142d();});const http=require('http'),serverSocket=http[_0x55efa2(0x13f)](serverExpress),{Server}=require(_0x55efa2(0x107)),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require(_0x55efa2(0x110));serverSocket[_0x55efa2(0x117)](serverExpress[_0x55efa2(0x165)]('port'),()=>{const _0x11e03c=_0x55efa2;console['log'](_0x11e03c(0x152)+serverExpress[_0x11e03c(0x165)](_0x11e03c(0x171)));}),io['on'](_0x55efa2(0x147),async _0x11d5a2=>{const _0x2515fb=_0x55efa2;console[_0x2515fb(0x10c)](_0x2515fb(0x13c)),_0x11d5a2['on'](_0x2515fb(0x16b),async(_0x4a2152,_0x6edbda)=>{const _0x2a0cdf=_0x2515fb,_0x3052f0=connectedEmployees[_0x6edbda]||[],_0x550818=_0x3052f0[_0x2a0cdf(0x106)](_0x33aa91=>_0x33aa91[_0x2a0cdf(0x102)]===_0x4a2152);if(_0x550818){_0x11d5a2['emit'](_0x2a0cdf(0x13d),_0x2a0cdf(0xf8));return;}if(system!='desktop'){!companyLimitsCache[_0x6edbda]&&(companyLimitsCache[_0x6edbda]=await chat[_0x2a0cdf(0x11e)](_0x6edbda));const _0x4dd14c=companyLimitsCache[_0x6edbda];if(_0x3052f0[_0x2a0cdf(0x173)]>=_0x4dd14c){_0x11d5a2['emit']('connectionRejected','Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20límite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresía.');return;}}_0x11d5a2[_0x2a0cdf(0x113)]=_0x6edbda,_0x3052f0[_0x2a0cdf(0x12c)]({'userId':_0x4a2152,'socketId':_0x11d5a2['id']}),connectedEmployees[_0x6edbda]=_0x3052f0;const _0x48b4de=await chat[_0x2a0cdf(0x111)](_0x4a2152,0xa);io['to'](_0x4a2152)[_0x2a0cdf(0x15f)](_0x2a0cdf(0x167),{'notifications':_0x48b4de});});async function _0x9f350c(_0x35b2fa){const _0x112f02=users[_0x35b2fa];let _0x11ac9b=_0x112f02;!_0x112f02&&(_0x11ac9b=await chat['this_email_exist'](toUserId));const _0x4c5783={'canSend':_0x11ac9b,'theUserIsConnect':_0x112f02};return _0x4c5783;}_0x11d5a2['on'](_0x2515fb(0x114),async({userEmail:_0x1826b0,toUserEmail:_0x5d0b26,message:_0x3d703f})=>{const _0x2ca651=_0x2515fb,_0x808a9a=await _0x9f350c(_0x5d0b26);_0x808a9a[_0x2ca651(0x160)]?await chat[_0x2ca651(0x142)](_0x1826b0,_0x5d0b26,_0x3d703f)?(_0x808a9a[_0x2ca651(0xfc)]&&io['to'](recipientSocketId)[_0x2ca651(0x15f)]('privateMessage',{'userId':userId,'message':_0x3d703f}),_0x11d5a2[_0x2ca651(0x15f)](_0x2ca651(0x157),{'success':!![],'message':'Mensaje\x20enviado\x20con\x20éxito.\x20👌'})):_0x11d5a2[_0x2ca651(0x15f)]('messageStatus',{'success':![],'message':_0x2ca651(0x12f)+_0x5d0b26+_0x2ca651(0x134)}):_0x11d5a2[_0x2ca651(0x15f)](_0x2ca651(0x157),{'success':![],'message':'El\x20usuario\x20\x27'+_0x5d0b26+_0x2ca651(0x169)});}),_0x11d5a2['on'](_0x2515fb(0x12d),async({userEmail:_0x3dbd18})=>{const _0x34aafe=_0x2515fb,_0x3491fa=await chat['get_the_first_notification'](_0x3dbd18,0xa);io['to'](recipientSocketId)[_0x34aafe(0x15f)]('privateNotifications',{'notifications':_0x3491fa});}),_0x11d5a2['on'](_0x2515fb(0x168),async({userId:_0x1e07a0,toUserId:_0x12deab,message:_0x23302c})=>{const _0x396b1c=_0x2515fb,_0x253b23=users[_0x12deab];let _0x2442e6=_0x253b23;!_0x253b23&&(_0x2442e6=await chat['this_email_exist'](_0x12deab));if(_0x2442e6){const _0x2555db=await chat[_0x396b1c(0x138)](_0x1e07a0,_0x12deab);await chat[_0x396b1c(0x15c)](_0x2555db,_0x1e07a0,_0x23302c)&&(_0x253b23&&io['to'](_0x253b23)['emit'](_0x396b1c(0xf6),{'userId':_0x1e07a0,'message':_0x23302c})),_0x11d5a2[_0x396b1c(0x15f)](_0x396b1c(0x157),{'success':!![],'message':_0x396b1c(0x112)});}else _0x11d5a2['emit'](_0x396b1c(0x157),{'success':![],'message':'Este\x20email\x20\x27'+_0x12deab+_0x396b1c(0x103)});}),_0x11d5a2['on'](_0x2515fb(0x153),()=>{const _0x12e9d8=_0x2515fb,{companyId:_0x525e0f}=_0x11d5a2;_0x525e0f&&connectedEmployees[_0x525e0f]?(connectedEmployees[_0x525e0f]=connectedEmployees[_0x525e0f]['filter'](_0x57c157=>_0x57c157[_0x12e9d8(0x140)]!==_0x11d5a2['id']),connectedEmployees[_0x525e0f]['length']===0x0&&delete connectedEmployees[_0x525e0f]):console[_0x12e9d8(0x10c)](_0x12e9d8(0x174)+_0x11d5a2['id']+'\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.');}),_0x11d5a2['on']('sendNotification',_0x5c8494=>{const _0x50bc95=_0x2515fb;console[_0x50bc95(0x10c)](_0x50bc95(0x15e),_0x5c8494),_0x11d5a2[_0x50bc95(0x105)][_0x50bc95(0x15f)](_0x50bc95(0x15d),_0x5c8494);}),_0x11d5a2['on'](_0x2515fb(0x10d),_0x10d74a=>{const _0x393351=_0x2515fb;_0x11d5a2[_0x393351(0x15f)](_0x393351(0x149),{'orderKitchen':orderKitchen});}),_0x11d5a2['on'](_0x2515fb(0x164),_0x410179=>{const _0x4b7508=_0x2515fb,_0x5dc07a=JSON[_0x4b7508(0x150)](_0x410179);_0x5dc07a['id']=orderKitchen[_0x4b7508(0x173)]+0x1,orderKitchen[_0x4b7508(0x12c)](_0x5dc07a);});});const companyName='/links';serverExpress[_0x55efa2(0x11c)](require(_0x55efa2(0xf9))),serverExpress[_0x55efa2(0x11c)](require(_0x55efa2(0x125))),serverExpress[_0x55efa2(0x11c)](companyName,require('./router/links')),serverExpress[_0x55efa2(0x11c)](companyName,require(_0x55efa2(0x128))),serverExpress['use'](companyName,require(_0x55efa2(0x16f))),serverExpress[_0x55efa2(0x11c)](companyName,require(_0x55efa2(0x132))),serverExpress[_0x55efa2(0x11c)](companyName,require(_0x55efa2(0x13e))),serverExpress[_0x55efa2(0x11c)](companyName,require(_0x55efa2(0x177))),serverExpress[_0x55efa2(0x11c)](companyName,require(_0x55efa2(0x10b))),serverExpress[_0x55efa2(0x11c)](companyName,require('./router/links/app')),serverExpress[_0x55efa2(0x11c)](companyName,require(_0x55efa2(0xff))),serverExpress['use'](companyName,require('./router/links/desktop')),serverExpress[_0x55efa2(0x11c)](companyName,require('./router/links/boutique')),serverExpress[_0x55efa2(0x11c)](companyName,require(_0x55efa2(0x176))),serverExpress['use'](companyName,require(_0x55efa2(0x156))),serverExpress[_0x55efa2(0x11c)](companyName,require('./router/links/prescription')),serverExpress[_0x55efa2(0x11c)](require(_0x55efa2(0x119))),serverExpress[_0x55efa2(0x11c)](express[_0x55efa2(0x161)](path['join'](__dirname,_0x55efa2(0x14e))));const os=require('os');function getLocalIP(){const _0x45a2a5=_0x55efa2,_0x4a821f=os[_0x45a2a5(0x129)]();for(let _0x1a031a in _0x4a821f){for(let _0x37d816=0x0;_0x37d816<_0x4a821f[_0x1a031a][_0x45a2a5(0x173)];_0x37d816++){const _0x49aa37=_0x4a821f[_0x1a031a][_0x37d816];if(_0x49aa37['family']===_0x45a2a5(0x127)&&!_0x49aa37[_0x45a2a5(0x100)])return _0x49aa37[_0x45a2a5(0x12b)];}}return _0x45a2a5(0x11d);}serverExpress['listen'](serverExpress['get'](_0x55efa2(0x171)),_0x55efa2(0x172),()=>{const _0x517615=_0x55efa2;console[_0x517615(0x10c)](_0x517615(0x115)+getLocalIP()+':'+serverExpress[_0x517615(0x165)](_0x517615(0x171)));});