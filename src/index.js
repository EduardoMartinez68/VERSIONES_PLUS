const _0x25ce49=_0x1281;(function(_0x2fae9b,_0x568d41){const _0x5123b9=_0x1281,_0x576126=_0x2fae9b();while(!![]){try{const _0xa5e82e=parseInt(_0x5123b9(0xfa))/0x1+-parseInt(_0x5123b9(0x11f))/0x2*(-parseInt(_0x5123b9(0x131))/0x3)+parseInt(_0x5123b9(0x17a))/0x4*(parseInt(_0x5123b9(0x171))/0x5)+-parseInt(_0x5123b9(0x16c))/0x6+parseInt(_0x5123b9(0xf3))/0x7*(-parseInt(_0x5123b9(0x140))/0x8)+parseInt(_0x5123b9(0x108))/0x9*(-parseInt(_0x5123b9(0x180))/0xa)+parseInt(_0x5123b9(0xfd))/0xb;if(_0xa5e82e===_0x568d41)break;else _0x576126['push'](_0x576126['shift']());}catch(_0x2a0aba){_0x576126['push'](_0x576126['shift']());}}}(_0x2348,0x48761));const system=require('./lib/system'),express=require(_0x25ce49(0x154)),morgan=require(_0x25ce49(0x15b)),{engine}=require('express-handlebars'),multer=require(_0x25ce49(0x112)),flash=require(_0x25ce49(0x144)),session=require(_0x25ce49(0x143)),passport=require(_0x25ce49(0x10f)),{database}=require(_0x25ce49(0x184)),{v4:uuid}=require(_0x25ce49(0x181)),path=require(_0x25ce49(0x173)),{RecaptchaV2}=require(_0x25ce49(0x123)),nodePersist=require('node-persist');nodePersist[_0x25ce49(0x13c)]({'dir':path[_0x25ce49(0x167)](__dirname,_0x25ce49(0x138))});const serverExpress=express();require(_0x25ce49(0x10b)),require(_0x25ce49(0x11a)),serverExpress[_0x25ce49(0x115)](_0x25ce49(0x117),process['env'][_0x25ce49(0x128)]||0xfa0),serverExpress[_0x25ce49(0x115)](_0x25ce49(0x126),path[_0x25ce49(0x167)](__dirname,_0x25ce49(0x126))),serverExpress[_0x25ce49(0x10d)](_0x25ce49(0x135),engine({'defaultLayout':'main','layoutsDir':path['join'](serverExpress[_0x25ce49(0x14d)]('views'),_0x25ce49(0x15a)),'partialsDir':path[_0x25ce49(0x167)](serverExpress[_0x25ce49(0x14d)](_0x25ce49(0x126)),_0x25ce49(0x12d)),'extname':_0x25ce49(0x135),'helpers':require(_0x25ce49(0x141))})),serverExpress['set'](_0x25ce49(0x12b),_0x25ce49(0x135));const fs=require('fs'),crypto=require(_0x25ce49(0x122)),envPath=path[_0x25ce49(0x11c)](__dirname,_0x25ce49(0x109));let envContent=fs[_0x25ce49(0x124)](envPath)?fs[_0x25ce49(0x14b)](envPath,'utf8'):'';if(!envContent[_0x25ce49(0x15e)](_0x25ce49(0x14f))){const newKey=crypto[_0x25ce49(0x16d)](0x20)[_0x25ce49(0x16b)](_0x25ce49(0x150));envContent+=_0x25ce49(0x179)+newKey+'\x0a',fs[_0x25ce49(0x111)](envPath,envContent),console[_0x25ce49(0x163)]('✅\x20ENCRYPTION_KEY\x20generado\x20y\x20guardado\x20en\x20.env');}else console[_0x25ce49(0x163)](_0x25ce49(0xfc));require(_0x25ce49(0x153))['config']();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process[_0x25ce49(0x118)],pg=require('pg'),adminPool=new pg[(_0x25ce49(0x17f))]({'user':APP_PG_USER,'host':APP_PG_HOST,'password':APP_PG_PASSWORD,'port':APP_PG_PORT,'database':APP_PG_DATABASE}),importSQLFile=async _0x5211b4=>{const _0xf19ba=_0x25ce49,_0x53866e=path['join'](__dirname,_0xf19ba(0x15c),_0xf19ba(0xf9)),_0x5d143e=fs[_0xf19ba(0x14b)](_0x53866e,_0xf19ba(0xf5)),_0x2b4479=_0x5d143e[_0xf19ba(0x121)](/;\s*$/m)[_0xf19ba(0x165)](_0x108e70=>_0x108e70[_0xf19ba(0x159)]())[_0xf19ba(0x14a)](_0x5d4667=>_0x5d4667['length']>0x0),_0x215adf=await _0x5211b4[_0xf19ba(0x134)]();try{for(const _0x576a28 of _0x2b4479){await _0x215adf[_0xf19ba(0x166)](_0x576a28);}console[_0xf19ba(0x163)]('✅\x20SQL\x20ejecutado\x20correctamente');}catch(_0x336410){console[_0xf19ba(0x11d)](_0xf19ba(0x125),_0x336410[_0xf19ba(0x149)]);}finally{_0x215adf[_0xf19ba(0x16f)]();}},{create_update_of_the_database}=require(_0x25ce49(0x103)),createDatabase=async()=>{const _0x5e64da=_0x25ce49,_0x19cf59=await adminPool[_0x5e64da(0x166)](_0x5e64da(0x177));_0x19cf59[_0x5e64da(0x162)]===0x0?(await adminPool[_0x5e64da(0x166)](_0x5e64da(0x100)),importSQLFile(adminPool),console[_0x5e64da(0x163)](_0x5e64da(0x148))):(console['log'](_0x5e64da(0x14e)),await create_update_of_the_database(adminPool));};createDatabase();const pgPool=new pg[(_0x25ce49(0x17f))]({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress[_0x25ce49(0x175)](session({'secret':_0x25ce49(0x129),'resave':![],'saveUninitialized':![],'store':new(require(_0x25ce49(0x106))(session))({'pool':pgPool,'tableName':'session'})})),serverExpress[_0x25ce49(0x175)](flash()),serverExpress[_0x25ce49(0x175)](morgan('dev')),serverExpress[_0x25ce49(0x175)](express[_0x25ce49(0x120)]({'extended':![]})),serverExpress[_0x25ce49(0x175)](express[_0x25ce49(0x113)]()),serverExpress['use'](passport[_0x25ce49(0xf8)]()),serverExpress[_0x25ce49(0x175)](passport[_0x25ce49(0x114)]());const storageImages=multer[_0x25ce49(0x155)]({'destination':path[_0x25ce49(0x167)](__dirname,_0x25ce49(0x151)),'filename':(_0xabbcd8,_0x147e22,_0x135562)=>{const _0x3e8ea4=_0x25ce49;_0x135562(null,uuid()+path[_0x3e8ea4(0x10a)](_0x147e22[_0x3e8ea4(0x158)]));}});serverExpress[_0x25ce49(0x175)](multer({'storage':storageImages})['single']('image')),serverExpress[_0x25ce49(0x175)]((_0x5aaee5,_0x46527e,_0x4f9aeb)=>{const _0x3f81bb=_0x25ce49;serverExpress['locals']['success']=_0x5aaee5['flash'](_0x3f81bb(0x127)),serverExpress[_0x3f81bb(0x104)][_0x3f81bb(0x149)]=_0x5aaee5['flash'](_0x3f81bb(0x149)),serverExpress[_0x3f81bb(0x104)]['user']=_0x5aaee5[_0x3f81bb(0x12a)],serverExpress['locals'][_0x3f81bb(0x168)]=_0x5aaee5[_0x3f81bb(0x168)],serverExpress[_0x3f81bb(0x104)][_0x3f81bb(0x17b)]=0x0,serverExpress['locals'][_0x3f81bb(0x107)]=0x0,_0x4f9aeb();});const http=require('http'),serverSocket=http[_0x25ce49(0x174)](serverExpress),{Server}=require('socket.io'),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require(_0x25ce49(0x183));serverSocket['listen'](serverExpress[_0x25ce49(0x14d)](_0x25ce49(0x117)),()=>{const _0x2b34bc=_0x25ce49;console[_0x2b34bc(0x163)](_0x2b34bc(0x172)+serverExpress[_0x2b34bc(0x14d)](_0x2b34bc(0x117)));}),io['on'](_0x25ce49(0x130),async _0x2f37b9=>{const _0x1a1e04=_0x25ce49;console[_0x1a1e04(0x163)](_0x1a1e04(0x16a)),_0x2f37b9['on']('registerUser',async(_0xc9e9fb,_0x5493dc)=>{const _0x551745=_0x1a1e04,_0x229c77=connectedEmployees[_0x5493dc]||[],_0x4e44e2=_0x229c77[_0x551745(0x136)](_0x32d313=>_0x32d313['userId']===_0xc9e9fb);if(_0x4e44e2){_0x2f37b9[_0x551745(0xf6)]('connectionRejected',_0x551745(0x15f));return;}if(system!=_0x551745(0x176)){!companyLimitsCache[_0x5493dc]&&(companyLimitsCache[_0x5493dc]=await chat[_0x551745(0x12c)](_0x5493dc));const _0x5d0d2b=companyLimitsCache[_0x5493dc];if(_0x229c77[_0x551745(0x17c)]>=_0x5d0d2b){_0x2f37b9[_0x551745(0xf6)](_0x551745(0x13d),_0x551745(0x13f));return;}}_0x2f37b9[_0x551745(0x157)]=_0x5493dc,_0x229c77['push']({'userId':_0xc9e9fb,'socketId':_0x2f37b9['id']}),connectedEmployees[_0x5493dc]=_0x229c77;const _0x3c6ced=await chat['get_the_first_notification'](_0xc9e9fb,0xa);io['to'](_0xc9e9fb)['emit'](_0x551745(0x13a),{'notifications':_0x3c6ced});});async function _0xb2742c(_0x3a003a){const _0x4d30cb=_0x1a1e04,_0x3150bc=users[_0x3a003a];let _0x8d322e=_0x3150bc;!_0x3150bc&&(_0x8d322e=await chat[_0x4d30cb(0x12f)](toUserId));const _0x57f4c2={'canSend':_0x8d322e,'theUserIsConnect':_0x3150bc};return _0x57f4c2;}_0x2f37b9['on'](_0x1a1e04(0x10c),async({userEmail:_0x31dad3,toUserEmail:_0x3473e2,message:_0x155081})=>{const _0x1ba708=_0x1a1e04,_0x1b71d3=await _0xb2742c(_0x3473e2);_0x1b71d3[_0x1ba708(0xf7)]?await chat['create_notification'](_0x31dad3,_0x3473e2,_0x155081)?(_0x1b71d3[_0x1ba708(0xfe)]&&io['to'](recipientSocketId)[_0x1ba708(0xf6)]('privateMessage',{'userId':userId,'message':_0x155081}),_0x2f37b9[_0x1ba708(0xf6)](_0x1ba708(0x17e),{'success':!![],'message':_0x1ba708(0x11b)})):_0x2f37b9['emit'](_0x1ba708(0x17e),{'success':![],'message':_0x1ba708(0x102)+_0x3473e2+_0x1ba708(0x116)}):_0x2f37b9[_0x1ba708(0xf6)](_0x1ba708(0x17e),{'success':![],'message':_0x1ba708(0x12e)+_0x3473e2+_0x1ba708(0x101)});}),_0x2f37b9['on']('getTheFirstTenNotifications',async({userEmail:_0x1a2852})=>{const _0x1e552b=_0x1a1e04,_0x5bde76=await chat[_0x1e552b(0x16e)](_0x1a2852,0xa);io['to'](recipientSocketId)[_0x1e552b(0xf6)]('privateNotifications',{'notifications':_0x5bde76});}),_0x2f37b9['on'](_0x1a1e04(0x169),async({userId:_0x280862,toUserId:_0x384752,message:_0x48b462})=>{const _0x5ea4a8=_0x1a1e04,_0x3649d9=users[_0x384752];let _0x4e9c8c=_0x3649d9;!_0x3649d9&&(_0x4e9c8c=await chat['this_email_exist'](_0x384752));if(_0x4e9c8c){const _0x5e1d77=await chat[_0x5ea4a8(0x164)](_0x280862,_0x384752);await chat[_0x5ea4a8(0x146)](_0x5e1d77,_0x280862,_0x48b462)&&(_0x3649d9&&io['to'](_0x3649d9)[_0x5ea4a8(0xf6)]('privateMessage',{'userId':_0x280862,'message':_0x48b462})),_0x2f37b9['emit'](_0x5ea4a8(0x17e),{'success':!![],'message':_0x5ea4a8(0x133)});}else _0x2f37b9['emit'](_0x5ea4a8(0x17e),{'success':![],'message':_0x5ea4a8(0xf1)+_0x384752+_0x5ea4a8(0x156)});}),_0x2f37b9['on'](_0x1a1e04(0x14c),()=>{const _0x4c17e6=_0x1a1e04,{companyId:_0x2d372a}=_0x2f37b9;_0x2d372a&&connectedEmployees[_0x2d372a]?(connectedEmployees[_0x2d372a]=connectedEmployees[_0x2d372a]['filter'](_0x218ff4=>_0x218ff4[_0x4c17e6(0x161)]!==_0x2f37b9['id']),connectedEmployees[_0x2d372a]['length']===0x0&&delete connectedEmployees[_0x2d372a]):console[_0x4c17e6(0x163)](_0x4c17e6(0x110)+_0x2f37b9['id']+_0x4c17e6(0xfb));}),_0x2f37b9['on'](_0x1a1e04(0x182),_0x36fb94=>{const _0x3de815=_0x1a1e04;console[_0x3de815(0x163)](_0x3de815(0xf4),_0x36fb94),_0x2f37b9['broadcast'][_0x3de815(0xf6)](_0x3de815(0x132),_0x36fb94);}),_0x2f37b9['on'](_0x1a1e04(0x160),_0x2c05b6=>{const _0x39aef0=_0x1a1e04;_0x2f37b9[_0x39aef0(0xf6)]('getAllTheOrders',{'orderKitchen':orderKitchen});}),_0x2f37b9['on'](_0x1a1e04(0x11e),_0x3c478b=>{const _0x381a8f=_0x1a1e04,_0x5e126c=JSON[_0x381a8f(0x152)](_0x3c478b);_0x5e126c['id']=orderKitchen[_0x381a8f(0x17c)]+0x1,orderKitchen[_0x381a8f(0xff)](_0x5e126c);});});const companyName='/links';serverExpress[_0x25ce49(0x175)](require(_0x25ce49(0x170))),serverExpress[_0x25ce49(0x175)](require(_0x25ce49(0x13e))),serverExpress[_0x25ce49(0x175)](companyName,require('./router/links'));const routesPath=path[_0x25ce49(0x167)](__dirname,'router/links');function _0x2348(){const _0x37f76e=['pack_company','length','isFile','messageStatus','Pool','1919530RgqLlm','uuid','sendNotification','./services/chat.js','./keys','Este\x20email\x20\x27','Server\x20running\x20on\x20http://','105XIFord','Nueva\x20notificación:','utf8','emit','canSend','initialize','edplus.sql','82043HhIbyI','\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.','🔐\x20ENCRYPTION_KEY\x20ya\x20existe\x20en\x20.env','12398892eDxbso','theUserIsConnect','push','CREATE\x20DATABASE\x20edplus','\x27\x20no\x20existe.\x20🤔','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27','./characterDatabase','locals','IPv4','connect-pg-simple','pack_branch','27KJPHkz','../.env','extname','./lib/passport','sendNotificationToUser','engine','.js','passport','Socket\x20','writeFileSync','multer','json','session','set','\x27.\x20Inténtalo\x20de\x20nuevo.\x20😳','port','env','readdirSync','./lib/editFrom','Mensaje\x20enviado\x20con\x20éxito.\x20👌','resolve','error','saveANewOrder','22346XeWLOn','urlencoded','split','crypto','express-recaptcha','existsSync','❌\x20Error\x20ejecutando\x20SQL:','views','success','PORT','FudSession','user','view\x20engine','get_max_employee_of_this_company','partials','El\x20usuario\x20\x27','this_email_exist','connection','9WCdSpM','newNotification','Mensaje\x20enviado\x20con\x20éxito','connect','.hbs','some','0.0.0.0','data','static','privateNotifications','127.0.0.1','init','connectionRejected','./router/authentication','Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20límite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresía.','178760AxLxFY','./lib/handlebars','public','express-session','connect-flash','forEach','send_new_message','endsWith','📦\x20Base\x20de\x20datos\x20EDPLUS\x20creada','message','filter','readFileSync','disconnect','get','📂\x20La\x20base\x20de\x20datos\x20EDPLUS\x20ya\x20existe,\x20no\x20se\x20creó\x20nuevamente.','ENCRYPTION_KEY=','hex','public/img/uploads','parse','dotenv','express','diskStorage','\x27\x20no\x20existe\x20🤔','companyId','originalname','trim','layouts','morgan','database','family','includes','Ups,\x20parece\x20que\x20ya\x20estás\x20conectado\x20en\x20otro\x20dispositivo.','sendAllTheOrders','socketId','rowCount','log','create_new_chat','map','query','join','company','sendMessageToUser','Un\x20usuario\x20se\x20ha\x20conectado','toString','2396970rlSgTs','randomBytes','get_the_first_notification','release','./router','1822980HcZxKw','Server\x20running\x20on\x20port\x20','path','createServer','use','desktop','SELECT\x201\x20FROM\x20pg_database\x20WHERE\x20datname\x20=\x20\x27edplus\x27','address','\x0aENCRYPTION_KEY=','4pxbftL'];_0x2348=function(){return _0x37f76e;};return _0x2348();}fs[_0x25ce49(0x119)](routesPath)[_0x25ce49(0x145)](_0x4aadb4=>{const _0x50de30=_0x25ce49,_0x1f50c0=path[_0x50de30(0x167)](routesPath,_0x4aadb4);fs['statSync'](_0x1f50c0)[_0x50de30(0x17d)]()&&_0x4aadb4[_0x50de30(0x147)](_0x50de30(0x10e))&&serverExpress[_0x50de30(0x175)](companyName,require(_0x1f50c0));}),serverExpress[_0x25ce49(0x175)](require('./lib/addFrom')),serverExpress[_0x25ce49(0x175)](express[_0x25ce49(0x139)](path['join'](__dirname,_0x25ce49(0x142))));function _0x1281(_0x3dd667,_0x467459){const _0x2348dd=_0x2348();return _0x1281=function(_0x12818b,_0x16b0c8){_0x12818b=_0x12818b-0xf1;let _0x3ef6b2=_0x2348dd[_0x12818b];return _0x3ef6b2;},_0x1281(_0x3dd667,_0x467459);}const os=require('os');function getLocalIP(){const _0x4c6e90=_0x25ce49,_0x4b2429=os['networkInterfaces']();for(let _0x1e5684 in _0x4b2429){for(let _0x504a57=0x0;_0x504a57<_0x4b2429[_0x1e5684]['length'];_0x504a57++){const _0x5e919c=_0x4b2429[_0x1e5684][_0x504a57];if(_0x5e919c[_0x4c6e90(0x15d)]===_0x4c6e90(0x105)&&!_0x5e919c['internal'])return _0x5e919c[_0x4c6e90(0x178)];}}return _0x4c6e90(0x13b);}serverExpress['listen'](serverExpress[_0x25ce49(0x14d)](_0x25ce49(0x117)),_0x25ce49(0x137),()=>{const _0xdbd998=_0x25ce49;console['log'](_0xdbd998(0xf2)+getLocalIP()+':'+serverExpress[_0xdbd998(0x14d)](_0xdbd998(0x117)));});