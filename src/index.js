const _0x3b8ec2=_0x4c99;(function(_0x58f78b,_0x1c431b){const _0x5db99f=_0x4c99,_0x212d37=_0x58f78b();while(!![]){try{const _0x547122=-parseInt(_0x5db99f(0x181))/0x1+parseInt(_0x5db99f(0x1d6))/0x2*(-parseInt(_0x5db99f(0x1a8))/0x3)+parseInt(_0x5db99f(0x1e9))/0x4*(-parseInt(_0x5db99f(0x1e3))/0x5)+-parseInt(_0x5db99f(0x1bf))/0x6+parseInt(_0x5db99f(0x1cd))/0x7*(-parseInt(_0x5db99f(0x19a))/0x8)+parseInt(_0x5db99f(0x1d2))/0x9*(parseInt(_0x5db99f(0x1aa))/0xa)+parseInt(_0x5db99f(0x1c6))/0xb;if(_0x547122===_0x1c431b)break;else _0x212d37['push'](_0x212d37['shift']());}catch(_0x1ab506){_0x212d37['push'](_0x212d37['shift']());}}}(_0x19dd,0xd7e0a));const system=require(_0x3b8ec2(0x19d)),express=require(_0x3b8ec2(0x1e2)),morgan=require(_0x3b8ec2(0x1df)),{engine}=require('express-handlebars'),multer=require(_0x3b8ec2(0x1d4)),flash=require(_0x3b8ec2(0x1f0)),session=require(_0x3b8ec2(0x187)),passport=require('passport'),{database}=require('./keys'),{v4:uuid}=require(_0x3b8ec2(0x199)),path=require(_0x3b8ec2(0x192)),{RecaptchaV2}=require('express-recaptcha'),serverExpress=express();require(_0x3b8ec2(0x191)),require(_0x3b8ec2(0x1c1)),serverExpress[_0x3b8ec2(0x1a1)](_0x3b8ec2(0x19b),process[_0x3b8ec2(0x1db)][_0x3b8ec2(0x1b8)]||0xfa0),serverExpress[_0x3b8ec2(0x1a1)](_0x3b8ec2(0x185),path[_0x3b8ec2(0x1d9)](__dirname,_0x3b8ec2(0x185))),serverExpress[_0x3b8ec2(0x1b5)](_0x3b8ec2(0x1ce),engine({'defaultLayout':_0x3b8ec2(0x186),'layoutsDir':path['join'](serverExpress[_0x3b8ec2(0x196)]('views'),'layouts'),'partialsDir':path['join'](serverExpress[_0x3b8ec2(0x196)](_0x3b8ec2(0x185)),_0x3b8ec2(0x1c3)),'extname':_0x3b8ec2(0x1ce),'helpers':require(_0x3b8ec2(0x1e7))})),serverExpress[_0x3b8ec2(0x1a1)](_0x3b8ec2(0x17f),_0x3b8ec2(0x1ce)),require('dotenv')[_0x3b8ec2(0x1cf)]();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process[_0x3b8ec2(0x1db)],pg=require('pg'),pgPool=new pg[(_0x3b8ec2(0x1d1))]({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress[_0x3b8ec2(0x17b)](session({'secret':_0x3b8ec2(0x1ae),'resave':![],'saveUninitialized':![],'store':new(require(_0x3b8ec2(0x197))(session))({'pool':pgPool,'tableName':_0x3b8ec2(0x1a5)})})),serverExpress[_0x3b8ec2(0x17b)](flash()),serverExpress[_0x3b8ec2(0x17b)](morgan(_0x3b8ec2(0x198))),serverExpress[_0x3b8ec2(0x17b)](express['urlencoded']({'extended':![]})),serverExpress['use'](express[_0x3b8ec2(0x1ed)]()),serverExpress['use'](passport[_0x3b8ec2(0x1c5)]()),serverExpress['use'](passport[_0x3b8ec2(0x1a5)]());function _0x4c99(_0x4cc66b,_0x110bd8){const _0x19dd6a=_0x19dd();return _0x4c99=function(_0x4c99ed,_0x4065ea){_0x4c99ed=_0x4c99ed-0x179;let _0x25749a=_0x19dd6a[_0x4c99ed];return _0x25749a;},_0x4c99(_0x4cc66b,_0x110bd8);}const storage=multer['diskStorage']({'destination':path[_0x3b8ec2(0x1d9)](__dirname,'public/img/uploads'),'filename':(_0x3e6cfc,_0x188729,_0x54342c,_0x402506)=>{const _0x67e42e=_0x3b8ec2;_0x54342c(null,uuid()+path[_0x67e42e(0x1af)](_0x188729[_0x67e42e(0x18b)]));}});serverExpress['use'](multer({'storage':storage})[_0x3b8ec2(0x1e6)](_0x3b8ec2(0x18f))),serverExpress[_0x3b8ec2(0x17b)]((_0x4b26fe,_0x4501f6,_0x22a3de)=>{const _0x11e8bd=_0x3b8ec2;serverExpress[_0x11e8bd(0x1d7)]['success']=_0x4b26fe['flash'](_0x11e8bd(0x1b3)),serverExpress[_0x11e8bd(0x1d7)]['message']=_0x4b26fe[_0x11e8bd(0x1b7)](_0x11e8bd(0x19c)),serverExpress[_0x11e8bd(0x1d7)]['user']=_0x4b26fe[_0x11e8bd(0x1b0)],serverExpress[_0x11e8bd(0x1d7)][_0x11e8bd(0x179)]=_0x4b26fe[_0x11e8bd(0x179)],serverExpress[_0x11e8bd(0x1d7)][_0x11e8bd(0x1e8)]=0x0,serverExpress['locals'][_0x11e8bd(0x1a0)]=0x0,_0x22a3de();});const http=require('http'),serverSocket=http[_0x3b8ec2(0x1da)](serverExpress),{Server}=require(_0x3b8ec2(0x1c8)),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require(_0x3b8ec2(0x19e));serverSocket['listen'](serverExpress[_0x3b8ec2(0x196)](_0x3b8ec2(0x19b)),()=>{const _0x3f3455=_0x3b8ec2;console[_0x3f3455(0x17d)]('Server\x20running\x20on\x20port\x20'+serverExpress[_0x3f3455(0x196)]('port'));}),io['on'](_0x3b8ec2(0x1e4),async _0x56eba5=>{const _0x2533c1=_0x3b8ec2;console[_0x2533c1(0x17d)](_0x2533c1(0x18d)),_0x56eba5['on'](_0x2533c1(0x1b1),async(_0x3d0b1b,_0x577a0c)=>{const _0x553684=_0x2533c1,_0x499d0d=connectedEmployees[_0x577a0c]||[],_0x456230=_0x499d0d[_0x553684(0x1ba)](_0x220071=>_0x220071[_0x553684(0x1ea)]===_0x3d0b1b);if(_0x456230){_0x56eba5['emit'](_0x553684(0x17e),_0x553684(0x18c));return;}if(system!='desktop'){!companyLimitsCache[_0x577a0c]&&(companyLimitsCache[_0x577a0c]=await chat[_0x553684(0x1be)](_0x577a0c));const _0x5dd182=companyLimitsCache[_0x577a0c];if(_0x499d0d[_0x553684(0x18a)]>=_0x5dd182){_0x56eba5[_0x553684(0x1a4)](_0x553684(0x17e),_0x553684(0x180));return;}}_0x56eba5['companyId']=_0x577a0c,_0x499d0d[_0x553684(0x17a)]({'userId':_0x3d0b1b,'socketId':_0x56eba5['id']}),connectedEmployees[_0x577a0c]=_0x499d0d;const _0x57d219=await chat['get_the_first_notification'](_0x3d0b1b,0xa);io['to'](_0x3d0b1b)[_0x553684(0x1a4)](_0x553684(0x1c2),{'notifications':_0x57d219});});async function _0x23847e(_0x45d8af){const _0x3f7499=_0x2533c1,_0x1abf03=users[_0x45d8af];let _0x18c910=_0x1abf03;!_0x1abf03&&(_0x18c910=await chat[_0x3f7499(0x1dd)](toUserId));const _0x155364={'canSend':_0x18c910,'theUserIsConnect':_0x1abf03};return _0x155364;}_0x56eba5['on'](_0x2533c1(0x183),async({userEmail:_0x1159ef,toUserEmail:_0x117913,message:_0x4640b8})=>{const _0xf04d32=_0x2533c1,_0x4fe6d9=await _0x23847e(_0x117913);_0x4fe6d9[_0xf04d32(0x1b6)]?await chat[_0xf04d32(0x189)](_0x1159ef,_0x117913,_0x4640b8)?(_0x4fe6d9[_0xf04d32(0x1ec)]&&io['to'](recipientSocketId)[_0xf04d32(0x1a4)](_0xf04d32(0x1de),{'userId':userId,'message':_0x4640b8}),_0x56eba5['emit']('messageStatus',{'success':!![],'message':_0xf04d32(0x1e0)})):_0x56eba5['emit'](_0xf04d32(0x1cb),{'success':![],'message':_0xf04d32(0x19f)+_0x117913+_0xf04d32(0x1a3)}):_0x56eba5[_0xf04d32(0x1a4)](_0xf04d32(0x1cb),{'success':![],'message':_0xf04d32(0x1a2)+_0x117913+_0xf04d32(0x1a9)});}),_0x56eba5['on']('getTheFirstTenNotifications',async({userEmail:_0x476d93})=>{const _0x52a260=_0x2533c1,_0x3706b5=await chat[_0x52a260(0x1b2)](_0x476d93,0xa);io['to'](recipientSocketId)[_0x52a260(0x1a4)](_0x52a260(0x1c2),{'notifications':_0x3706b5});}),_0x56eba5['on'](_0x2533c1(0x1bd),async({userId:_0xb95eae,toUserId:_0x4b3d6a,message:_0x1ca215})=>{const _0x5f17de=_0x2533c1,_0x29b4e8=users[_0x4b3d6a];let _0x89fda5=_0x29b4e8;!_0x29b4e8&&(_0x89fda5=await chat[_0x5f17de(0x1dd)](_0x4b3d6a));if(_0x89fda5){const _0x5da284=await chat['create_new_chat'](_0xb95eae,_0x4b3d6a);await chat['send_new_message'](_0x5da284,_0xb95eae,_0x1ca215)&&(_0x29b4e8&&io['to'](_0x29b4e8)[_0x5f17de(0x1a4)](_0x5f17de(0x1de),{'userId':_0xb95eae,'message':_0x1ca215})),_0x56eba5['emit']('messageStatus',{'success':!![],'message':'Mensaje\x20enviado\x20con\x20éxito'});}else _0x56eba5[_0x5f17de(0x1a4)](_0x5f17de(0x1cb),{'success':![],'message':_0x5f17de(0x1b4)+_0x4b3d6a+_0x5f17de(0x1d3)});}),_0x56eba5['on'](_0x2533c1(0x1e1),()=>{const _0x3cc429=_0x2533c1,{companyId:_0x119963}=_0x56eba5;_0x119963&&connectedEmployees[_0x119963]?(connectedEmployees[_0x119963]=connectedEmployees[_0x119963]['filter'](_0x1f8b9d=>_0x1f8b9d[_0x3cc429(0x1c9)]!==_0x56eba5['id']),connectedEmployees[_0x119963][_0x3cc429(0x18a)]===0x0&&delete connectedEmployees[_0x119963]):console[_0x3cc429(0x17d)](_0x3cc429(0x1ee)+_0x56eba5['id']+_0x3cc429(0x1eb));}),_0x56eba5['on'](_0x2533c1(0x188),_0x1715ae=>{const _0x24cfc9=_0x2533c1;console[_0x24cfc9(0x17d)](_0x24cfc9(0x193),_0x1715ae),_0x56eba5[_0x24cfc9(0x1d5)][_0x24cfc9(0x1a4)](_0x24cfc9(0x17c),_0x1715ae);}),_0x56eba5['on']('sendAllTheOrders',_0x50ed9b=>{const _0x1682be=_0x2533c1;_0x56eba5[_0x1682be(0x1a4)](_0x1682be(0x1c0),{'orderKitchen':orderKitchen});}),_0x56eba5['on'](_0x2533c1(0x1ac),_0x438316=>{const _0x547232=_0x2533c1,_0x5d6969=JSON[_0x547232(0x1d0)](_0x438316);_0x5d6969['id']=orderKitchen[_0x547232(0x18a)]+0x1,orderKitchen['push'](_0x5d6969);});});const companyName='/links';serverExpress[_0x3b8ec2(0x17b)](require(_0x3b8ec2(0x184))),serverExpress['use'](require(_0x3b8ec2(0x1ca))),serverExpress['use'](companyName,require(_0x3b8ec2(0x1bb))),serverExpress[_0x3b8ec2(0x17b)](companyName,require(_0x3b8ec2(0x1d8))),serverExpress['use'](companyName,require(_0x3b8ec2(0x1cc))),serverExpress[_0x3b8ec2(0x17b)](companyName,require(_0x3b8ec2(0x1c7))),serverExpress['use'](companyName,require('./router/links/subscription')),serverExpress[_0x3b8ec2(0x17b)](companyName,require(_0x3b8ec2(0x194))),serverExpress[_0x3b8ec2(0x17b)](companyName,require('./router/links/delivery')),serverExpress[_0x3b8ec2(0x17b)](companyName,require('./router/links/app')),serverExpress[_0x3b8ec2(0x17b)](companyName,require('./router/links/CRM')),serverExpress[_0x3b8ec2(0x17b)](companyName,require(_0x3b8ec2(0x18e))),serverExpress[_0x3b8ec2(0x17b)](companyName,require(_0x3b8ec2(0x182))),serverExpress[_0x3b8ec2(0x17b)](companyName,require(_0x3b8ec2(0x1b9))),serverExpress['use'](companyName,require('./router/links/orders')),serverExpress['use'](companyName,require(_0x3b8ec2(0x1a6))),serverExpress[_0x3b8ec2(0x17b)](require(_0x3b8ec2(0x1ab))),serverExpress[_0x3b8ec2(0x17b)](express[_0x3b8ec2(0x195)](path[_0x3b8ec2(0x1d9)](__dirname,_0x3b8ec2(0x1bc))));function _0x19dd(){const _0x4013e4=['connectionRejected','view\x20engine','Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20límite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresía.','876782AIohVJ','./router/links/boutique','sendNotificationToUser','./router','views','main','express-session','sendNotification','create_notification','length','originalname','Ups,\x20parece\x20que\x20ya\x20estás\x20conectado\x20en\x20otro\x20dispositivo.','Un\x20usuario\x20se\x20ha\x20conectado','./router/links/desktop','image','127.0.0.1','./lib/passport','path','Nueva\x20notificación:','./router/links/store','static','get','connect-pg-simple','dev','uuid','8EUxQaz','port','message','./lib/system','./services/chat.js','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27','pack_branch','set','El\x20usuario\x20\x27','\x27.\x20Inténtalo\x20de\x20nuevo.\x20😳','emit','session','./router/links/prescription','address','57ahzVtE','\x27\x20no\x20existe.\x20🤔','76610bqBJPz','./lib/addFrom','saveANewOrder','Server\x20running\x20on\x20http://','FudSession','extname','user','registerUser','get_the_first_notification','success','Este\x20email\x20\x27','engine','canSend','flash','PORT','./router/links/cashCut','some','./router/links','public','sendMessageToUser','get_max_employee_of_this_company','9752922AqSKpi','getAllTheOrders','./lib/editFrom','privateNotifications','partials','internal','initialize','74618720MbzwuU','./router/links/branch','socket.io','socketId','./router/authentication','messageStatus','./router/links/ceo','12109867bAqCJL','.hbs','config','parse','Pool','36oVHxKA','\x27\x20no\x20existe\x20🤔','multer','broadcast','19568JozvMo','locals','./router/links/fudone','join','createServer','env','family','this_email_exist','privateMessage','morgan','Mensaje\x20enviado\x20con\x20éxito.\x20👌','disconnect','express','20enVcno','connection','networkInterfaces','single','./lib/handlebars','pack_company','1511784RgkbGB','userId','\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.','theUserIsConnect','json','Socket\x20','0.0.0.0','connect-flash','company','push','use','newNotification','log'];_0x19dd=function(){return _0x4013e4;};return _0x19dd();}const os=require('os');function getLocalIP(){const _0x2f7ee2=_0x3b8ec2,_0x331062=os[_0x2f7ee2(0x1e5)]();for(let _0x5a849a in _0x331062){for(let _0x481421=0x0;_0x481421<_0x331062[_0x5a849a][_0x2f7ee2(0x18a)];_0x481421++){const _0x1bd9ac=_0x331062[_0x5a849a][_0x481421];if(_0x1bd9ac[_0x2f7ee2(0x1dc)]==='IPv4'&&!_0x1bd9ac[_0x2f7ee2(0x1c4)])return _0x1bd9ac[_0x2f7ee2(0x1a7)];}}return _0x2f7ee2(0x190);}serverExpress['listen'](serverExpress[_0x3b8ec2(0x196)]('port'),_0x3b8ec2(0x1ef),()=>{const _0x82297c=_0x3b8ec2;console[_0x82297c(0x17d)](_0x82297c(0x1ad)+getLocalIP()+':'+serverExpress['get'](_0x82297c(0x19b)));});