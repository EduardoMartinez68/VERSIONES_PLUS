const _0x4a339b=_0x61e0;(function(_0x21ac10,_0x4104d3){const _0x49109c=_0x61e0,_0x337009=_0x21ac10();while(!![]){try{const _0x2c06af=-parseInt(_0x49109c(0x207))/0x1*(-parseInt(_0x49109c(0x1cb))/0x2)+-parseInt(_0x49109c(0x21c))/0x3+parseInt(_0x49109c(0x233))/0x4*(parseInt(_0x49109c(0x1b9))/0x5)+parseInt(_0x49109c(0x1b3))/0x6*(-parseInt(_0x49109c(0x222))/0x7)+parseInt(_0x49109c(0x208))/0x8+parseInt(_0x49109c(0x1c6))/0x9*(-parseInt(_0x49109c(0x1ee))/0xa)+-parseInt(_0x49109c(0x226))/0xb*(-parseInt(_0x49109c(0x1f2))/0xc);if(_0x2c06af===_0x4104d3)break;else _0x337009['push'](_0x337009['shift']());}catch(_0x122fd2){_0x337009['push'](_0x337009['shift']());}}}(_0x1510,0x30f28));const system=require(_0x4a339b(0x1d9)),express=require(_0x4a339b(0x1c5)),morgan=require(_0x4a339b(0x1f9)),{engine}=require(_0x4a339b(0x221)),multer=require('multer'),flash=require(_0x4a339b(0x22e)),session=require(_0x4a339b(0x21e)),passport=require('passport'),{database}=require(_0x4a339b(0x22c)),{v4:uuid}=require('uuid'),path=require('path'),{RecaptchaV2}=require('express-recaptcha'),nodePersist=require(_0x4a339b(0x21b));nodePersist[_0x4a339b(0x224)]({'dir':path[_0x4a339b(0x1ef)](__dirname,'data')});const serverExpress=express();require('./lib/passport'),require('./lib/editFrom'),serverExpress[_0x4a339b(0x1d4)](_0x4a339b(0x1f6),process['env'][_0x4a339b(0x206)]||0xfa0),serverExpress[_0x4a339b(0x1d4)](_0x4a339b(0x1e1),path['join'](__dirname,_0x4a339b(0x1e1))),serverExpress[_0x4a339b(0x1ae)](_0x4a339b(0x1b1),engine({'defaultLayout':'main','layoutsDir':path[_0x4a339b(0x1ef)](serverExpress[_0x4a339b(0x20f)](_0x4a339b(0x1e1)),'layouts'),'partialsDir':path[_0x4a339b(0x1ef)](serverExpress[_0x4a339b(0x20f)](_0x4a339b(0x1e1)),_0x4a339b(0x22a)),'extname':'.hbs','helpers':require('./lib/handlebars')})),serverExpress[_0x4a339b(0x1d4)]('view\x20engine',_0x4a339b(0x1b1));function _0x1510(){const _0x37545=['Un\x20usuario\x20se\x20ha\x20conectado','this_email_exist','partials','create_new_chat','./keys','/links','connect-flash','FudSession','./characterDatabase','\x27\x20no\x20existe.\x20ðŸ¤”','query','1114816eSFFua','getTheFirstTenNotifications','utf8','Server\x20running\x20on\x20http://','dev','engine','listen','map','.hbs','saveANewOrder','666294LyGudi','./lib/addFrom','connect','parse','0.0.0.0','internal','5jFNNas','statSync','edplus.sql','getAllTheOrders','ðŸ”\x20ENCRYPTION_KEY\x20ya\x20existe\x20en\x20.env','connect-pg-simple','resolve','static','postgres','locals','diskStorage','./router/links','express','9XOJxwW','Socket\x20','forEach','El\x20usuario\x20\x27','pack_company','752rwItUW','ðŸ“¦\x20Base\x20de\x20datos\x20EDPLUS\x20creada','./router','router/links','127.0.0.1','networkInterfaces','ENCRYPTION_KEY=','split','push','set','some','Ups,\x20parece\x20que\x20ya\x20estÃ¡s\x20conectado\x20en\x20otro\x20dispositivo.','createServer','Nueva\x20notificaciÃ³n:','./lib/system','filter','\x27\x20no\x20existe\x20ðŸ¤”','theUserIsConnect','env','json','isFile','readFileSync','views','includes','sendNotification','pack_branch','disconnect','success','message','log','existsSync','use','socket.io','canSend','connection','391120LkgRFZ','join','flash','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27','74964hIDBgw','âœ…\x20SQL\x20ejecutado\x20correctamente','registerUser','socketId','port','privateMessage','toString','morgan','writeFileSync','emit','Server\x20running\x20on\x20port\x20','\x27.\x20IntÃ©ntalo\x20de\x20nuevo.\x20ðŸ˜³','sendMessageToUser','urlencoded','user','Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20lÃ­mite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresÃ­a.','userId','Pool','create_notification','trim','PORT','1061DECROQ','202496XVmcjh','\x0aENCRYPTION_KEY=','./services/chat.js','messageStatus','ðŸ“‚\x20La\x20base\x20de\x20datos\x20EDPLUS\x20ya\x20existe,\x20no\x20se\x20creÃ³\x20nuevamente.','length','privateNotifications','get','get_max_employee_of_this_company','dotenv','config','readdirSync','get_the_first_notification','public','newNotification','company','initialize','companyId','hex','node-persist','1075650sTNLLq','session','express-session','broadcast','rowCount','express-handlebars','7PhiYYN','\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.','init','crypto','11vCyLPc','family'];_0x1510=function(){return _0x37545;};return _0x1510();}function _0x61e0(_0x5be0fb,_0x4d6942){const _0x151082=_0x1510();return _0x61e0=function(_0x61e03a,_0x111003){_0x61e03a=_0x61e03a-0x1aa;let _0x2ece83=_0x151082[_0x61e03a];return _0x2ece83;},_0x61e0(_0x5be0fb,_0x4d6942);}const fs=require('fs'),crypto=require(_0x4a339b(0x225)),envPath=path[_0x4a339b(0x1bf)](__dirname,'../.env');let envContent=fs[_0x4a339b(0x1e9)](envPath)?fs[_0x4a339b(0x1e0)](envPath,_0x4a339b(0x1ab)):'';if(!envContent[_0x4a339b(0x1e2)](_0x4a339b(0x1d1))){const newKey=crypto['randomBytes'](0x20)[_0x4a339b(0x1f8)](_0x4a339b(0x21a));envContent+=_0x4a339b(0x209)+newKey+'\x0a',fs[_0x4a339b(0x1fa)](envPath,envContent),console[_0x4a339b(0x1e8)]('âœ…\x20ENCRYPTION_KEY\x20generado\x20y\x20guardado\x20en\x20.env');}else console['log'](_0x4a339b(0x1bd));require(_0x4a339b(0x211))[_0x4a339b(0x212)]();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process[_0x4a339b(0x1dd)],pg=require('pg'),adminPool=new pg['Pool']({'user':APP_PG_USER,'host':APP_PG_HOST,'password':APP_PG_PASSWORD,'port':APP_PG_PORT,'database':APP_PG_DATABASE}),importSQLFile=async _0x148cf5=>{const _0x938079=_0x4a339b,_0x3ad948=path['join'](__dirname,'database',_0x938079(0x1bb)),_0x55d1d1=fs[_0x938079(0x1e0)](_0x3ad948,_0x938079(0x1ab)),_0xd679a1=_0x55d1d1[_0x938079(0x1d2)](/;\s*$/m)[_0x938079(0x1b0)](_0x20b6b8=>_0x20b6b8[_0x938079(0x205)]())[_0x938079(0x1da)](_0x2bcc85=>_0x2bcc85['length']>0x0),_0xa8deb8=await _0x148cf5[_0x938079(0x1b5)]();try{for(const _0x1a2cd0 of _0xd679a1){await _0xa8deb8['query'](_0x1a2cd0);}console[_0x938079(0x1e8)](_0x938079(0x1f3));}catch(_0x55e64c){console['error']('âŒ\x20Error\x20ejecutando\x20SQL:',_0x55e64c[_0x938079(0x1e7)]);}finally{_0xa8deb8['release']();}},{create_update_of_the_database}=require(_0x4a339b(0x230)),createDatabase=async()=>{const _0x96f4d1=_0x4a339b,_0x1f611c=await adminPool['query']('SELECT\x201\x20FROM\x20pg_database\x20WHERE\x20datname\x20=\x20\x27edplus\x27');_0x1f611c[_0x96f4d1(0x220)]===0x0?(await adminPool[_0x96f4d1(0x232)]('CREATE\x20DATABASE\x20edplus'),importSQLFile(adminPool),console[_0x96f4d1(0x1e8)](_0x96f4d1(0x1cc))):(console[_0x96f4d1(0x1e8)](_0x96f4d1(0x20c)),await create_update_of_the_database(adminPool));};createDatabase();const pgPool=new pg[(_0x4a339b(0x203))]({'user':APP_PG_USER,'host':APP_PG_HOST,'database':_0x4a339b(0x1c1),'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress[_0x4a339b(0x1ea)](session({'secret':_0x4a339b(0x22f),'resave':![],'saveUninitialized':![],'store':new(require(_0x4a339b(0x1be))(session))({'pool':pgPool,'tableName':_0x4a339b(0x21d)})})),serverExpress['use'](flash()),serverExpress['use'](morgan(_0x4a339b(0x1ad))),serverExpress['use'](express[_0x4a339b(0x1ff)]({'extended':![]})),serverExpress[_0x4a339b(0x1ea)](express[_0x4a339b(0x1de)]()),serverExpress[_0x4a339b(0x1ea)](passport[_0x4a339b(0x218)]()),serverExpress[_0x4a339b(0x1ea)](passport[_0x4a339b(0x21d)]());const storageImages=multer[_0x4a339b(0x1c3)]({'destination':path[_0x4a339b(0x1ef)](__dirname,'public/img/uploads'),'filename':(_0x37fd22,_0x108f72,_0xaed127)=>{_0xaed127(null,uuid()+path['extname'](_0x108f72['originalname']));}});serverExpress[_0x4a339b(0x1ea)](multer({'storage':storageImages})['single']('image')),serverExpress[_0x4a339b(0x1ea)]((_0x3d917c,_0x2a2f6e,_0x10643f)=>{const _0x3d3f5a=_0x4a339b;serverExpress[_0x3d3f5a(0x1c2)][_0x3d3f5a(0x1e6)]=_0x3d917c[_0x3d3f5a(0x1f0)](_0x3d3f5a(0x1e6)),serverExpress[_0x3d3f5a(0x1c2)]['message']=_0x3d917c[_0x3d3f5a(0x1f0)]('message'),serverExpress[_0x3d3f5a(0x1c2)][_0x3d3f5a(0x200)]=_0x3d917c['user'],serverExpress[_0x3d3f5a(0x1c2)][_0x3d3f5a(0x217)]=_0x3d917c[_0x3d3f5a(0x217)],serverExpress[_0x3d3f5a(0x1c2)][_0x3d3f5a(0x1ca)]=0x0,serverExpress[_0x3d3f5a(0x1c2)][_0x3d3f5a(0x1e4)]=0x0,_0x10643f();});const http=require('http'),serverSocket=http[_0x4a339b(0x1d7)](serverExpress),{Server}=require(_0x4a339b(0x1eb)),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require(_0x4a339b(0x20a));serverSocket[_0x4a339b(0x1af)](serverExpress[_0x4a339b(0x20f)](_0x4a339b(0x1f6)),()=>{const _0x37346b=_0x4a339b;console[_0x37346b(0x1e8)](_0x37346b(0x1fc)+serverExpress[_0x37346b(0x20f)](_0x37346b(0x1f6)));}),io['on'](_0x4a339b(0x1ed),async _0x47f3da=>{const _0x1a6d71=_0x4a339b;console['log'](_0x1a6d71(0x228)),_0x47f3da['on'](_0x1a6d71(0x1f4),async(_0xd6294f,_0x3ed9cc)=>{const _0x1dceec=_0x1a6d71,_0x42e755=connectedEmployees[_0x3ed9cc]||[],_0x2860b3=_0x42e755[_0x1dceec(0x1d5)](_0x5b1cd0=>_0x5b1cd0[_0x1dceec(0x202)]===_0xd6294f);if(_0x2860b3){_0x47f3da[_0x1dceec(0x1fb)]('connectionRejected',_0x1dceec(0x1d6));return;}if(system!='desktop'){!companyLimitsCache[_0x3ed9cc]&&(companyLimitsCache[_0x3ed9cc]=await chat[_0x1dceec(0x210)](_0x3ed9cc));const _0x5ae519=companyLimitsCache[_0x3ed9cc];if(_0x42e755[_0x1dceec(0x20d)]>=_0x5ae519){_0x47f3da[_0x1dceec(0x1fb)]('connectionRejected',_0x1dceec(0x201));return;}}_0x47f3da[_0x1dceec(0x219)]=_0x3ed9cc,_0x42e755[_0x1dceec(0x1d3)]({'userId':_0xd6294f,'socketId':_0x47f3da['id']}),connectedEmployees[_0x3ed9cc]=_0x42e755;const _0x16c761=await chat[_0x1dceec(0x214)](_0xd6294f,0xa);io['to'](_0xd6294f)[_0x1dceec(0x1fb)](_0x1dceec(0x20e),{'notifications':_0x16c761});});async function _0x27826f(_0x34f65b){const _0x27cfd5=users[_0x34f65b];let _0x1b359d=_0x27cfd5;!_0x27cfd5&&(_0x1b359d=await chat['this_email_exist'](toUserId));const _0x4eb90d={'canSend':_0x1b359d,'theUserIsConnect':_0x27cfd5};return _0x4eb90d;}_0x47f3da['on']('sendNotificationToUser',async({userEmail:_0x1c9b55,toUserEmail:_0x35a92f,message:_0x471008})=>{const _0x481b6a=_0x1a6d71,_0x5083b5=await _0x27826f(_0x35a92f);_0x5083b5[_0x481b6a(0x1ec)]?await chat[_0x481b6a(0x204)](_0x1c9b55,_0x35a92f,_0x471008)?(_0x5083b5[_0x481b6a(0x1dc)]&&io['to'](recipientSocketId)[_0x481b6a(0x1fb)]('privateMessage',{'userId':userId,'message':_0x471008}),_0x47f3da[_0x481b6a(0x1fb)](_0x481b6a(0x20b),{'success':!![],'message':'Mensaje\x20enviado\x20con\x20Ã©xito.\x20ðŸ‘Œ'})):_0x47f3da[_0x481b6a(0x1fb)](_0x481b6a(0x20b),{'success':![],'message':_0x481b6a(0x1f1)+_0x35a92f+_0x481b6a(0x1fd)}):_0x47f3da[_0x481b6a(0x1fb)]('messageStatus',{'success':![],'message':_0x481b6a(0x1c9)+_0x35a92f+_0x481b6a(0x231)});}),_0x47f3da['on'](_0x1a6d71(0x1aa),async({userEmail:_0x3be061})=>{const _0x3b6b55=_0x1a6d71,_0x288cbc=await chat[_0x3b6b55(0x214)](_0x3be061,0xa);io['to'](recipientSocketId)[_0x3b6b55(0x1fb)]('privateNotifications',{'notifications':_0x288cbc});}),_0x47f3da['on'](_0x1a6d71(0x1fe),async({userId:_0x54b3ab,toUserId:_0x3839b0,message:_0x36ec10})=>{const _0x18a14c=_0x1a6d71,_0x19c15b=users[_0x3839b0];let _0xf6bd54=_0x19c15b;!_0x19c15b&&(_0xf6bd54=await chat[_0x18a14c(0x229)](_0x3839b0));if(_0xf6bd54){const _0x38dfea=await chat[_0x18a14c(0x22b)](_0x54b3ab,_0x3839b0);await chat['send_new_message'](_0x38dfea,_0x54b3ab,_0x36ec10)&&(_0x19c15b&&io['to'](_0x19c15b)[_0x18a14c(0x1fb)](_0x18a14c(0x1f7),{'userId':_0x54b3ab,'message':_0x36ec10})),_0x47f3da[_0x18a14c(0x1fb)](_0x18a14c(0x20b),{'success':!![],'message':'Mensaje\x20enviado\x20con\x20Ã©xito'});}else _0x47f3da[_0x18a14c(0x1fb)](_0x18a14c(0x20b),{'success':![],'message':'Este\x20email\x20\x27'+_0x3839b0+_0x18a14c(0x1db)});}),_0x47f3da['on'](_0x1a6d71(0x1e5),()=>{const _0x538671=_0x1a6d71,{companyId:_0x464058}=_0x47f3da;_0x464058&&connectedEmployees[_0x464058]?(connectedEmployees[_0x464058]=connectedEmployees[_0x464058]['filter'](_0x58a3d4=>_0x58a3d4[_0x538671(0x1f5)]!==_0x47f3da['id']),connectedEmployees[_0x464058][_0x538671(0x20d)]===0x0&&delete connectedEmployees[_0x464058]):console['log'](_0x538671(0x1c7)+_0x47f3da['id']+_0x538671(0x223));}),_0x47f3da['on'](_0x1a6d71(0x1e3),_0x4de4b3=>{const _0x19a55b=_0x1a6d71;console[_0x19a55b(0x1e8)](_0x19a55b(0x1d8),_0x4de4b3),_0x47f3da[_0x19a55b(0x21f)][_0x19a55b(0x1fb)](_0x19a55b(0x216),_0x4de4b3);}),_0x47f3da['on']('sendAllTheOrders',_0x593893=>{const _0x5a3719=_0x1a6d71;_0x47f3da[_0x5a3719(0x1fb)](_0x5a3719(0x1bc),{'orderKitchen':orderKitchen});}),_0x47f3da['on'](_0x1a6d71(0x1b2),_0x36d7fb=>{const _0x331f4d=_0x1a6d71,_0x45cdfe=JSON[_0x331f4d(0x1b6)](_0x36d7fb);_0x45cdfe['id']=orderKitchen[_0x331f4d(0x20d)]+0x1,orderKitchen[_0x331f4d(0x1d3)](_0x45cdfe);});});const companyName=_0x4a339b(0x22d);serverExpress[_0x4a339b(0x1ea)](require(_0x4a339b(0x1cd))),serverExpress[_0x4a339b(0x1ea)](require('./router/authentication')),serverExpress[_0x4a339b(0x1ea)](companyName,require(_0x4a339b(0x1c4)));const routesPath=path[_0x4a339b(0x1ef)](__dirname,_0x4a339b(0x1ce));fs[_0x4a339b(0x213)](routesPath)[_0x4a339b(0x1c8)](_0x3dc1c1=>{const _0x4d7da8=_0x4a339b,_0x5391e1=path[_0x4d7da8(0x1ef)](routesPath,_0x3dc1c1);fs[_0x4d7da8(0x1ba)](_0x5391e1)[_0x4d7da8(0x1df)]()&&_0x3dc1c1['endsWith']('.js')&&serverExpress[_0x4d7da8(0x1ea)](companyName,require(_0x5391e1));}),serverExpress['use'](require(_0x4a339b(0x1b4))),serverExpress['use'](express[_0x4a339b(0x1c0)](path[_0x4a339b(0x1ef)](__dirname,_0x4a339b(0x215))));const os=require('os');function getLocalIP(){const _0x403e09=_0x4a339b,_0x41ad80=os[_0x403e09(0x1d0)]();for(let _0x343ec3 in _0x41ad80){for(let _0x490dd1=0x0;_0x490dd1<_0x41ad80[_0x343ec3]['length'];_0x490dd1++){const _0x5ee4b0=_0x41ad80[_0x343ec3][_0x490dd1];if(_0x5ee4b0[_0x403e09(0x227)]==='IPv4'&&!_0x5ee4b0[_0x403e09(0x1b8)])return _0x5ee4b0['address'];}}return _0x403e09(0x1cf);}serverExpress[_0x4a339b(0x1af)](serverExpress[_0x4a339b(0x20f)](_0x4a339b(0x1f6)),_0x4a339b(0x1b7),()=>{const _0xa361d9=_0x4a339b;console['log'](_0xa361d9(0x1ac)+getLocalIP()+':'+serverExpress[_0xa361d9(0x20f)](_0xa361d9(0x1f6)));});