const _0x56a769=_0x26ec;(function(_0x35e1ec,_0x462d1f){const _0x1c6512=_0x26ec,_0x1769e6=_0x35e1ec();while(!![]){try{const _0x1178a3=parseInt(_0x1c6512(0x153))/0x1+-parseInt(_0x1c6512(0x18e))/0x2+-parseInt(_0x1c6512(0x17e))/0x3*(parseInt(_0x1c6512(0x1a2))/0x4)+-parseInt(_0x1c6512(0x1aa))/0x5+parseInt(_0x1c6512(0x179))/0x6*(-parseInt(_0x1c6512(0x146))/0x7)+parseInt(_0x1c6512(0x197))/0x8*(-parseInt(_0x1c6512(0x19f))/0x9)+parseInt(_0x1c6512(0x1a7))/0xa*(parseInt(_0x1c6512(0x1a5))/0xb);if(_0x1178a3===_0x462d1f)break;else _0x1769e6['push'](_0x1769e6['shift']());}catch(_0x16760f){_0x1769e6['push'](_0x1769e6['shift']());}}}(_0x3a16,0xd2c8c));const system=require(_0x56a769(0x14a)),express=require('express'),morgan=require(_0x56a769(0x188)),{engine}=require(_0x56a769(0x169)),multer=require(_0x56a769(0x173)),flash=require(_0x56a769(0x16f)),session=require(_0x56a769(0x161)),passport=require(_0x56a769(0x18b)),{database}=require('./keys'),{v4:uuid}=require(_0x56a769(0x177)),path=require('path'),{RecaptchaV2}=require(_0x56a769(0x196)),serverExpress=express();require('./lib/passport'),require(_0x56a769(0x178)),serverExpress[_0x56a769(0x150)](_0x56a769(0x159),process[_0x56a769(0x158)][_0x56a769(0x1af)]||0xfa0),serverExpress[_0x56a769(0x150)](_0x56a769(0x141),path[_0x56a769(0x13c)](__dirname,'views')),serverExpress[_0x56a769(0x1b0)]('.hbs',engine({'defaultLayout':_0x56a769(0x140),'layoutsDir':path[_0x56a769(0x13c)](serverExpress['get']('views'),'layouts'),'partialsDir':path[_0x56a769(0x13c)](serverExpress[_0x56a769(0x1b3)](_0x56a769(0x141)),_0x56a769(0x1ba)),'extname':_0x56a769(0x18a),'helpers':require(_0x56a769(0x15c))})),serverExpress[_0x56a769(0x150)](_0x56a769(0x15e),_0x56a769(0x18a)),require(_0x56a769(0x1b2))['config']();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process['env'],pg=require('pg'),fs=require('fs'),adminPool=new pg[(_0x56a769(0x189))]({'user':APP_PG_USER,'host':APP_PG_HOST,'password':APP_PG_PASSWORD,'port':APP_PG_PORT,'database':_0x56a769(0x19d)}),importSQLFile=async _0x3530cb=>{const _0x311746=_0x56a769,_0x444613=path[_0x311746(0x13c)](__dirname,'database',_0x311746(0x1b9)),_0x4b4564=fs['readFileSync'](_0x444613,_0x311746(0x145)),_0x288093=_0x4b4564[_0x311746(0x16b)](/;\s*$/m)[_0x311746(0x198)](_0x1d55e6=>_0x1d55e6[_0x311746(0x162)]())[_0x311746(0x172)](_0x25c6da=>_0x25c6da[_0x311746(0x160)]>0x0),_0x15b911=await _0x3530cb[_0x311746(0x142)]();try{for(const _0x159f38 of _0x288093){await _0x15b911[_0x311746(0x1b4)](_0x159f38);}console[_0x311746(0x1a1)]('✅\x20SQL\x20ejecutado\x20correctamente');}catch(_0xec18f1){console[_0x311746(0x14c)](_0x311746(0x16e),_0xec18f1[_0x311746(0x15b)]);}finally{_0x15b911['release']();}},createDatabase=async()=>{const _0x11eaea=_0x56a769,_0x1f8ad2=await adminPool[_0x11eaea(0x1b4)](_0x11eaea(0x16a));_0x1f8ad2[_0x11eaea(0x175)]===0x0?(await adminPool['query'](_0x11eaea(0x13d)),importSQLFile(adminPool),console[_0x11eaea(0x1a1)](_0x11eaea(0x147))):console[_0x11eaea(0x1a1)](_0x11eaea(0x17b));};createDatabase();const pgPool=new pg[(_0x56a769(0x189))]({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress[_0x56a769(0x164)](session({'secret':'FudSession','resave':![],'saveUninitialized':![],'store':new(require(_0x56a769(0x1a0))(session))({'pool':pgPool,'tableName':_0x56a769(0x144)})})),serverExpress[_0x56a769(0x164)](flash()),serverExpress[_0x56a769(0x164)](morgan(_0x56a769(0x14d))),serverExpress['use'](express['urlencoded']({'extended':![]})),serverExpress[_0x56a769(0x164)](express[_0x56a769(0x15f)]()),serverExpress[_0x56a769(0x164)](passport[_0x56a769(0x14f)]()),serverExpress['use'](passport[_0x56a769(0x144)]());const storage=multer[_0x56a769(0x1ae)]({'destination':path[_0x56a769(0x13c)](__dirname,_0x56a769(0x192)),'filename':(_0x31b00b,_0x4f69e2,_0x3ae35d,_0x471a6f)=>{const _0x56018c=_0x56a769;_0x3ae35d(null,uuid()+path['extname'](_0x4f69e2[_0x56018c(0x18d)]));}});serverExpress[_0x56a769(0x164)](multer({'storage':storage})[_0x56a769(0x193)]('image')),serverExpress[_0x56a769(0x164)]((_0x1f6df3,_0x1cf560,_0x26acd4)=>{const _0x29b51b=_0x56a769;serverExpress[_0x29b51b(0x13f)]['success']=_0x1f6df3[_0x29b51b(0x19b)]('success'),serverExpress[_0x29b51b(0x13f)][_0x29b51b(0x15b)]=_0x1f6df3[_0x29b51b(0x19b)](_0x29b51b(0x15b)),serverExpress[_0x29b51b(0x13f)][_0x29b51b(0x1ac)]=_0x1f6df3[_0x29b51b(0x1ac)],serverExpress['locals'][_0x29b51b(0x167)]=_0x1f6df3[_0x29b51b(0x167)],serverExpress[_0x29b51b(0x13f)][_0x29b51b(0x186)]=0x0,serverExpress[_0x29b51b(0x13f)][_0x29b51b(0x151)]=0x0,_0x26acd4();});const http=require(_0x56a769(0x14e)),serverSocket=http[_0x56a769(0x1a8)](serverExpress),{Server}=require(_0x56a769(0x143)),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require(_0x56a769(0x148));function _0x3a16(){const _0x48f671=['getTheFirstTenNotifications','./router/links/store','messageStatus','\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.','join','CREATE\x20DATABASE\x20edplus','./router/links/fudone','locals','main','views','connect','socket.io','session','utf8','77rzsTAg','📦\x20Base\x20de\x20datos\x20EDPLUS\x20creada','./services/chat.js','sendAllTheOrders','./lib/system','get_the_first_notification','error','dev','http','initialize','set','pack_branch','broadcast','1585495HXdQwF','privateMessage','address','./router/links/app','./router/links/prescription','env','port','privateNotifications','message','./lib/handlebars','\x27\x20no\x20existe\x20🤔','view\x20engine','json','length','express-session','trim','IPv4','use','send_new_message','./lib/addFrom','company','connectionRejected','express-handlebars','SELECT\x201\x20FROM\x20pg_database\x20WHERE\x20datname\x20=\x20\x27edplus\x27','split','listen','push','❌\x20Error\x20ejecutando\x20SQL:','connect-flash','public','Socket\x20','filter','multer','socketId','rowCount','./router/links/boutique','uuid','./lib/editFrom','412722IeDnMd','./router/links/desktop','📂\x20La\x20base\x20de\x20datos\x20EDPLUS\x20ya\x20existe,\x20no\x20se\x20creó\x20nuevamente.','\x27\x20no\x20existe.\x20🤔','registerUser','4317XeRbaq','some','theUserIsConnect','El\x20usuario\x20\x27','0.0.0.0','Mensaje\x20enviado\x20con\x20éxito','userId','/links','pack_company','127.0.0.1','morgan','Pool','.hbs','passport','canSend','originalname','88878fafOkh','./router/links/branch','Mensaje\x20enviado\x20con\x20éxito.\x20👌','create_new_chat','public/img/uploads','single','get_max_employee_of_this_company','desktop','express-recaptcha','8PRuTbY','map','./router','Este\x20email\x20\x27','flash','./router/links/orders','postgres','internal','12650229fiJkDg','connect-pg-simple','log','3508GkGYIO','parse','sendMessageToUser','3619PlLjAN','static','104680DYqNpW','createServer','Un\x20usuario\x20se\x20ha\x20conectado','3487075wdwZWp','Ups,\x20parece\x20que\x20ya\x20estás\x20conectado\x20en\x20otro\x20dispositivo.','user','sendNotification','diskStorage','PORT','engine','Server\x20running\x20on\x20http://','dotenv','get','query','emit','this_email_exist','sendNotificationToUser','./router/links','edplus.sql','partials','Nueva\x20notificación:'];_0x3a16=function(){return _0x48f671;};return _0x3a16();}function _0x26ec(_0x692f63,_0x351ff9){const _0x3a16c6=_0x3a16();return _0x26ec=function(_0x26ece3,_0x8f1806){_0x26ece3=_0x26ece3-0x13a;let _0x280efc=_0x3a16c6[_0x26ece3];return _0x280efc;},_0x26ec(_0x692f63,_0x351ff9);}serverSocket[_0x56a769(0x16c)](serverExpress[_0x56a769(0x1b3)]('port'),()=>{const _0x227aa6=_0x56a769;console[_0x227aa6(0x1a1)]('Server\x20running\x20on\x20port\x20'+serverExpress[_0x227aa6(0x1b3)](_0x227aa6(0x159)));}),io['on']('connection',async _0x4ad6f3=>{const _0x517bf9=_0x56a769;console[_0x517bf9(0x1a1)](_0x517bf9(0x1a9)),_0x4ad6f3['on'](_0x517bf9(0x17d),async(_0x5f1838,_0x54583e)=>{const _0x48d5c8=_0x517bf9,_0x338bd7=connectedEmployees[_0x54583e]||[],_0x45c0b8=_0x338bd7[_0x48d5c8(0x17f)](_0x2ccf23=>_0x2ccf23[_0x48d5c8(0x184)]===_0x5f1838);if(_0x45c0b8){_0x4ad6f3['emit'](_0x48d5c8(0x168),_0x48d5c8(0x1ab));return;}if(system!=_0x48d5c8(0x195)){!companyLimitsCache[_0x54583e]&&(companyLimitsCache[_0x54583e]=await chat[_0x48d5c8(0x194)](_0x54583e));const _0x3a0be5=companyLimitsCache[_0x54583e];if(_0x338bd7['length']>=_0x3a0be5){_0x4ad6f3[_0x48d5c8(0x1b5)]('connectionRejected','Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20límite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresía.');return;}}_0x4ad6f3['companyId']=_0x54583e,_0x338bd7[_0x48d5c8(0x16d)]({'userId':_0x5f1838,'socketId':_0x4ad6f3['id']}),connectedEmployees[_0x54583e]=_0x338bd7;const _0x554566=await chat[_0x48d5c8(0x14b)](_0x5f1838,0xa);io['to'](_0x5f1838)[_0x48d5c8(0x1b5)](_0x48d5c8(0x15a),{'notifications':_0x554566});});async function _0x3704e2(_0x1490cb){const _0x27a55b=_0x517bf9,_0x530f15=users[_0x1490cb];let _0x3df537=_0x530f15;!_0x530f15&&(_0x3df537=await chat[_0x27a55b(0x1b6)](toUserId));const _0x373c25={'canSend':_0x3df537,'theUserIsConnect':_0x530f15};return _0x373c25;}_0x4ad6f3['on'](_0x517bf9(0x1b7),async({userEmail:_0x34ebb2,toUserEmail:_0x1f9bce,message:_0x263858})=>{const _0x24be06=_0x517bf9,_0x2e6691=await _0x3704e2(_0x1f9bce);_0x2e6691[_0x24be06(0x18c)]?await chat['create_notification'](_0x34ebb2,_0x1f9bce,_0x263858)?(_0x2e6691[_0x24be06(0x180)]&&io['to'](recipientSocketId)['emit'](_0x24be06(0x154),{'userId':userId,'message':_0x263858}),_0x4ad6f3[_0x24be06(0x1b5)]('messageStatus',{'success':!![],'message':_0x24be06(0x190)})):_0x4ad6f3[_0x24be06(0x1b5)]('messageStatus',{'success':![],'message':'No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27'+_0x1f9bce+'\x27.\x20Inténtalo\x20de\x20nuevo.\x20😳'}):_0x4ad6f3[_0x24be06(0x1b5)](_0x24be06(0x13a),{'success':![],'message':_0x24be06(0x181)+_0x1f9bce+_0x24be06(0x17c)});}),_0x4ad6f3['on'](_0x517bf9(0x1bc),async({userEmail:_0x36a3b5})=>{const _0x3bf550=_0x517bf9,_0x2e141e=await chat[_0x3bf550(0x14b)](_0x36a3b5,0xa);io['to'](recipientSocketId)['emit']('privateNotifications',{'notifications':_0x2e141e});}),_0x4ad6f3['on'](_0x517bf9(0x1a4),async({userId:_0x5655dc,toUserId:_0x243e84,message:_0x5140e7})=>{const _0x433531=_0x517bf9,_0x259624=users[_0x243e84];let _0xa9e3e0=_0x259624;!_0x259624&&(_0xa9e3e0=await chat[_0x433531(0x1b6)](_0x243e84));if(_0xa9e3e0){const _0x2c4016=await chat[_0x433531(0x191)](_0x5655dc,_0x243e84);await chat[_0x433531(0x165)](_0x2c4016,_0x5655dc,_0x5140e7)&&(_0x259624&&io['to'](_0x259624)[_0x433531(0x1b5)](_0x433531(0x154),{'userId':_0x5655dc,'message':_0x5140e7})),_0x4ad6f3[_0x433531(0x1b5)](_0x433531(0x13a),{'success':!![],'message':_0x433531(0x183)});}else _0x4ad6f3['emit'](_0x433531(0x13a),{'success':![],'message':_0x433531(0x19a)+_0x243e84+_0x433531(0x15d)});}),_0x4ad6f3['on']('disconnect',()=>{const _0x261536=_0x517bf9,{companyId:_0x215e9f}=_0x4ad6f3;_0x215e9f&&connectedEmployees[_0x215e9f]?(connectedEmployees[_0x215e9f]=connectedEmployees[_0x215e9f]['filter'](_0xe9222c=>_0xe9222c[_0x261536(0x174)]!==_0x4ad6f3['id']),connectedEmployees[_0x215e9f][_0x261536(0x160)]===0x0&&delete connectedEmployees[_0x215e9f]):console['log'](_0x261536(0x171)+_0x4ad6f3['id']+_0x261536(0x13b));}),_0x4ad6f3['on'](_0x517bf9(0x1ad),_0x5c277d=>{const _0x48ed5f=_0x517bf9;console[_0x48ed5f(0x1a1)](_0x48ed5f(0x1bb),_0x5c277d),_0x4ad6f3[_0x48ed5f(0x152)][_0x48ed5f(0x1b5)]('newNotification',_0x5c277d);}),_0x4ad6f3['on'](_0x517bf9(0x149),_0x44d25c=>{const _0x406fcd=_0x517bf9;_0x4ad6f3[_0x406fcd(0x1b5)]('getAllTheOrders',{'orderKitchen':orderKitchen});}),_0x4ad6f3['on']('saveANewOrder',_0x1ec5cb=>{const _0x7a102e=_0x517bf9,_0x11b450=JSON[_0x7a102e(0x1a3)](_0x1ec5cb);_0x11b450['id']=orderKitchen['length']+0x1,orderKitchen[_0x7a102e(0x16d)](_0x11b450);});});const companyName=_0x56a769(0x185);serverExpress[_0x56a769(0x164)](require(_0x56a769(0x199))),serverExpress['use'](require('./router/authentication')),serverExpress[_0x56a769(0x164)](companyName,require(_0x56a769(0x1b8))),serverExpress[_0x56a769(0x164)](companyName,require(_0x56a769(0x13e))),serverExpress[_0x56a769(0x164)](companyName,require('./router/links/ceo')),serverExpress['use'](companyName,require(_0x56a769(0x18f))),serverExpress[_0x56a769(0x164)](companyName,require('./router/links/subscription')),serverExpress[_0x56a769(0x164)](companyName,require(_0x56a769(0x1bd))),serverExpress[_0x56a769(0x164)](companyName,require('./router/links/delivery')),serverExpress[_0x56a769(0x164)](companyName,require(_0x56a769(0x156))),serverExpress[_0x56a769(0x164)](companyName,require('./router/links/CRM')),serverExpress[_0x56a769(0x164)](companyName,require(_0x56a769(0x17a))),serverExpress['use'](companyName,require(_0x56a769(0x176))),serverExpress['use'](companyName,require('./router/links/cashCut')),serverExpress[_0x56a769(0x164)](companyName,require(_0x56a769(0x19c))),serverExpress[_0x56a769(0x164)](companyName,require(_0x56a769(0x157))),serverExpress[_0x56a769(0x164)](require(_0x56a769(0x166))),serverExpress[_0x56a769(0x164)](express[_0x56a769(0x1a6)](path[_0x56a769(0x13c)](__dirname,_0x56a769(0x170))));const os=require('os');function getLocalIP(){const _0x804aee=_0x56a769,_0x41b3b8=os['networkInterfaces']();for(let _0x28d068 in _0x41b3b8){for(let _0x4802e6=0x0;_0x4802e6<_0x41b3b8[_0x28d068][_0x804aee(0x160)];_0x4802e6++){const _0x5918e3=_0x41b3b8[_0x28d068][_0x4802e6];if(_0x5918e3['family']===_0x804aee(0x163)&&!_0x5918e3[_0x804aee(0x19e)])return _0x5918e3[_0x804aee(0x155)];}}return _0x804aee(0x187);}serverExpress[_0x56a769(0x16c)](serverExpress[_0x56a769(0x1b3)](_0x56a769(0x159)),_0x56a769(0x182),()=>{const _0x3bb02d=_0x56a769;console[_0x3bb02d(0x1a1)](_0x3bb02d(0x1b1)+getLocalIP()+':'+serverExpress[_0x3bb02d(0x1b3)](_0x3bb02d(0x159)));});