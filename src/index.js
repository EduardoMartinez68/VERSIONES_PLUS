const _0x5b24aa=_0x350a;(function(_0x1f623b,_0x5ea599){const _0x3907b4=_0x350a,_0xee22e7=_0x1f623b();while(!![]){try{const _0x3ddda5=-parseInt(_0x3907b4(0x6b))/0x1+parseInt(_0x3907b4(0xa7))/0x2*(parseInt(_0x3907b4(0x7e))/0x3)+parseInt(_0x3907b4(0x76))/0x4+-parseInt(_0x3907b4(0xa6))/0x5+parseInt(_0x3907b4(0xc8))/0x6*(parseInt(_0x3907b4(0x74))/0x7)+-parseInt(_0x3907b4(0x85))/0x8*(parseInt(_0x3907b4(0x73))/0x9)+parseInt(_0x3907b4(0x9f))/0xa;if(_0x3ddda5===_0x5ea599)break;else _0xee22e7['push'](_0xee22e7['shift']());}catch(_0x17bf90){_0xee22e7['push'](_0xee22e7['shift']());}}}(_0x4784,0x8bf9f));const system=require(_0x5b24aa(0xd6)),express=require(_0x5b24aa(0xc2)),morgan=require(_0x5b24aa(0xd2)),{engine}=require(_0x5b24aa(0xcd)),multer=require(_0x5b24aa(0xd4)),flash=require('connect-flash'),session=require(_0x5b24aa(0x80)),passport=require('passport'),{database}=require(_0x5b24aa(0xc5)),{v4:uuid}=require(_0x5b24aa(0x93)),path=require(_0x5b24aa(0x7f)),{RecaptchaV2}=require('express-recaptcha'),serverExpress=express();require('./lib/passport'),require('./lib/editFrom'),serverExpress[_0x5b24aa(0x84)]('port',process[_0x5b24aa(0x7a)][_0x5b24aa(0x72)]||0xfa0),serverExpress[_0x5b24aa(0x84)](_0x5b24aa(0xcb),path[_0x5b24aa(0xa1)](__dirname,_0x5b24aa(0xcb))),serverExpress[_0x5b24aa(0xa2)](_0x5b24aa(0x90),engine({'defaultLayout':'main','layoutsDir':path[_0x5b24aa(0xa1)](serverExpress[_0x5b24aa(0x9b)](_0x5b24aa(0xcb)),_0x5b24aa(0xdb)),'partialsDir':path[_0x5b24aa(0xa1)](serverExpress[_0x5b24aa(0x9b)](_0x5b24aa(0xcb)),_0x5b24aa(0xc0)),'extname':'.hbs','helpers':require('./lib/handlebars')})),serverExpress['set']('view\x20engine','.hbs'),require(_0x5b24aa(0x7b))[_0x5b24aa(0xad)]();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process[_0x5b24aa(0x7a)],pg=require('pg'),pgPool=new pg[(_0x5b24aa(0x9e))]({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress[_0x5b24aa(0x8a)](session({'secret':_0x5b24aa(0x81),'resave':![],'saveUninitialized':![],'store':new(require(_0x5b24aa(0x8f))(session))({'pool':pgPool,'tableName':'session'})})),serverExpress[_0x5b24aa(0x8a)](flash()),serverExpress[_0x5b24aa(0x8a)](morgan(_0x5b24aa(0xac))),serverExpress[_0x5b24aa(0x8a)](express[_0x5b24aa(0xb3)]({'extended':![]})),serverExpress[_0x5b24aa(0x8a)](express['json']()),serverExpress[_0x5b24aa(0x8a)](passport[_0x5b24aa(0x7c)]()),serverExpress[_0x5b24aa(0x8a)](passport[_0x5b24aa(0x8c)]());const storage=multer[_0x5b24aa(0xa3)]({'destination':path[_0x5b24aa(0xa1)](__dirname,'public/img/uploads'),'filename':(_0xde7e93,_0x341ad5,_0x5dbb14,_0x4d6123)=>{const _0x11be94=_0x5b24aa;_0x5dbb14(null,uuid()+path[_0x11be94(0xa8)](_0x341ad5['originalname']));}});serverExpress[_0x5b24aa(0x8a)](multer({'storage':storage})['single'](_0x5b24aa(0x78))),serverExpress[_0x5b24aa(0x8a)]((_0x29f0c1,_0x9d2fe3,_0x5e0cbe)=>{const _0x2d5876=_0x5b24aa;serverExpress[_0x2d5876(0x82)][_0x2d5876(0xb4)]=_0x29f0c1[_0x2d5876(0x88)](_0x2d5876(0xb4)),serverExpress['locals'][_0x2d5876(0xd1)]=_0x29f0c1[_0x2d5876(0x88)](_0x2d5876(0xd1)),serverExpress[_0x2d5876(0x82)]['user']=_0x29f0c1['user'],serverExpress['locals'][_0x2d5876(0x71)]=_0x29f0c1[_0x2d5876(0x71)],serverExpress['locals'][_0x2d5876(0xd3)]=0x0,serverExpress[_0x2d5876(0x82)][_0x2d5876(0xb8)]=0x0,_0x5e0cbe();});function _0x4784(){const _0x110b20=['express','./lib/addFrom','Server\x20running\x20on\x20port\x20','./keys','sendNotification','./router/links/prescription','108tLyWlH','Mensaje\x20enviado\x20con\x20Ã©xito.\x20ðŸ‘Œ','port','views','socketId','express-handlebars','./router/links','sendAllTheOrders','privateMessage','message','morgan','pack_company','multer','connection','./lib/system','create_new_chat','log','./router/links/delivery','./router/links/boutique','layouts','http','917532PxXsnf','./router/links/cashCut','sendNotificationToUser','getTheFirstTenNotifications','socket.io','./router/links/branch','company','PORT','2267253AOBITn','404999laghCz','./router/links/app','1224748uisrUl','Server\x20running\x20on\x20http://','image','get_max_employee_of_this_company','env','dotenv','initialize','create_notification','1107WQjhJJ','path','express-session','FudSession','locals','Ups,\x20parece\x20que\x20ya\x20estÃ¡s\x20conectado\x20en\x20otro\x20dispositivo.','set','24SGFlFq','./router','Este\x20email\x20\x27','flash','./router/links/CRM','use','this_email_exist','session','IPv4','./router/links/store','connect-pg-simple','.hbs','companyId','createServer','uuid','Nueva\x20notificaciÃ³n:','getAllTheOrders','Un\x20usuario\x20se\x20ha\x20conectado','/links','messageStatus','Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20lÃ­mite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresÃ­a.','networkInterfaces','get','privateNotifications','sendMessageToUser','Pool','15138040FCJoVi','./router/links/ceo','join','engine','diskStorage','\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.','internal','3147755djboTW','80FJgPXi','extname','127.0.0.1','length','./router/links/subscription','dev','config','Mensaje\x20enviado\x20con\x20Ã©xito','saveANewOrder','canSend','push','disconnect','urlencoded','success','send_new_message','emit','parse','pack_branch','filter','family','userId','desktop','address','get_the_first_notification','El\x20usuario\x20\x27','partials','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27'];_0x4784=function(){return _0x110b20;};return _0x4784();}const http=require(_0x5b24aa(0xdc)),serverSocket=http[_0x5b24aa(0x92)](serverExpress),{Server}=require(_0x5b24aa(0x6f)),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require('./services/chat.js');serverSocket['listen'](serverExpress[_0x5b24aa(0x9b)](_0x5b24aa(0xca)),()=>{const _0x3b9f63=_0x5b24aa;console['log'](_0x3b9f63(0xc4)+serverExpress[_0x3b9f63(0x9b)](_0x3b9f63(0xca)));}),io['on'](_0x5b24aa(0xd5),async _0x534eed=>{const _0x530554=_0x5b24aa;console[_0x530554(0xd8)](_0x530554(0x96)),_0x534eed['on']('registerUser',async(_0x515f7a,_0x2f6b28)=>{const _0x5aabf5=_0x530554,_0x334a10=connectedEmployees[_0x2f6b28]||[],_0x2c3cdf=_0x334a10['some'](_0x49c1c1=>_0x49c1c1[_0x5aabf5(0xbb)]===_0x515f7a);if(_0x2c3cdf){_0x534eed[_0x5aabf5(0xb6)]('connectionRejected',_0x5aabf5(0x83));return;}if(system!=_0x5aabf5(0xbc)){!companyLimitsCache[_0x2f6b28]&&(companyLimitsCache[_0x2f6b28]=await chat[_0x5aabf5(0x79)](_0x2f6b28));const _0x129a08=companyLimitsCache[_0x2f6b28];if(_0x334a10[_0x5aabf5(0xaa)]>=_0x129a08){_0x534eed[_0x5aabf5(0xb6)]('connectionRejected',_0x5aabf5(0x99));return;}}_0x534eed[_0x5aabf5(0x91)]=_0x2f6b28,_0x334a10['push']({'userId':_0x515f7a,'socketId':_0x534eed['id']}),connectedEmployees[_0x2f6b28]=_0x334a10;const _0xa3e96c=await chat[_0x5aabf5(0xbe)](_0x515f7a,0xa);io['to'](_0x515f7a)[_0x5aabf5(0xb6)](_0x5aabf5(0x9c),{'notifications':_0xa3e96c});});async function _0x529372(_0x4ab0f3){const _0x39ffe7=_0x530554,_0x4b9cba=users[_0x4ab0f3];let _0x4a8dab=_0x4b9cba;!_0x4b9cba&&(_0x4a8dab=await chat[_0x39ffe7(0x8b)](toUserId));const _0x1baa85={'canSend':_0x4a8dab,'theUserIsConnect':_0x4b9cba};return _0x1baa85;}_0x534eed['on'](_0x530554(0x6d),async({userEmail:_0x5bfd28,toUserEmail:_0x3e79ec,message:_0x1d6664})=>{const _0x5d1d64=_0x530554,_0x2f7ffc=await _0x529372(_0x3e79ec);_0x2f7ffc[_0x5d1d64(0xb0)]?await chat[_0x5d1d64(0x7d)](_0x5bfd28,_0x3e79ec,_0x1d6664)?(_0x2f7ffc['theUserIsConnect']&&io['to'](recipientSocketId)[_0x5d1d64(0xb6)](_0x5d1d64(0xd0),{'userId':userId,'message':_0x1d6664}),_0x534eed[_0x5d1d64(0xb6)](_0x5d1d64(0x98),{'success':!![],'message':_0x5d1d64(0xc9)})):_0x534eed[_0x5d1d64(0xb6)]('messageStatus',{'success':![],'message':_0x5d1d64(0xc1)+_0x3e79ec+'\x27.\x20IntÃ©ntalo\x20de\x20nuevo.\x20ðŸ˜³'}):_0x534eed[_0x5d1d64(0xb6)](_0x5d1d64(0x98),{'success':![],'message':_0x5d1d64(0xbf)+_0x3e79ec+'\x27\x20no\x20existe.\x20ðŸ¤”'});}),_0x534eed['on'](_0x530554(0x6e),async({userEmail:_0x2823ce})=>{const _0x5e726a=_0x530554,_0x5e30ac=await chat[_0x5e726a(0xbe)](_0x2823ce,0xa);io['to'](recipientSocketId)[_0x5e726a(0xb6)](_0x5e726a(0x9c),{'notifications':_0x5e30ac});}),_0x534eed['on'](_0x530554(0x9d),async({userId:_0x198183,toUserId:_0x2ef47b,message:_0x4d228b})=>{const _0x12f422=_0x530554,_0x56c8d7=users[_0x2ef47b];let _0x43317e=_0x56c8d7;!_0x56c8d7&&(_0x43317e=await chat['this_email_exist'](_0x2ef47b));if(_0x43317e){const _0x560f25=await chat[_0x12f422(0xd7)](_0x198183,_0x2ef47b);await chat[_0x12f422(0xb5)](_0x560f25,_0x198183,_0x4d228b)&&(_0x56c8d7&&io['to'](_0x56c8d7)[_0x12f422(0xb6)](_0x12f422(0xd0),{'userId':_0x198183,'message':_0x4d228b})),_0x534eed[_0x12f422(0xb6)](_0x12f422(0x98),{'success':!![],'message':_0x12f422(0xae)});}else _0x534eed[_0x12f422(0xb6)](_0x12f422(0x98),{'success':![],'message':_0x12f422(0x87)+_0x2ef47b+'\x27\x20no\x20existe\x20ðŸ¤”'});}),_0x534eed['on'](_0x530554(0xb2),()=>{const _0x49e726=_0x530554,{companyId:_0x18bf7b}=_0x534eed;_0x18bf7b&&connectedEmployees[_0x18bf7b]?(connectedEmployees[_0x18bf7b]=connectedEmployees[_0x18bf7b][_0x49e726(0xb9)](_0x16640d=>_0x16640d[_0x49e726(0xcc)]!==_0x534eed['id']),connectedEmployees[_0x18bf7b][_0x49e726(0xaa)]===0x0&&delete connectedEmployees[_0x18bf7b]):console[_0x49e726(0xd8)]('Socket\x20'+_0x534eed['id']+_0x49e726(0xa4));}),_0x534eed['on'](_0x530554(0xc6),_0x388775=>{const _0x49bd82=_0x530554;console[_0x49bd82(0xd8)](_0x49bd82(0x94),_0x388775),_0x534eed['broadcast'][_0x49bd82(0xb6)]('newNotification',_0x388775);}),_0x534eed['on'](_0x530554(0xcf),_0x4bfcdb=>{const _0x1ccbc1=_0x530554;_0x534eed[_0x1ccbc1(0xb6)](_0x1ccbc1(0x95),{'orderKitchen':orderKitchen});}),_0x534eed['on'](_0x530554(0xaf),_0x4b093e=>{const _0x5a6c40=_0x530554,_0x51c7f9=JSON[_0x5a6c40(0xb7)](_0x4b093e);_0x51c7f9['id']=orderKitchen['length']+0x1,orderKitchen[_0x5a6c40(0xb1)](_0x51c7f9);});});const companyName=_0x5b24aa(0x97);function _0x350a(_0x5a7926,_0x2f35c0){const _0x47841e=_0x4784();return _0x350a=function(_0x350a00,_0x1ef5f1){_0x350a00=_0x350a00-0x6b;let _0x3aef33=_0x47841e[_0x350a00];return _0x3aef33;},_0x350a(_0x5a7926,_0x2f35c0);}serverExpress['use'](require(_0x5b24aa(0x86))),serverExpress['use'](require('./router/authentication')),serverExpress[_0x5b24aa(0x8a)](companyName,require(_0x5b24aa(0xce))),serverExpress['use'](companyName,require('./router/links/fudone')),serverExpress[_0x5b24aa(0x8a)](companyName,require(_0x5b24aa(0xa0))),serverExpress[_0x5b24aa(0x8a)](companyName,require(_0x5b24aa(0x70))),serverExpress[_0x5b24aa(0x8a)](companyName,require(_0x5b24aa(0xab))),serverExpress[_0x5b24aa(0x8a)](companyName,require(_0x5b24aa(0x8e))),serverExpress[_0x5b24aa(0x8a)](companyName,require(_0x5b24aa(0xd9))),serverExpress[_0x5b24aa(0x8a)](companyName,require(_0x5b24aa(0x75))),serverExpress['use'](companyName,require(_0x5b24aa(0x89))),serverExpress[_0x5b24aa(0x8a)](companyName,require('./router/links/desktop')),serverExpress[_0x5b24aa(0x8a)](companyName,require(_0x5b24aa(0xda))),serverExpress[_0x5b24aa(0x8a)](companyName,require(_0x5b24aa(0x6c))),serverExpress[_0x5b24aa(0x8a)](companyName,require('./router/links/orders')),serverExpress[_0x5b24aa(0x8a)](companyName,require(_0x5b24aa(0xc7))),serverExpress[_0x5b24aa(0x8a)](require(_0x5b24aa(0xc3))),serverExpress[_0x5b24aa(0x8a)](express['static'](path[_0x5b24aa(0xa1)](__dirname,'public')));const os=require('os');function getLocalIP(){const _0x352dc8=_0x5b24aa,_0x2f9f29=os[_0x352dc8(0x9a)]();for(let _0x3eb998 in _0x2f9f29){for(let _0x17dcec=0x0;_0x17dcec<_0x2f9f29[_0x3eb998][_0x352dc8(0xaa)];_0x17dcec++){const _0x2c19d0=_0x2f9f29[_0x3eb998][_0x17dcec];if(_0x2c19d0[_0x352dc8(0xba)]===_0x352dc8(0x8d)&&!_0x2c19d0[_0x352dc8(0xa5)])return _0x2c19d0[_0x352dc8(0xbd)];}}return _0x352dc8(0xa9);}serverExpress['listen'](serverExpress[_0x5b24aa(0x9b)](_0x5b24aa(0xca)),'0.0.0.0',()=>{const _0x303449=_0x5b24aa;console[_0x303449(0xd8)](_0x303449(0x77)+getLocalIP()+':'+serverExpress[_0x303449(0x9b)]('port'));});