const _0x5393b1=_0x33ef;function _0x33ef(_0x5e08d8,_0x189831){const _0x594ec5=_0x594e();return _0x33ef=function(_0x33ef39,_0x55acdf){_0x33ef39=_0x33ef39-0x126;let _0x4261ab=_0x594ec5[_0x33ef39];return _0x4261ab;},_0x33ef(_0x5e08d8,_0x189831);}function _0x594e(){const _0x16d58b=['createServer','Socket\x20','desktop','9382059Gvilqf','originalname','main','engine','./services/chat.js','express','PORT','Mensaje\x20enviado\x20con\x20éxito.\x20👌','set','canSend','./lib/passport','disconnect','682hmTShQ','locals','error','getTheFirstTenNotifications','views','extname','port','privateMessage','join','pack_company','./lib/editFrom','Ups,\x20parece\x20que\x20ya\x20estás\x20conectado\x20en\x20otro\x20dispositivo.','connectionRejected','\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.','44wMZthH','single','morgan','edplus.sql','use','length','some','./keys','networkInterfaces','trim','get','./lib/system','session','393204jXKGKa','./lib/handlebars','express-recaptcha','sendNotificationToUser','./router/authentication','Server\x20running\x20on\x20http://','query','public','create_notification','send_new_message','7qNlttH','newNotification','Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20límite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresía.','./router/links/desktop','env','1375926dxJgol','socket.io','http','Server\x20running\x20on\x20port\x20','sendAllTheOrders','.hbs','flash','❌\x20Error\x20ejecutando\x20SQL:','utf8','postgres','family','IPv4','parse','FudSession','sendMessageToUser','socketId','address','CREATE\x20DATABASE\x20edplus','message','📂\x20La\x20base\x20de\x20datos\x20EDPLUS\x20ya\x20existe,\x20no\x20se\x20creó\x20nuevamente.','company','messageStatus','split','urlencoded','Pool','static','Nueva\x20notificación:','Un\x20usuario\x20se\x20ha\x20conectado','listen','El\x20usuario\x20\x27','rowCount','push','this_email_exist','connection','📦\x20Base\x20de\x20datos\x20EDPLUS\x20creada','map','31662fjpLyl','getAllTheOrders','2500072EiEGTx','passport','create_new_chat','release','uuid','privateNotifications','theUserIsConnect','config','./router/links/branch','registerUser','937pJWaor','./router/links/store','dev','15SyAZpw','./lib/addFrom','express-session','initialize','\x27\x20no\x20existe.\x20🤔','diskStorage','log','view\x20engine','emit','filter','2302SGhiVM','user','path','database','3961840xhnTmZ','dotenv','127.0.0.1','broadcast','./router/links/app','./router/links','./router/links/CRM','multer','Este\x20email\x20\x27','internal','0.0.0.0'];_0x594e=function(){return _0x16d58b;};return _0x594e();}(function(_0x4e2243,_0x5565dc){const _0x4f9e08=_0x33ef,_0x306c03=_0x4e2243();while(!![]){try{const _0x330646=-parseInt(_0x4f9e08(0x141))/0x1*(parseInt(_0x4f9e08(0x14e))/0x2)+parseInt(_0x4f9e08(0x135))/0x3*(-parseInt(_0x4f9e08(0x17a))/0x4)+parseInt(_0x4f9e08(0x144))/0x5*(parseInt(_0x4f9e08(0x196))/0x6)+parseInt(_0x4f9e08(0x191))/0x7*(-parseInt(_0x4f9e08(0x137))/0x8)+-parseInt(_0x4f9e08(0x160))/0x9+parseInt(_0x4f9e08(0x152))/0xa+parseInt(_0x4f9e08(0x16c))/0xb*(parseInt(_0x4f9e08(0x187))/0xc);if(_0x330646===_0x5565dc)break;else _0x306c03['push'](_0x306c03['shift']());}catch(_0xde93f2){_0x306c03['push'](_0x306c03['shift']());}}}(_0x594e,0x8a390));const system=require(_0x5393b1(0x185)),express=require(_0x5393b1(0x165)),morgan=require(_0x5393b1(0x17c)),{engine}=require('express-handlebars'),multer=require(_0x5393b1(0x159)),flash=require('connect-flash'),session=require(_0x5393b1(0x146)),passport=require(_0x5393b1(0x138)),{database}=require(_0x5393b1(0x181)),{v4:uuid}=require(_0x5393b1(0x13b)),path=require(_0x5393b1(0x150)),{RecaptchaV2}=require(_0x5393b1(0x189)),serverExpress=express();require(_0x5393b1(0x16a)),require(_0x5393b1(0x176)),serverExpress[_0x5393b1(0x168)](_0x5393b1(0x172),process[_0x5393b1(0x195)][_0x5393b1(0x166)]||0xfa0),serverExpress[_0x5393b1(0x168)]('views',path[_0x5393b1(0x174)](__dirname,'views')),serverExpress[_0x5393b1(0x163)](_0x5393b1(0x19b),engine({'defaultLayout':_0x5393b1(0x162),'layoutsDir':path[_0x5393b1(0x174)](serverExpress['get'](_0x5393b1(0x170)),'layouts'),'partialsDir':path['join'](serverExpress['get']('views'),'partials'),'extname':_0x5393b1(0x19b),'helpers':require(_0x5393b1(0x188))})),serverExpress[_0x5393b1(0x168)](_0x5393b1(0x14b),_0x5393b1(0x19b)),require(_0x5393b1(0x153))[_0x5393b1(0x13e)]();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process[_0x5393b1(0x195)],pg=require('pg'),fs=require('fs'),adminPool=new pg[(_0x5393b1(0x129))]({'user':APP_PG_USER,'host':APP_PG_HOST,'password':APP_PG_PASSWORD,'port':APP_PG_PORT,'database':_0x5393b1(0x19f)}),importSQLFile=async _0xdd6ef2=>{const _0x5241c4=_0x5393b1,_0x23da4d=path[_0x5241c4(0x174)](__dirname,_0x5241c4(0x151),_0x5241c4(0x17d)),_0x3ff210=fs['readFileSync'](_0x23da4d,_0x5241c4(0x19e)),_0x26cc21=_0x3ff210[_0x5241c4(0x127)](/;\s*$/m)[_0x5241c4(0x134)](_0x525019=>_0x525019[_0x5241c4(0x183)]())[_0x5241c4(0x14d)](_0x1c8ad5=>_0x1c8ad5[_0x5241c4(0x17f)]>0x0),_0x2b073f=await _0xdd6ef2['connect']();try{for(const _0x287746 of _0x26cc21){await _0x2b073f[_0x5241c4(0x18d)](_0x287746);}console['log']('✅\x20SQL\x20ejecutado\x20correctamente');}catch(_0x314812){console[_0x5241c4(0x16e)](_0x5241c4(0x19d),_0x314812[_0x5241c4(0x1a8)]);}finally{_0x2b073f[_0x5241c4(0x13a)]();}},createDatabase=async()=>{const _0x68f042=_0x5393b1,_0xe3a95b=await adminPool[_0x68f042(0x18d)]('SELECT\x201\x20FROM\x20pg_database\x20WHERE\x20datname\x20=\x20\x27edplus\x27');_0xe3a95b[_0x68f042(0x12f)]===0x0?(await adminPool[_0x68f042(0x18d)](_0x68f042(0x1a7)),importSQLFile(adminPool),console['log'](_0x68f042(0x133))):console[_0x68f042(0x14a)](_0x68f042(0x1a9));};createDatabase();const pgPool=new pg['Pool']({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress['use'](session({'secret':_0x5393b1(0x1a3),'resave':![],'saveUninitialized':![],'store':new(require('connect-pg-simple')(session))({'pool':pgPool,'tableName':_0x5393b1(0x186)})})),serverExpress['use'](flash()),serverExpress[_0x5393b1(0x17e)](morgan(_0x5393b1(0x143))),serverExpress[_0x5393b1(0x17e)](express[_0x5393b1(0x128)]({'extended':![]})),serverExpress['use'](express['json']()),serverExpress[_0x5393b1(0x17e)](passport[_0x5393b1(0x147)]()),serverExpress[_0x5393b1(0x17e)](passport[_0x5393b1(0x186)]());const storage=multer[_0x5393b1(0x149)]({'destination':path['join'](__dirname,'public/img/uploads'),'filename':(_0x2de934,_0x5787bf,_0x4fd5c6,_0x151e19)=>{const _0x4d0111=_0x5393b1;_0x4fd5c6(null,uuid()+path[_0x4d0111(0x171)](_0x5787bf[_0x4d0111(0x161)]));}});serverExpress[_0x5393b1(0x17e)](multer({'storage':storage})[_0x5393b1(0x17b)]('image')),serverExpress[_0x5393b1(0x17e)]((_0x2887d8,_0x1b6b73,_0x2a219b)=>{const _0x40121e=_0x5393b1;serverExpress[_0x40121e(0x16d)]['success']=_0x2887d8[_0x40121e(0x19c)]('success'),serverExpress[_0x40121e(0x16d)][_0x40121e(0x1a8)]=_0x2887d8[_0x40121e(0x19c)]('message'),serverExpress[_0x40121e(0x16d)][_0x40121e(0x14f)]=_0x2887d8[_0x40121e(0x14f)],serverExpress[_0x40121e(0x16d)]['company']=_0x2887d8[_0x40121e(0x1aa)],serverExpress[_0x40121e(0x16d)][_0x40121e(0x175)]=0x0,serverExpress[_0x40121e(0x16d)]['pack_branch']=0x0,_0x2a219b();});const http=require(_0x5393b1(0x198)),serverSocket=http[_0x5393b1(0x15d)](serverExpress),{Server}=require(_0x5393b1(0x197)),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require(_0x5393b1(0x164));serverSocket[_0x5393b1(0x12d)](serverExpress[_0x5393b1(0x184)](_0x5393b1(0x172)),()=>{const _0x5203de=_0x5393b1;console['log'](_0x5203de(0x199)+serverExpress[_0x5203de(0x184)]('port'));}),io['on'](_0x5393b1(0x132),async _0x2980af=>{const _0x3e2a65=_0x5393b1;console[_0x3e2a65(0x14a)](_0x3e2a65(0x12c)),_0x2980af['on'](_0x3e2a65(0x140),async(_0x1c31de,_0x173265)=>{const _0x49b8e1=_0x3e2a65,_0x11fbed=connectedEmployees[_0x173265]||[],_0x52f185=_0x11fbed[_0x49b8e1(0x180)](_0xe934da=>_0xe934da['userId']===_0x1c31de);if(_0x52f185){_0x2980af['emit'](_0x49b8e1(0x178),_0x49b8e1(0x177));return;}if(system!=_0x49b8e1(0x15f)){!companyLimitsCache[_0x173265]&&(companyLimitsCache[_0x173265]=await chat['get_max_employee_of_this_company'](_0x173265));const _0x2eb302=companyLimitsCache[_0x173265];if(_0x11fbed[_0x49b8e1(0x17f)]>=_0x2eb302){_0x2980af[_0x49b8e1(0x14c)](_0x49b8e1(0x178),_0x49b8e1(0x193));return;}}_0x2980af['companyId']=_0x173265,_0x11fbed[_0x49b8e1(0x130)]({'userId':_0x1c31de,'socketId':_0x2980af['id']}),connectedEmployees[_0x173265]=_0x11fbed;const _0x5c11f5=await chat['get_the_first_notification'](_0x1c31de,0xa);io['to'](_0x1c31de)[_0x49b8e1(0x14c)](_0x49b8e1(0x13c),{'notifications':_0x5c11f5});});async function _0x46e9c4(_0x1e4f7d){const _0x32402e=users[_0x1e4f7d];let _0x1cea13=_0x32402e;!_0x32402e&&(_0x1cea13=await chat['this_email_exist'](toUserId));const _0x1592d7={'canSend':_0x1cea13,'theUserIsConnect':_0x32402e};return _0x1592d7;}_0x2980af['on'](_0x3e2a65(0x18a),async({userEmail:_0x12c7d6,toUserEmail:_0x3a59ee,message:_0x2f0aa8})=>{const _0x205160=_0x3e2a65,_0x11fe44=await _0x46e9c4(_0x3a59ee);_0x11fe44[_0x205160(0x169)]?await chat[_0x205160(0x18f)](_0x12c7d6,_0x3a59ee,_0x2f0aa8)?(_0x11fe44[_0x205160(0x13d)]&&io['to'](recipientSocketId)[_0x205160(0x14c)](_0x205160(0x173),{'userId':userId,'message':_0x2f0aa8}),_0x2980af[_0x205160(0x14c)](_0x205160(0x126),{'success':!![],'message':_0x205160(0x167)})):_0x2980af[_0x205160(0x14c)](_0x205160(0x126),{'success':![],'message':'No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27'+_0x3a59ee+'\x27.\x20Inténtalo\x20de\x20nuevo.\x20😳'}):_0x2980af[_0x205160(0x14c)](_0x205160(0x126),{'success':![],'message':_0x205160(0x12e)+_0x3a59ee+_0x205160(0x148)});}),_0x2980af['on'](_0x3e2a65(0x16f),async({userEmail:_0x265170})=>{const _0x192057=_0x3e2a65,_0x397a23=await chat['get_the_first_notification'](_0x265170,0xa);io['to'](recipientSocketId)['emit'](_0x192057(0x13c),{'notifications':_0x397a23});}),_0x2980af['on'](_0x3e2a65(0x1a4),async({userId:_0x1100a6,toUserId:_0x44ea0b,message:_0xf88468})=>{const _0x38a974=_0x3e2a65,_0x1dc1d5=users[_0x44ea0b];let _0x22d20f=_0x1dc1d5;!_0x1dc1d5&&(_0x22d20f=await chat[_0x38a974(0x131)](_0x44ea0b));if(_0x22d20f){const _0x5dd0f8=await chat[_0x38a974(0x139)](_0x1100a6,_0x44ea0b);await chat[_0x38a974(0x190)](_0x5dd0f8,_0x1100a6,_0xf88468)&&(_0x1dc1d5&&io['to'](_0x1dc1d5)[_0x38a974(0x14c)](_0x38a974(0x173),{'userId':_0x1100a6,'message':_0xf88468})),_0x2980af[_0x38a974(0x14c)](_0x38a974(0x126),{'success':!![],'message':'Mensaje\x20enviado\x20con\x20éxito'});}else _0x2980af[_0x38a974(0x14c)](_0x38a974(0x126),{'success':![],'message':_0x38a974(0x15a)+_0x44ea0b+'\x27\x20no\x20existe\x20🤔'});}),_0x2980af['on'](_0x3e2a65(0x16b),()=>{const _0xf72c6b=_0x3e2a65,{companyId:_0x3b9e0f}=_0x2980af;_0x3b9e0f&&connectedEmployees[_0x3b9e0f]?(connectedEmployees[_0x3b9e0f]=connectedEmployees[_0x3b9e0f][_0xf72c6b(0x14d)](_0x643ca9=>_0x643ca9[_0xf72c6b(0x1a5)]!==_0x2980af['id']),connectedEmployees[_0x3b9e0f][_0xf72c6b(0x17f)]===0x0&&delete connectedEmployees[_0x3b9e0f]):console[_0xf72c6b(0x14a)](_0xf72c6b(0x15e)+_0x2980af['id']+_0xf72c6b(0x179));}),_0x2980af['on']('sendNotification',_0x20bda1=>{const _0x17e25e=_0x3e2a65;console[_0x17e25e(0x14a)](_0x17e25e(0x12b),_0x20bda1),_0x2980af[_0x17e25e(0x155)][_0x17e25e(0x14c)](_0x17e25e(0x192),_0x20bda1);}),_0x2980af['on'](_0x3e2a65(0x19a),_0x3bd54d=>{const _0x5be3dd=_0x3e2a65;_0x2980af[_0x5be3dd(0x14c)](_0x5be3dd(0x136),{'orderKitchen':orderKitchen});}),_0x2980af['on']('saveANewOrder',_0xff3319=>{const _0x5418ae=_0x3e2a65,_0x26f629=JSON[_0x5418ae(0x1a2)](_0xff3319);_0x26f629['id']=orderKitchen['length']+0x1,orderKitchen[_0x5418ae(0x130)](_0x26f629);});});const companyName='/links';serverExpress[_0x5393b1(0x17e)](require('./router')),serverExpress[_0x5393b1(0x17e)](require(_0x5393b1(0x18b))),serverExpress[_0x5393b1(0x17e)](companyName,require(_0x5393b1(0x157))),serverExpress[_0x5393b1(0x17e)](companyName,require('./router/links/fudone')),serverExpress[_0x5393b1(0x17e)](companyName,require('./router/links/ceo')),serverExpress[_0x5393b1(0x17e)](companyName,require(_0x5393b1(0x13f))),serverExpress[_0x5393b1(0x17e)](companyName,require('./router/links/subscription')),serverExpress[_0x5393b1(0x17e)](companyName,require(_0x5393b1(0x142))),serverExpress[_0x5393b1(0x17e)](companyName,require('./router/links/delivery')),serverExpress[_0x5393b1(0x17e)](companyName,require(_0x5393b1(0x156))),serverExpress['use'](companyName,require(_0x5393b1(0x158))),serverExpress[_0x5393b1(0x17e)](companyName,require(_0x5393b1(0x194))),serverExpress[_0x5393b1(0x17e)](companyName,require('./router/links/boutique')),serverExpress[_0x5393b1(0x17e)](companyName,require('./router/links/cashCut')),serverExpress[_0x5393b1(0x17e)](companyName,require('./router/links/orders')),serverExpress[_0x5393b1(0x17e)](companyName,require('./router/links/prescription')),serverExpress[_0x5393b1(0x17e)](require(_0x5393b1(0x145))),serverExpress['use'](express[_0x5393b1(0x12a)](path[_0x5393b1(0x174)](__dirname,_0x5393b1(0x18e))));const os=require('os');function getLocalIP(){const _0x2ba8c6=_0x5393b1,_0x5ae459=os[_0x2ba8c6(0x182)]();for(let _0x1fbfbf in _0x5ae459){for(let _0x357aef=0x0;_0x357aef<_0x5ae459[_0x1fbfbf]['length'];_0x357aef++){const _0x458d65=_0x5ae459[_0x1fbfbf][_0x357aef];if(_0x458d65[_0x2ba8c6(0x1a0)]===_0x2ba8c6(0x1a1)&&!_0x458d65[_0x2ba8c6(0x15b)])return _0x458d65[_0x2ba8c6(0x1a6)];}}return _0x2ba8c6(0x154);}serverExpress[_0x5393b1(0x12d)](serverExpress['get'](_0x5393b1(0x172)),_0x5393b1(0x15c),()=>{const _0x2dd63b=_0x5393b1;console[_0x2dd63b(0x14a)](_0x2dd63b(0x18c)+getLocalIP()+':'+serverExpress[_0x2dd63b(0x184)]('port'));});