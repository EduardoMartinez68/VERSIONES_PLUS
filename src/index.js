const _0x19be3b=_0x9276;(function(_0x5a53dc,_0x3943e5){const _0x23534d=_0x9276,_0x2f2c6e=_0x5a53dc();while(!![]){try{const _0xc7d61e=parseInt(_0x23534d(0x171))/0x1*(-parseInt(_0x23534d(0x1b3))/0x2)+parseInt(_0x23534d(0x17d))/0x3*(parseInt(_0x23534d(0x151))/0x4)+parseInt(_0x23534d(0x147))/0x5+parseInt(_0x23534d(0x16e))/0x6*(parseInt(_0x23534d(0x161))/0x7)+-parseInt(_0x23534d(0x18d))/0x8+-parseInt(_0x23534d(0x190))/0x9+parseInt(_0x23534d(0x19d))/0xa;if(_0xc7d61e===_0x3943e5)break;else _0x2f2c6e['push'](_0x2f2c6e['shift']());}catch(_0x3a8e6b){_0x2f2c6e['push'](_0x2f2c6e['shift']());}}}(_0x57d4,0x380a0));const system=require(_0x19be3b(0x19e)),express=require(_0x19be3b(0x169)),morgan=require(_0x19be3b(0x187)),{engine}=require(_0x19be3b(0x1a6)),multer=require('multer'),flash=require(_0x19be3b(0x162)),session=require(_0x19be3b(0x17b)),passport=require(_0x19be3b(0x152)),{database}=require(_0x19be3b(0x198)),{v4:uuid}=require(_0x19be3b(0x179)),path=require(_0x19be3b(0x183)),{RecaptchaV2}=require(_0x19be3b(0x15c)),serverExpress=express();require('./lib/passport'),require(_0x19be3b(0x178)),serverExpress[_0x19be3b(0x1aa)](_0x19be3b(0x154),process[_0x19be3b(0x18a)]['PORT']||0xfa0),serverExpress[_0x19be3b(0x1aa)](_0x19be3b(0x173),path[_0x19be3b(0x168)](__dirname,_0x19be3b(0x173))),serverExpress[_0x19be3b(0x1a7)](_0x19be3b(0x185),engine({'defaultLayout':_0x19be3b(0x192),'layoutsDir':path[_0x19be3b(0x168)](serverExpress[_0x19be3b(0x14d)]('views'),_0x19be3b(0x14e)),'partialsDir':path[_0x19be3b(0x168)](serverExpress['get'](_0x19be3b(0x173)),_0x19be3b(0x18c)),'extname':_0x19be3b(0x185),'helpers':require(_0x19be3b(0x1a2))})),serverExpress[_0x19be3b(0x1aa)](_0x19be3b(0x170),_0x19be3b(0x185)),require(_0x19be3b(0x14a))[_0x19be3b(0x155)]();function _0x57d4(){const _0x331b99=['./services/chat.js','./keys','company','family','filter','urlencoded','4409740IMwsjj','./lib/system','sendNotification','dev','Mensaje\x20enviado\x20con\x20Ã©xito.\x20ðŸ‘Œ','./lib/handlebars','image','theUserIsConnect','\x27.\x20IntÃ©ntalo\x20de\x20nuevo.\x20ðŸ˜³','express-handlebars','engine','diskStorage','listen','set','session','userId','public','internal','./router/links','saveANewOrder','Server\x20running\x20on\x20port\x20','newNotification','2heKDog','connection','use','./router/links/cashCut','canSend','./router/links/orders','914290pKuVIO','flash','FudSession','dotenv','./router/links/app','http','get','layouts','sendMessageToUser','log','14844tYNzko','passport','Un\x20usuario\x20se\x20ha\x20conectado','port','config','length','/links','./router/links/subscription','single','disconnect','static','express-recaptcha','get_the_first_notification','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27','get_max_employee_of_this_company','create_new_chat','917HuAaTt','connect-flash','Socket\x20','127.0.0.1','emit','createServer','./router/links/delivery','join','express','IPv4','socketId','pack_company','privateMessage','366ctkGzx','getTheFirstTenNotifications','view\x20engine','39898JzmEuU','address','views','sendAllTheOrders','create_notification','./router/links/ceo','privateNotifications','./lib/editFrom','uuid','desktop','express-session','json','21tESZrJ','locals','./router/links/desktop','success','Pool','user','path','send_new_message','.hbs','./router/links/store','morgan','\x27\x20no\x20existe\x20ðŸ¤”','Nueva\x20notificaciÃ³n:','env','./router','partials','644416zWvMNE','messageStatus','public/img/uploads','2770326HzZcHH','0.0.0.0','main','networkInterfaces','message','\x27\x20no\x20existe.\x20ðŸ¤”','connectionRejected'];_0x57d4=function(){return _0x331b99;};return _0x57d4();}const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process[_0x19be3b(0x18a)],pg=require('pg'),pgPool=new pg[(_0x19be3b(0x181))]({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress[_0x19be3b(0x1b5)](session({'secret':_0x19be3b(0x149),'resave':![],'saveUninitialized':![],'store':new(require('connect-pg-simple')(session))({'pool':pgPool,'tableName':_0x19be3b(0x1ab)})})),serverExpress[_0x19be3b(0x1b5)](flash()),serverExpress[_0x19be3b(0x1b5)](morgan(_0x19be3b(0x1a0))),serverExpress['use'](express[_0x19be3b(0x19c)]({'extended':![]})),serverExpress[_0x19be3b(0x1b5)](express[_0x19be3b(0x17c)]()),serverExpress['use'](passport['initialize']()),serverExpress[_0x19be3b(0x1b5)](passport['session']());const storage=multer[_0x19be3b(0x1a8)]({'destination':path[_0x19be3b(0x168)](__dirname,_0x19be3b(0x18f)),'filename':(_0x5271e8,_0x248c1f,_0xe4443b,_0x59b284)=>{_0xe4443b(null,uuid()+path['extname'](_0x248c1f['originalname']));}});serverExpress['use'](multer({'storage':storage})[_0x19be3b(0x159)](_0x19be3b(0x1a3))),serverExpress[_0x19be3b(0x1b5)]((_0x4fd893,_0x3e489a,_0x1138d4)=>{const _0x1b678e=_0x19be3b;serverExpress['locals'][_0x1b678e(0x180)]=_0x4fd893[_0x1b678e(0x148)](_0x1b678e(0x180)),serverExpress[_0x1b678e(0x17e)][_0x1b678e(0x194)]=_0x4fd893[_0x1b678e(0x148)](_0x1b678e(0x194)),serverExpress[_0x1b678e(0x17e)][_0x1b678e(0x182)]=_0x4fd893['user'],serverExpress[_0x1b678e(0x17e)][_0x1b678e(0x199)]=_0x4fd893[_0x1b678e(0x199)],serverExpress[_0x1b678e(0x17e)][_0x1b678e(0x16c)]=0x0,serverExpress[_0x1b678e(0x17e)]['pack_branch']=0x0,_0x1138d4();});const http=require(_0x19be3b(0x14c)),serverSocket=http[_0x19be3b(0x166)](serverExpress),{Server}=require('socket.io'),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require(_0x19be3b(0x197));serverSocket[_0x19be3b(0x1a9)](serverExpress['get'](_0x19be3b(0x154)),()=>{const _0x5753e6=_0x19be3b;console[_0x5753e6(0x150)](_0x5753e6(0x1b1)+serverExpress[_0x5753e6(0x14d)]('port'));}),io['on'](_0x19be3b(0x1b4),async _0x298939=>{const _0x1e3f87=_0x19be3b;console[_0x1e3f87(0x150)](_0x1e3f87(0x153)),_0x298939['on']('registerUser',async(_0x8bb8d2,_0x5b301c)=>{const _0xc901e=_0x1e3f87,_0x377424=connectedEmployees[_0x5b301c]||[],_0x1cc76b=_0x377424['some'](_0x1674d6=>_0x1674d6[_0xc901e(0x1ac)]===_0x8bb8d2);if(_0x1cc76b){_0x298939['emit'](_0xc901e(0x196),'Ups,\x20parece\x20que\x20ya\x20estÃ¡s\x20conectado\x20en\x20otro\x20dispositivo.');return;}if(system!=_0xc901e(0x17a)){!companyLimitsCache[_0x5b301c]&&(companyLimitsCache[_0x5b301c]=await chat[_0xc901e(0x15f)](_0x5b301c));const _0x57e091=companyLimitsCache[_0x5b301c];if(_0x377424[_0xc901e(0x156)]>=_0x57e091){_0x298939[_0xc901e(0x165)](_0xc901e(0x196),'Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20lÃ­mite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresÃ­a.');return;}}_0x298939['companyId']=_0x5b301c,_0x377424['push']({'userId':_0x8bb8d2,'socketId':_0x298939['id']}),connectedEmployees[_0x5b301c]=_0x377424;const _0x1f7de8=await chat[_0xc901e(0x15d)](_0x8bb8d2,0xa);io['to'](_0x8bb8d2)[_0xc901e(0x165)](_0xc901e(0x177),{'notifications':_0x1f7de8});});async function _0x2e96d3(_0x67aa30){const _0x139eae=users[_0x67aa30];let _0x402b78=_0x139eae;!_0x139eae&&(_0x402b78=await chat['this_email_exist'](toUserId));const _0x58db6b={'canSend':_0x402b78,'theUserIsConnect':_0x139eae};return _0x58db6b;}_0x298939['on']('sendNotificationToUser',async({userEmail:_0x5f0168,toUserEmail:_0x5843af,message:_0x3f7c50})=>{const _0x196d58=_0x1e3f87,_0x5ebb98=await _0x2e96d3(_0x5843af);_0x5ebb98[_0x196d58(0x145)]?await chat[_0x196d58(0x175)](_0x5f0168,_0x5843af,_0x3f7c50)?(_0x5ebb98[_0x196d58(0x1a4)]&&io['to'](recipientSocketId)['emit'](_0x196d58(0x16d),{'userId':userId,'message':_0x3f7c50}),_0x298939[_0x196d58(0x165)](_0x196d58(0x18e),{'success':!![],'message':_0x196d58(0x1a1)})):_0x298939[_0x196d58(0x165)](_0x196d58(0x18e),{'success':![],'message':_0x196d58(0x15e)+_0x5843af+_0x196d58(0x1a5)}):_0x298939[_0x196d58(0x165)](_0x196d58(0x18e),{'success':![],'message':'El\x20usuario\x20\x27'+_0x5843af+_0x196d58(0x195)});}),_0x298939['on'](_0x1e3f87(0x16f),async({userEmail:_0x43afca})=>{const _0x1f8874=_0x1e3f87,_0x365eb5=await chat[_0x1f8874(0x15d)](_0x43afca,0xa);io['to'](recipientSocketId)[_0x1f8874(0x165)](_0x1f8874(0x177),{'notifications':_0x365eb5});}),_0x298939['on'](_0x1e3f87(0x14f),async({userId:_0x456184,toUserId:_0x5ba76d,message:_0x2ce111})=>{const _0x1fb263=_0x1e3f87,_0x256853=users[_0x5ba76d];let _0x40dfe6=_0x256853;!_0x256853&&(_0x40dfe6=await chat['this_email_exist'](_0x5ba76d));if(_0x40dfe6){const _0x1a01ba=await chat[_0x1fb263(0x160)](_0x456184,_0x5ba76d);await chat[_0x1fb263(0x184)](_0x1a01ba,_0x456184,_0x2ce111)&&(_0x256853&&io['to'](_0x256853)[_0x1fb263(0x165)](_0x1fb263(0x16d),{'userId':_0x456184,'message':_0x2ce111})),_0x298939[_0x1fb263(0x165)](_0x1fb263(0x18e),{'success':!![],'message':'Mensaje\x20enviado\x20con\x20Ã©xito'});}else _0x298939[_0x1fb263(0x165)](_0x1fb263(0x18e),{'success':![],'message':'Este\x20email\x20\x27'+_0x5ba76d+_0x1fb263(0x188)});}),_0x298939['on'](_0x1e3f87(0x15a),()=>{const _0x364257=_0x1e3f87,{companyId:_0x30606e}=_0x298939;_0x30606e&&connectedEmployees[_0x30606e]?(connectedEmployees[_0x30606e]=connectedEmployees[_0x30606e][_0x364257(0x19b)](_0x6a619b=>_0x6a619b[_0x364257(0x16b)]!==_0x298939['id']),connectedEmployees[_0x30606e][_0x364257(0x156)]===0x0&&delete connectedEmployees[_0x30606e]):console[_0x364257(0x150)](_0x364257(0x163)+_0x298939['id']+'\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.');}),_0x298939['on'](_0x1e3f87(0x19f),_0x2d697f=>{const _0x593877=_0x1e3f87;console[_0x593877(0x150)](_0x593877(0x189),_0x2d697f),_0x298939['broadcast'][_0x593877(0x165)](_0x593877(0x1b2),_0x2d697f);}),_0x298939['on'](_0x1e3f87(0x174),_0x57e102=>{const _0x576f35=_0x1e3f87;_0x298939[_0x576f35(0x165)]('getAllTheOrders',{'orderKitchen':orderKitchen});}),_0x298939['on'](_0x1e3f87(0x1b0),_0x35cae=>{const _0x405252=_0x1e3f87,_0x52ad68=JSON['parse'](_0x35cae);_0x52ad68['id']=orderKitchen[_0x405252(0x156)]+0x1,orderKitchen['push'](_0x52ad68);});});const companyName=_0x19be3b(0x157);serverExpress[_0x19be3b(0x1b5)](require(_0x19be3b(0x18b))),serverExpress[_0x19be3b(0x1b5)](require('./router/authentication')),serverExpress[_0x19be3b(0x1b5)](companyName,require(_0x19be3b(0x1af))),serverExpress[_0x19be3b(0x1b5)](companyName,require('./router/links/fudone')),serverExpress[_0x19be3b(0x1b5)](companyName,require(_0x19be3b(0x176))),serverExpress['use'](companyName,require('./router/links/branch')),serverExpress[_0x19be3b(0x1b5)](companyName,require(_0x19be3b(0x158))),serverExpress[_0x19be3b(0x1b5)](companyName,require(_0x19be3b(0x186))),serverExpress[_0x19be3b(0x1b5)](companyName,require(_0x19be3b(0x167))),serverExpress[_0x19be3b(0x1b5)](companyName,require(_0x19be3b(0x14b))),serverExpress['use'](companyName,require('./router/links/CRM')),serverExpress['use'](companyName,require(_0x19be3b(0x17f))),serverExpress[_0x19be3b(0x1b5)](companyName,require('./router/links/boutique')),serverExpress['use'](companyName,require(_0x19be3b(0x144))),serverExpress['use'](companyName,require(_0x19be3b(0x146))),serverExpress[_0x19be3b(0x1b5)](require('./lib/addFrom')),serverExpress['use'](express[_0x19be3b(0x15b)](path[_0x19be3b(0x168)](__dirname,_0x19be3b(0x1ad))));const os=require('os');function _0x9276(_0x5514eb,_0x28db36){const _0x57d43d=_0x57d4();return _0x9276=function(_0x92769d,_0x158ae1){_0x92769d=_0x92769d-0x144;let _0x2a245a=_0x57d43d[_0x92769d];return _0x2a245a;},_0x9276(_0x5514eb,_0x28db36);}function getLocalIP(){const _0xf7ead5=_0x19be3b,_0x12f275=os[_0xf7ead5(0x193)]();for(let _0x45247e in _0x12f275){for(let _0x433500=0x0;_0x433500<_0x12f275[_0x45247e]['length'];_0x433500++){const _0x39ade5=_0x12f275[_0x45247e][_0x433500];if(_0x39ade5[_0xf7ead5(0x19a)]===_0xf7ead5(0x16a)&&!_0x39ade5[_0xf7ead5(0x1ae)])return _0x39ade5[_0xf7ead5(0x172)];}}return _0xf7ead5(0x164);}serverExpress['listen'](serverExpress[_0x19be3b(0x14d)](_0x19be3b(0x154)),_0x19be3b(0x191),()=>{const _0x65a3=_0x19be3b;console[_0x65a3(0x150)]('Server\x20running\x20on\x20http://'+getLocalIP()+':'+serverExpress[_0x65a3(0x14d)](_0x65a3(0x154)));});