const _0x16d905=_0x42a7;(function(_0x534e21,_0x58f3f6){const _0x241482=_0x42a7,_0x559a09=_0x534e21();while(!![]){try{const _0x562ab0=parseInt(_0x241482(0x12c))/0x1+parseInt(_0x241482(0x105))/0x2*(parseInt(_0x241482(0x129))/0x3)+-parseInt(_0x241482(0x14f))/0x4*(parseInt(_0x241482(0x107))/0x5)+parseInt(_0x241482(0x142))/0x6+parseInt(_0x241482(0x12a))/0x7*(parseInt(_0x241482(0x171))/0x8)+-parseInt(_0x241482(0x114))/0x9+-parseInt(_0x241482(0x174))/0xa*(parseInt(_0x241482(0x162))/0xb);if(_0x562ab0===_0x58f3f6)break;else _0x559a09['push'](_0x559a09['shift']());}catch(_0x371b33){_0x559a09['push'](_0x559a09['shift']());}}}(_0x5f18,0x82739));const system=require(_0x16d905(0x153)),express=require(_0x16d905(0x13d)),morgan=require(_0x16d905(0x128)),{engine}=require(_0x16d905(0x117)),multer=require(_0x16d905(0x132)),flash=require('connect-flash'),session=require(_0x16d905(0x125)),passport=require(_0x16d905(0x15b)),{database}=require('./keys'),{v4:uuid}=require(_0x16d905(0x127)),path=require(_0x16d905(0x16b)),{RecaptchaV2}=require(_0x16d905(0x157)),nodePersist=require(_0x16d905(0x178));function _0x5f18(){const _0x159498=['engine','.js','companyId','use','express','utf8','📦\x20Base\x20de\x20datos\x20EDPLUS\x20creada','company','hex','2552472GbTkJo','.hbs','push','get','./router','statSync','connect','./services/chat.js','\x27\x20no\x20existe\x20🤔','originalname','./characterDatabase','filter','env','108ptRwvz','/links','parse','Mensaje\x20enviado\x20con\x20éxito.\x20👌','./lib/system','messageStatus','join','\x27.\x20Inténtalo\x20de\x20nuevo.\x20😳','express-recaptcha','saveANewOrder','Socket\x20','forEach','passport','http','connect-pg-simple','\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.','./router/links','edplus.sql','Mensaje\x20enviado\x20con\x20éxito','55ghcFdF','Nueva\x20notificación:','some','log','IPv4','sendNotificationToUser','main','internal','0.0.0.0','path','router/links','📂\x20La\x20base\x20de\x20datos\x20EDPLUS\x20ya\x20existe,\x20no\x20se\x20creó\x20nuevamente.','\x0aENCRYPTION_KEY=','trim','public','200hcCNOW','views','FudSession','2618870thnTkQ','length','error','query','node-persist','create_notification','locals','connection','emit','database','create_new_chat','address','El\x20usuario\x20\x27','family','image','Pool','ENCRYPTION_KEY=','socketId','networkInterfaces','Este\x20email\x20\x27','set','layouts','diskStorage','Server\x20running\x20on\x20port\x20','crypto','460688fhvZfs','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27','107430PjkDcE','pack_company','readFileSync','getAllTheOrders','resolve','init','initialize','readdirSync','PORT','./router/authentication','./lib/editFrom','message','createServer','2453706iGXVWL','send_new_message','dotenv','express-handlebars','session','success','canSend','listen','data','includes','./lib/addFrom','❌\x20Error\x20ejecutando\x20SQL:','release','static','privateMessage','userId','port','express-session','existsSync','uuid','morgan','12KdbRlh','155015LKAjCi','✅\x20ENCRYPTION_KEY\x20generado\x20y\x20guardado\x20en\x20.env','796107Uotcko','connectionRejected','./lib/handlebars','map','\x27\x20no\x20existe.\x20🤔','get_the_first_notification','multer','sendAllTheOrders','Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20límite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresía.','flash','writeFileSync','split','this_email_exist'];_0x5f18=function(){return _0x159498;};return _0x5f18();}nodePersist[_0x16d905(0x10c)]({'dir':path['join'](__dirname,_0x16d905(0x11c))});const serverExpress=express();require('./lib/passport'),require(_0x16d905(0x111)),serverExpress[_0x16d905(0x100)](_0x16d905(0x124),process['env'][_0x16d905(0x10f)]||0xfa0),serverExpress[_0x16d905(0x100)]('views',path[_0x16d905(0x155)](__dirname,_0x16d905(0x172))),serverExpress[_0x16d905(0x139)]('.hbs',engine({'defaultLayout':_0x16d905(0x168),'layoutsDir':path[_0x16d905(0x155)](serverExpress['get'](_0x16d905(0x172)),_0x16d905(0x101)),'partialsDir':path['join'](serverExpress['get'](_0x16d905(0x172)),'partials'),'extname':'.hbs','helpers':require(_0x16d905(0x12e))})),serverExpress['set']('view\x20engine',_0x16d905(0x143));const fs=require('fs'),crypto=require(_0x16d905(0x104)),envPath=path[_0x16d905(0x10b)](__dirname,'../.env');let envContent=fs[_0x16d905(0x126)](envPath)?fs[_0x16d905(0x109)](envPath,_0x16d905(0x13e)):'';if(!envContent[_0x16d905(0x11d)](_0x16d905(0xfc))){const newKey=crypto['randomBytes'](0x20)['toString'](_0x16d905(0x141));envContent+=_0x16d905(0x16e)+newKey+'\x0a',fs[_0x16d905(0x136)](envPath,envContent),console[_0x16d905(0x165)](_0x16d905(0x12b));}else console[_0x16d905(0x165)]('🔐\x20ENCRYPTION_KEY\x20ya\x20existe\x20en\x20.env');require(_0x16d905(0x116))['config']();function _0x42a7(_0x3fadae,_0x798a1d){const _0x5f1811=_0x5f18();return _0x42a7=function(_0x42a79e,_0x2d59a2){_0x42a79e=_0x42a79e-0xf1;let _0x302028=_0x5f1811[_0x42a79e];return _0x302028;},_0x42a7(_0x3fadae,_0x798a1d);}const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process[_0x16d905(0x14e)],pg=require('pg'),adminPool=new pg['Pool']({'user':APP_PG_USER,'host':APP_PG_HOST,'password':APP_PG_PASSWORD,'port':APP_PG_PORT,'database':APP_PG_DATABASE}),importSQLFile=async _0x2721a2=>{const _0x1cc54f=_0x16d905,_0x30f0b0=path['join'](__dirname,_0x1cc54f(0xf5),_0x1cc54f(0x160)),_0xf7ceb7=fs[_0x1cc54f(0x109)](_0x30f0b0,'utf8'),_0x8e9dc3=_0xf7ceb7[_0x1cc54f(0x137)](/;\s*$/m)[_0x1cc54f(0x12f)](_0x534807=>_0x534807[_0x1cc54f(0x16f)]())[_0x1cc54f(0x14d)](_0x5f5b0a=>_0x5f5b0a[_0x1cc54f(0x175)]>0x0),_0x4a8f96=await _0x2721a2[_0x1cc54f(0x148)]();try{for(const _0x50030c of _0x8e9dc3){await _0x4a8f96[_0x1cc54f(0x177)](_0x50030c);}console[_0x1cc54f(0x165)]('✅\x20SQL\x20ejecutado\x20correctamente');}catch(_0x78ac3b){console[_0x1cc54f(0x176)](_0x1cc54f(0x11f),_0x78ac3b[_0x1cc54f(0x112)]);}finally{_0x4a8f96[_0x1cc54f(0x120)]();}},{create_update_of_the_database}=require(_0x16d905(0x14c)),createDatabase=async()=>{const _0x318054=_0x16d905,_0x2587ff=await adminPool[_0x318054(0x177)]('SELECT\x201\x20FROM\x20pg_database\x20WHERE\x20datname\x20=\x20\x27edplus\x27');_0x2587ff['rowCount']===0x0?(await adminPool['query']('CREATE\x20DATABASE\x20edplus'),importSQLFile(adminPool),console['log'](_0x318054(0x13f))):(console[_0x318054(0x165)](_0x318054(0x16d)),await create_update_of_the_database(adminPool));};createDatabase();const pgPool=new pg[(_0x16d905(0xfb))]({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress['use'](session({'secret':_0x16d905(0x173),'resave':![],'saveUninitialized':![],'store':new(require(_0x16d905(0x15d))(session))({'pool':pgPool,'tableName':_0x16d905(0x118)})})),serverExpress['use'](flash()),serverExpress[_0x16d905(0x13c)](morgan('dev')),serverExpress[_0x16d905(0x13c)](express['urlencoded']({'extended':![]})),serverExpress[_0x16d905(0x13c)](express['json']()),serverExpress[_0x16d905(0x13c)](passport[_0x16d905(0x10d)]()),serverExpress[_0x16d905(0x13c)](passport[_0x16d905(0x118)]());const storageImages=multer[_0x16d905(0x102)]({'destination':path[_0x16d905(0x155)](__dirname,'public/img/uploads'),'filename':(_0x523096,_0x3154b8,_0x25ae80)=>{const _0x4485c2=_0x16d905;_0x25ae80(null,uuid()+path['extname'](_0x3154b8[_0x4485c2(0x14b)]));}});serverExpress[_0x16d905(0x13c)](multer({'storage':storageImages})['single'](_0x16d905(0xfa))),serverExpress['use']((_0x2c7445,_0x30d635,_0x433fff)=>{const _0x463786=_0x16d905;serverExpress['locals']['success']=_0x2c7445[_0x463786(0x135)](_0x463786(0x119)),serverExpress[_0x463786(0xf2)][_0x463786(0x112)]=_0x2c7445[_0x463786(0x135)](_0x463786(0x112)),serverExpress['locals']['user']=_0x2c7445['user'],serverExpress[_0x463786(0xf2)][_0x463786(0x140)]=_0x2c7445[_0x463786(0x140)],serverExpress[_0x463786(0xf2)][_0x463786(0x108)]=0x0,serverExpress[_0x463786(0xf2)]['pack_branch']=0x0,_0x433fff();});const http=require(_0x16d905(0x15c)),serverSocket=http[_0x16d905(0x113)](serverExpress),{Server}=require('socket.io'),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require(_0x16d905(0x149));serverSocket[_0x16d905(0x11b)](serverExpress[_0x16d905(0x145)](_0x16d905(0x124)),()=>{const _0x481f9e=_0x16d905;console['log'](_0x481f9e(0x103)+serverExpress[_0x481f9e(0x145)](_0x481f9e(0x124)));}),io['on'](_0x16d905(0xf3),async _0x413d18=>{const _0x23eab7=_0x16d905;console[_0x23eab7(0x165)]('Un\x20usuario\x20se\x20ha\x20conectado'),_0x413d18['on']('registerUser',async(_0x38d97c,_0x20d847)=>{const _0x964e7b=_0x23eab7,_0x3f139d=connectedEmployees[_0x20d847]||[],_0x323603=_0x3f139d[_0x964e7b(0x164)](_0x2e221d=>_0x2e221d[_0x964e7b(0x123)]===_0x38d97c);if(_0x323603){_0x413d18[_0x964e7b(0xf4)](_0x964e7b(0x12d),'Ups,\x20parece\x20que\x20ya\x20estás\x20conectado\x20en\x20otro\x20dispositivo.');return;}if(system!='desktop'){!companyLimitsCache[_0x20d847]&&(companyLimitsCache[_0x20d847]=await chat['get_max_employee_of_this_company'](_0x20d847));const _0x379f9b=companyLimitsCache[_0x20d847];if(_0x3f139d['length']>=_0x379f9b){_0x413d18[_0x964e7b(0xf4)]('connectionRejected',_0x964e7b(0x134));return;}}_0x413d18[_0x964e7b(0x13b)]=_0x20d847,_0x3f139d[_0x964e7b(0x144)]({'userId':_0x38d97c,'socketId':_0x413d18['id']}),connectedEmployees[_0x20d847]=_0x3f139d;const _0x435c3a=await chat[_0x964e7b(0x131)](_0x38d97c,0xa);io['to'](_0x38d97c)[_0x964e7b(0xf4)]('privateNotifications',{'notifications':_0x435c3a});});async function _0x416134(_0x59f7a6){const _0xab303f=_0x23eab7,_0x3676ec=users[_0x59f7a6];let _0x3d2d20=_0x3676ec;!_0x3676ec&&(_0x3d2d20=await chat[_0xab303f(0x138)](toUserId));const _0x58c461={'canSend':_0x3d2d20,'theUserIsConnect':_0x3676ec};return _0x58c461;}_0x413d18['on'](_0x23eab7(0x167),async({userEmail:_0x54a1cb,toUserEmail:_0x30f074,message:_0x2921cf})=>{const _0x140c4d=_0x23eab7,_0x4e218d=await _0x416134(_0x30f074);_0x4e218d[_0x140c4d(0x11a)]?await chat[_0x140c4d(0xf1)](_0x54a1cb,_0x30f074,_0x2921cf)?(_0x4e218d['theUserIsConnect']&&io['to'](recipientSocketId)[_0x140c4d(0xf4)](_0x140c4d(0x122),{'userId':userId,'message':_0x2921cf}),_0x413d18[_0x140c4d(0xf4)]('messageStatus',{'success':!![],'message':_0x140c4d(0x152)})):_0x413d18[_0x140c4d(0xf4)](_0x140c4d(0x154),{'success':![],'message':_0x140c4d(0x106)+_0x30f074+_0x140c4d(0x156)}):_0x413d18[_0x140c4d(0xf4)]('messageStatus',{'success':![],'message':_0x140c4d(0xf8)+_0x30f074+_0x140c4d(0x130)});}),_0x413d18['on']('getTheFirstTenNotifications',async({userEmail:_0x75bb5e})=>{const _0x1671d3=_0x23eab7,_0x98fa7b=await chat[_0x1671d3(0x131)](_0x75bb5e,0xa);io['to'](recipientSocketId)[_0x1671d3(0xf4)]('privateNotifications',{'notifications':_0x98fa7b});}),_0x413d18['on']('sendMessageToUser',async({userId:_0x377515,toUserId:_0x2c318e,message:_0x2082d0})=>{const _0x55c8f2=_0x23eab7,_0x56d39d=users[_0x2c318e];let _0x2b4d81=_0x56d39d;!_0x56d39d&&(_0x2b4d81=await chat['this_email_exist'](_0x2c318e));if(_0x2b4d81){const _0x206c5b=await chat[_0x55c8f2(0xf6)](_0x377515,_0x2c318e);await chat[_0x55c8f2(0x115)](_0x206c5b,_0x377515,_0x2082d0)&&(_0x56d39d&&io['to'](_0x56d39d)['emit']('privateMessage',{'userId':_0x377515,'message':_0x2082d0})),_0x413d18[_0x55c8f2(0xf4)](_0x55c8f2(0x154),{'success':!![],'message':_0x55c8f2(0x161)});}else _0x413d18[_0x55c8f2(0xf4)]('messageStatus',{'success':![],'message':_0x55c8f2(0xff)+_0x2c318e+_0x55c8f2(0x14a)});}),_0x413d18['on']('disconnect',()=>{const _0x6ec551=_0x23eab7,{companyId:_0x2dd05c}=_0x413d18;_0x2dd05c&&connectedEmployees[_0x2dd05c]?(connectedEmployees[_0x2dd05c]=connectedEmployees[_0x2dd05c][_0x6ec551(0x14d)](_0x2307d5=>_0x2307d5[_0x6ec551(0xfd)]!==_0x413d18['id']),connectedEmployees[_0x2dd05c][_0x6ec551(0x175)]===0x0&&delete connectedEmployees[_0x2dd05c]):console['log'](_0x6ec551(0x159)+_0x413d18['id']+_0x6ec551(0x15e));}),_0x413d18['on']('sendNotification',_0x36413a=>{const _0x5b2a19=_0x23eab7;console[_0x5b2a19(0x165)](_0x5b2a19(0x163),_0x36413a),_0x413d18['broadcast'][_0x5b2a19(0xf4)]('newNotification',_0x36413a);}),_0x413d18['on'](_0x23eab7(0x133),_0x34417a=>{const _0x1e7b9f=_0x23eab7;_0x413d18[_0x1e7b9f(0xf4)](_0x1e7b9f(0x10a),{'orderKitchen':orderKitchen});}),_0x413d18['on'](_0x23eab7(0x158),_0x447314=>{const _0x5e29fe=_0x23eab7,_0x18ed95=JSON[_0x5e29fe(0x151)](_0x447314);_0x18ed95['id']=orderKitchen['length']+0x1,orderKitchen[_0x5e29fe(0x144)](_0x18ed95);});});const companyName=_0x16d905(0x150);serverExpress[_0x16d905(0x13c)](require(_0x16d905(0x146))),serverExpress['use'](require(_0x16d905(0x110))),serverExpress[_0x16d905(0x13c)](companyName,require(_0x16d905(0x15f)));const routesPath=path[_0x16d905(0x155)](__dirname,_0x16d905(0x16c));fs[_0x16d905(0x10e)](routesPath)[_0x16d905(0x15a)](_0x2d2319=>{const _0x4e45ec=_0x16d905,_0x629650=path[_0x4e45ec(0x155)](routesPath,_0x2d2319);fs[_0x4e45ec(0x147)](_0x629650)['isFile']()&&_0x2d2319['endsWith'](_0x4e45ec(0x13a))&&serverExpress[_0x4e45ec(0x13c)](companyName,require(_0x629650));}),serverExpress[_0x16d905(0x13c)](require(_0x16d905(0x11e))),serverExpress[_0x16d905(0x13c)](express[_0x16d905(0x121)](path['join'](__dirname,_0x16d905(0x170))));const os=require('os');function getLocalIP(){const _0x452a48=_0x16d905,_0x1a9ba9=os[_0x452a48(0xfe)]();for(let _0x11e8c3 in _0x1a9ba9){for(let _0x867e45=0x0;_0x867e45<_0x1a9ba9[_0x11e8c3][_0x452a48(0x175)];_0x867e45++){const _0x232725=_0x1a9ba9[_0x11e8c3][_0x867e45];if(_0x232725[_0x452a48(0xf9)]===_0x452a48(0x166)&&!_0x232725[_0x452a48(0x169)])return _0x232725[_0x452a48(0xf7)];}}return'127.0.0.1';}serverExpress[_0x16d905(0x11b)](serverExpress[_0x16d905(0x145)](_0x16d905(0x124)),_0x16d905(0x16a),()=>{console['log']('Server\x20running\x20on\x20http://'+getLocalIP()+':'+serverExpress['get']('port'));});