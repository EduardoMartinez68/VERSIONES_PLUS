const _0xf858bb=_0x371f;(function(_0x242952,_0x1cd2a6){const _0x1c6508=_0x371f,_0x48427f=_0x242952();while(!![]){try{const _0x403d3c=-parseInt(_0x1c6508(0x83))/0x1*(parseInt(_0x1c6508(0x82))/0x2)+-parseInt(_0x1c6508(0x94))/0x3*(parseInt(_0x1c6508(0x76))/0x4)+-parseInt(_0x1c6508(0xe5))/0x5+-parseInt(_0x1c6508(0x87))/0x6*(-parseInt(_0x1c6508(0x96))/0x7)+-parseInt(_0x1c6508(0x9e))/0x8*(parseInt(_0x1c6508(0xa3))/0x9)+parseInt(_0x1c6508(0x7b))/0xa*(-parseInt(_0x1c6508(0xc7))/0xb)+parseInt(_0x1c6508(0x78))/0xc;if(_0x403d3c===_0x1cd2a6)break;else _0x48427f['push'](_0x48427f['shift']());}catch(_0x129cda){_0x48427f['push'](_0x48427f['shift']());}}}(_0x1cdc,0x46a98));const system=require('./lib/system'),express=require(_0xf858bb(0x9c)),morgan=require(_0xf858bb(0xad)),{engine}=require('express-handlebars'),multer=require('multer'),flash=require(_0xf858bb(0xa4)),session=require('express-session'),passport=require(_0xf858bb(0x8c)),{database}=require(_0xf858bb(0xde)),{v4:uuid}=require('uuid'),path=require(_0xf858bb(0x84)),{RecaptchaV2}=require(_0xf858bb(0xbb)),serverExpress=express();require('./lib/passport'),require(_0xf858bb(0xc6)),serverExpress[_0xf858bb(0xd8)]('port',process[_0xf858bb(0xa8)][_0xf858bb(0xa6)]||0xfa0),serverExpress[_0xf858bb(0xd8)](_0xf858bb(0xe0),path['join'](__dirname,_0xf858bb(0xe0))),serverExpress[_0xf858bb(0xb8)](_0xf858bb(0x7a),engine({'defaultLayout':'main','layoutsDir':path[_0xf858bb(0x6c)](serverExpress[_0xf858bb(0xdf)](_0xf858bb(0xe0)),_0xf858bb(0xdd)),'partialsDir':path['join'](serverExpress['get']('views'),_0xf858bb(0x99)),'extname':_0xf858bb(0x7a),'helpers':require(_0xf858bb(0xba))})),serverExpress[_0xf858bb(0xd8)](_0xf858bb(0xa0),'.hbs'),require(_0xf858bb(0x73))[_0xf858bb(0x93)]();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process[_0xf858bb(0xa8)],pg=require('pg'),fs=require('fs'),adminPool=new pg[(_0xf858bb(0x7f))]({'user':APP_PG_USER,'host':APP_PG_HOST,'password':APP_PG_PASSWORD,'port':APP_PG_PORT,'database':_0xf858bb(0xda)}),importSQLFile=async _0x16b3a8=>{const _0x265d8f=_0xf858bb,_0x5cda5e=path[_0x265d8f(0x6c)](__dirname,_0x265d8f(0xc5),_0x265d8f(0xac)),_0x14f07b=fs['readFileSync'](_0x5cda5e,_0x265d8f(0xc0)),_0xe5a1=_0x14f07b[_0x265d8f(0xae)](/;\s*$/m)[_0x265d8f(0xd6)](_0x137926=>_0x137926[_0x265d8f(0x8b)]())[_0x265d8f(0x9f)](_0xbb8a52=>_0xbb8a52[_0x265d8f(0xb2)]>0x0),_0x38b48c=await _0x16b3a8['connect']();try{for(const _0x31259a of _0xe5a1){await _0x38b48c['query'](_0x31259a);}console[_0x265d8f(0xa9)](_0x265d8f(0xc4));}catch(_0x3c6b8e){console[_0x265d8f(0xb9)](_0x265d8f(0xcf),_0x3c6b8e[_0x265d8f(0x89)]);}finally{_0x38b48c[_0x265d8f(0xbc)]();}},createDatabase=async()=>{const _0x501c37=_0xf858bb,_0x5a942f=await adminPool[_0x501c37(0x91)](_0x501c37(0x6e));_0x5a942f['rowCount']===0x0?(await adminPool[_0x501c37(0x91)](_0x501c37(0x7c)),importSQLFile(adminPool),console[_0x501c37(0xa9)](_0x501c37(0xc3))):console['log']('📂\x20La\x20base\x20de\x20datos\x20EDPLUS\x20ya\x20existe,\x20no\x20se\x20creó\x20nuevamente.');};createDatabase();const pgPool=new pg[(_0xf858bb(0x7f))]({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress[_0xf858bb(0xdb)](session({'secret':'FudSession','resave':![],'saveUninitialized':![],'store':new(require('connect-pg-simple')(session))({'pool':pgPool,'tableName':'session'})})),serverExpress[_0xf858bb(0xdb)](flash()),serverExpress[_0xf858bb(0xdb)](morgan('dev')),serverExpress[_0xf858bb(0xdb)](express[_0xf858bb(0x71)]({'extended':![]})),serverExpress[_0xf858bb(0xdb)](express[_0xf858bb(0xc2)]()),serverExpress[_0xf858bb(0xdb)](passport[_0xf858bb(0x9a)]()),serverExpress[_0xf858bb(0xdb)](passport[_0xf858bb(0xb3)]());const storage=multer[_0xf858bb(0xa1)]({'destination':path[_0xf858bb(0x6c)](__dirname,_0xf858bb(0xd4)),'filename':(_0x5c7bfa,_0xfd61f4,_0x35d33e,_0x10a282)=>{const _0x29a3ec=_0xf858bb;_0x35d33e(null,uuid()+path[_0x29a3ec(0x69)](_0xfd61f4['originalname']));}});serverExpress[_0xf858bb(0xdb)](multer({'storage':storage})['single']('image')),serverExpress['use']((_0x5b3c45,_0x142937,_0x14ca6a)=>{const _0x43b306=_0xf858bb;serverExpress['locals'][_0x43b306(0x6a)]=_0x5b3c45[_0x43b306(0x8e)]('success'),serverExpress['locals'][_0x43b306(0x89)]=_0x5b3c45[_0x43b306(0x8e)](_0x43b306(0x89)),serverExpress['locals'][_0x43b306(0x75)]=_0x5b3c45[_0x43b306(0x75)],serverExpress['locals'][_0x43b306(0x88)]=_0x5b3c45['company'],serverExpress[_0x43b306(0x86)]['pack_company']=0x0,serverExpress[_0x43b306(0x86)][_0x43b306(0x8a)]=0x0,_0x14ca6a();});function _0x1cdc(){const _0xb6d602=['20881932HODtSQ','canSend','.hbs','220RQrPPP','CREATE\x20DATABASE\x20edplus','./router/links/ceo','static','Pool','get_the_first_notification','saveANewOrder','4FwJfqs','174887qTSrVg','path','this_email_exist','locals','532776kMtlvG','company','message','pack_branch','trim','passport','Server\x20running\x20on\x20http://','flash','./router/links/app','IPv4','query','messageStatus','config','1160469kKWnat','create_notification','35jTnHVH','./router/links/branch','registerUser','partials','initialize','emit','express','http','2104kimfav','filter','view\x20engine','diskStorage','parse','4293QdaKyR','connect-flash','broadcast','PORT','desktop','env','log','Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20límite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresía.','public','edplus.sql','morgan','split','./router/links','userId','El\x20usuario\x20\x27','length','session','connection','getTheFirstTenNotifications','Este\x20email\x20\x27','./router/links/desktop','engine','error','./lib/handlebars','express-recaptcha','release','getAllTheOrders','./router/links/fudone','\x27\x20no\x20existe.\x20🤔','utf8','Nueva\x20notificación:','json','📦\x20Base\x20de\x20datos\x20EDPLUS\x20creada','✅\x20SQL\x20ejecutado\x20correctamente','database','./lib/editFrom','229823cqBBfw','Un\x20usuario\x20se\x20ha\x20conectado','./router/links/orders','privateNotifications','sendNotificationToUser','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27','get_max_employee_of_this_company','disconnect','❌\x20Error\x20ejecutando\x20SQL:','Mensaje\x20enviado\x20con\x20éxito.\x20👌','connectionRejected','./router/links/delivery','theUserIsConnect','public/img/uploads','./router/authentication','map','Server\x20running\x20on\x20port\x20','set','\x27.\x20Inténtalo\x20de\x20nuevo.\x20😳','postgres','use','createServer','layouts','./keys','get','views','\x27\x20no\x20existe\x20🤔','./router/links/boutique','./router','./router/links/prescription','2865075PfRzDJ','companyId','push','sendAllTheOrders','./services/chat.js','/links','extname','success','internal','join','\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.','SELECT\x201\x20FROM\x20pg_database\x20WHERE\x20datname\x20=\x20\x27edplus\x27','socket.io','some','urlencoded','Ups,\x20parece\x20que\x20ya\x20estás\x20conectado\x20en\x20otro\x20dispositivo.','dotenv','port','user','4eVfMTY','family'];_0x1cdc=function(){return _0xb6d602;};return _0x1cdc();}const http=require(_0xf858bb(0x9d)),serverSocket=http[_0xf858bb(0xdc)](serverExpress),{Server}=require(_0xf858bb(0x6f)),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require(_0xf858bb(0xe9));serverSocket['listen'](serverExpress[_0xf858bb(0xdf)](_0xf858bb(0x74)),()=>{const _0x2bf980=_0xf858bb;console[_0x2bf980(0xa9)](_0x2bf980(0xd7)+serverExpress[_0x2bf980(0xdf)]('port'));}),io['on'](_0xf858bb(0xb4),async _0x22c31a=>{const _0x35b60f=_0xf858bb;console['log'](_0x35b60f(0xc8)),_0x22c31a['on'](_0x35b60f(0x98),async(_0x199d12,_0xf4307a)=>{const _0x46719a=_0x35b60f,_0x6e1fcc=connectedEmployees[_0xf4307a]||[],_0x22833f=_0x6e1fcc[_0x46719a(0x70)](_0x194915=>_0x194915[_0x46719a(0xb0)]===_0x199d12);if(_0x22833f){_0x22c31a[_0x46719a(0x9b)](_0x46719a(0xd1),_0x46719a(0x72));return;}if(system!=_0x46719a(0xa7)){!companyLimitsCache[_0xf4307a]&&(companyLimitsCache[_0xf4307a]=await chat[_0x46719a(0xcd)](_0xf4307a));const _0x440674=companyLimitsCache[_0xf4307a];if(_0x6e1fcc['length']>=_0x440674){_0x22c31a['emit'](_0x46719a(0xd1),_0x46719a(0xaa));return;}}_0x22c31a[_0x46719a(0xe6)]=_0xf4307a,_0x6e1fcc[_0x46719a(0xe7)]({'userId':_0x199d12,'socketId':_0x22c31a['id']}),connectedEmployees[_0xf4307a]=_0x6e1fcc;const _0x114e68=await chat['get_the_first_notification'](_0x199d12,0xa);io['to'](_0x199d12)[_0x46719a(0x9b)](_0x46719a(0xca),{'notifications':_0x114e68});});async function _0x1ac98f(_0x3bd887){const _0x58b926=_0x35b60f,_0x54e3b0=users[_0x3bd887];let _0x30fe4b=_0x54e3b0;!_0x54e3b0&&(_0x30fe4b=await chat[_0x58b926(0x85)](toUserId));const _0x12c139={'canSend':_0x30fe4b,'theUserIsConnect':_0x54e3b0};return _0x12c139;}_0x22c31a['on'](_0x35b60f(0xcb),async({userEmail:_0xdd7217,toUserEmail:_0x2daa7c,message:_0x3d9e85})=>{const _0x143f36=_0x35b60f,_0x2e93ed=await _0x1ac98f(_0x2daa7c);_0x2e93ed[_0x143f36(0x79)]?await chat[_0x143f36(0x95)](_0xdd7217,_0x2daa7c,_0x3d9e85)?(_0x2e93ed[_0x143f36(0xd3)]&&io['to'](recipientSocketId)[_0x143f36(0x9b)]('privateMessage',{'userId':userId,'message':_0x3d9e85}),_0x22c31a[_0x143f36(0x9b)](_0x143f36(0x92),{'success':!![],'message':_0x143f36(0xd0)})):_0x22c31a[_0x143f36(0x9b)](_0x143f36(0x92),{'success':![],'message':_0x143f36(0xcc)+_0x2daa7c+_0x143f36(0xd9)}):_0x22c31a[_0x143f36(0x9b)](_0x143f36(0x92),{'success':![],'message':_0x143f36(0xb1)+_0x2daa7c+_0x143f36(0xbf)});}),_0x22c31a['on'](_0x35b60f(0xb5),async({userEmail:_0x5ebee1})=>{const _0xd16ea8=_0x35b60f,_0x367932=await chat[_0xd16ea8(0x80)](_0x5ebee1,0xa);io['to'](recipientSocketId)[_0xd16ea8(0x9b)](_0xd16ea8(0xca),{'notifications':_0x367932});}),_0x22c31a['on']('sendMessageToUser',async({userId:_0x44c5fa,toUserId:_0x474c18,message:_0x5211ee})=>{const _0x2652c5=_0x35b60f,_0x1b650e=users[_0x474c18];let _0x293927=_0x1b650e;!_0x1b650e&&(_0x293927=await chat[_0x2652c5(0x85)](_0x474c18));if(_0x293927){const _0x4851a8=await chat['create_new_chat'](_0x44c5fa,_0x474c18);await chat['send_new_message'](_0x4851a8,_0x44c5fa,_0x5211ee)&&(_0x1b650e&&io['to'](_0x1b650e)['emit']('privateMessage',{'userId':_0x44c5fa,'message':_0x5211ee})),_0x22c31a[_0x2652c5(0x9b)]('messageStatus',{'success':!![],'message':'Mensaje\x20enviado\x20con\x20éxito'});}else _0x22c31a[_0x2652c5(0x9b)]('messageStatus',{'success':![],'message':_0x2652c5(0xb6)+_0x474c18+_0x2652c5(0xe1)});}),_0x22c31a['on'](_0x35b60f(0xce),()=>{const _0x1c8c11=_0x35b60f,{companyId:_0x4706da}=_0x22c31a;_0x4706da&&connectedEmployees[_0x4706da]?(connectedEmployees[_0x4706da]=connectedEmployees[_0x4706da][_0x1c8c11(0x9f)](_0x20228f=>_0x20228f['socketId']!==_0x22c31a['id']),connectedEmployees[_0x4706da][_0x1c8c11(0xb2)]===0x0&&delete connectedEmployees[_0x4706da]):console[_0x1c8c11(0xa9)]('Socket\x20'+_0x22c31a['id']+_0x1c8c11(0x6d));}),_0x22c31a['on']('sendNotification',_0x12d883=>{const _0x25c810=_0x35b60f;console['log'](_0x25c810(0xc1),_0x12d883),_0x22c31a[_0x25c810(0xa5)][_0x25c810(0x9b)]('newNotification',_0x12d883);}),_0x22c31a['on'](_0x35b60f(0xe8),_0x2436a6=>{const _0x3c58eb=_0x35b60f;_0x22c31a[_0x3c58eb(0x9b)](_0x3c58eb(0xbd),{'orderKitchen':orderKitchen});}),_0x22c31a['on'](_0x35b60f(0x81),_0x242664=>{const _0x8fce0b=_0x35b60f,_0x5a358a=JSON[_0x8fce0b(0xa2)](_0x242664);_0x5a358a['id']=orderKitchen[_0x8fce0b(0xb2)]+0x1,orderKitchen[_0x8fce0b(0xe7)](_0x5a358a);});});const companyName=_0xf858bb(0xea);serverExpress[_0xf858bb(0xdb)](require(_0xf858bb(0xe3))),serverExpress[_0xf858bb(0xdb)](require(_0xf858bb(0xd5))),serverExpress[_0xf858bb(0xdb)](companyName,require(_0xf858bb(0xaf))),serverExpress[_0xf858bb(0xdb)](companyName,require(_0xf858bb(0xbe))),serverExpress['use'](companyName,require(_0xf858bb(0x7d))),serverExpress['use'](companyName,require(_0xf858bb(0x97))),serverExpress[_0xf858bb(0xdb)](companyName,require('./router/links/subscription')),serverExpress[_0xf858bb(0xdb)](companyName,require('./router/links/store')),serverExpress[_0xf858bb(0xdb)](companyName,require(_0xf858bb(0xd2))),serverExpress[_0xf858bb(0xdb)](companyName,require(_0xf858bb(0x8f))),serverExpress[_0xf858bb(0xdb)](companyName,require('./router/links/CRM')),serverExpress[_0xf858bb(0xdb)](companyName,require(_0xf858bb(0xb7))),serverExpress[_0xf858bb(0xdb)](companyName,require(_0xf858bb(0xe2))),serverExpress['use'](companyName,require('./router/links/cashCut')),serverExpress[_0xf858bb(0xdb)](companyName,require(_0xf858bb(0xc9))),serverExpress[_0xf858bb(0xdb)](companyName,require(_0xf858bb(0xe4))),serverExpress[_0xf858bb(0xdb)](require('./lib/addFrom')),serverExpress['use'](express[_0xf858bb(0x7e)](path[_0xf858bb(0x6c)](__dirname,_0xf858bb(0xab))));const os=require('os');function _0x371f(_0x32223f,_0x48b57b){const _0x1cdca8=_0x1cdc();return _0x371f=function(_0x371f90,_0x12b495){_0x371f90=_0x371f90-0x69;let _0x11e0e7=_0x1cdca8[_0x371f90];return _0x11e0e7;},_0x371f(_0x32223f,_0x48b57b);}function getLocalIP(){const _0x485cb3=_0xf858bb,_0x216861=os['networkInterfaces']();for(let _0x64bf7e in _0x216861){for(let _0x504de8=0x0;_0x504de8<_0x216861[_0x64bf7e][_0x485cb3(0xb2)];_0x504de8++){const _0x223637=_0x216861[_0x64bf7e][_0x504de8];if(_0x223637[_0x485cb3(0x77)]===_0x485cb3(0x90)&&!_0x223637[_0x485cb3(0x6b)])return _0x223637['address'];}}return'127.0.0.1';}serverExpress['listen'](serverExpress[_0xf858bb(0xdf)]('port'),'0.0.0.0',()=>{const _0x288836=_0xf858bb;console['log'](_0x288836(0x8d)+getLocalIP()+':'+serverExpress[_0x288836(0xdf)]('port'));});