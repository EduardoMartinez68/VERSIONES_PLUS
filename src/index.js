const _0x588cc4=_0x5ad3;(function(_0x2ffa2f,_0x2e502a){const _0x5d0c5d=_0x5ad3,_0x13e452=_0x2ffa2f();while(!![]){try{const _0x15eeee=parseInt(_0x5d0c5d(0x138))/0x1+-parseInt(_0x5d0c5d(0x17d))/0x2+parseInt(_0x5d0c5d(0x15f))/0x3+-parseInt(_0x5d0c5d(0x172))/0x4*(-parseInt(_0x5d0c5d(0x173))/0x5)+-parseInt(_0x5d0c5d(0x175))/0x6+parseInt(_0x5d0c5d(0x1a5))/0x7*(-parseInt(_0x5d0c5d(0x159))/0x8)+-parseInt(_0x5d0c5d(0x16d))/0x9*(parseInt(_0x5d0c5d(0x164))/0xa);if(_0x15eeee===_0x2e502a)break;else _0x13e452['push'](_0x13e452['shift']());}catch(_0x5c5c13){_0x13e452['push'](_0x13e452['shift']());}}}(_0x2b87,0x85537));const system=require('./lib/system'),express=require(_0x588cc4(0x18a)),morgan=require(_0x588cc4(0x171)),{engine}=require(_0x588cc4(0x194)),multer=require('multer'),flash=require(_0x588cc4(0x13c)),session=require('express-session'),passport=require(_0x588cc4(0x157)),{database}=require(_0x588cc4(0x18f)),{v4:uuid}=require('uuid'),path=require(_0x588cc4(0x143)),{RecaptchaV2}=require(_0x588cc4(0x196)),serverExpress=express();require(_0x588cc4(0x154)),require(_0x588cc4(0x184)),serverExpress[_0x588cc4(0x14a)](_0x588cc4(0x163),process[_0x588cc4(0x1b1)]['PORT']||0xfa0),serverExpress[_0x588cc4(0x14a)](_0x588cc4(0x19b),path[_0x588cc4(0x151)](__dirname,_0x588cc4(0x19b))),serverExpress[_0x588cc4(0x14d)](_0x588cc4(0x170),engine({'defaultLayout':_0x588cc4(0x179),'layoutsDir':path[_0x588cc4(0x151)](serverExpress['get']('views'),_0x588cc4(0x13f)),'partialsDir':path[_0x588cc4(0x151)](serverExpress['get'](_0x588cc4(0x19b)),_0x588cc4(0x188)),'extname':_0x588cc4(0x170),'helpers':require(_0x588cc4(0x167))})),serverExpress[_0x588cc4(0x14a)](_0x588cc4(0x1b6),'.hbs'),require(_0x588cc4(0x150))['config']();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process['env'],pg=require('pg'),fs=require('fs'),adminPool=new pg[(_0x588cc4(0x158))]({'user':APP_PG_USER,'host':APP_PG_HOST,'password':APP_PG_PASSWORD,'port':APP_PG_PORT,'database':_0x588cc4(0x190)}),importSQLFile=async _0x519a87=>{const _0x40f093=_0x588cc4,_0x3ff2c6=path['join'](__dirname,_0x40f093(0x13e),'edplus.sql'),_0x20afe4=fs[_0x40f093(0x1ad)](_0x3ff2c6,_0x40f093(0x19d)),_0x37946a=_0x20afe4[_0x40f093(0x17c)](/;\s*$/m)[_0x40f093(0x142)](_0x52f550=>_0x52f550[_0x40f093(0x144)]())[_0x40f093(0x1a2)](_0x5b607a=>_0x5b607a[_0x40f093(0x15b)]>0x0),_0x373a45=await _0x519a87[_0x40f093(0x140)]();try{for(const _0x2aa64a of _0x37946a){await _0x373a45[_0x40f093(0x1b7)](_0x2aa64a);}console[_0x40f093(0x160)](_0x40f093(0x148));}catch(_0x5c8896){console[_0x40f093(0x15a)](_0x40f093(0x13d),_0x5c8896[_0x40f093(0x19a)]);}finally{_0x373a45[_0x40f093(0x149)]();}},createDatabase=async()=>{const _0x41f8fc=_0x588cc4,_0x47fd57=await adminPool[_0x41f8fc(0x1b7)](_0x41f8fc(0x19e));_0x47fd57['rowCount']===0x0?(await adminPool['query'](_0x41f8fc(0x193)),importSQLFile(adminPool),console[_0x41f8fc(0x160)](_0x41f8fc(0x14b))):console[_0x41f8fc(0x160)]('📂\x20La\x20base\x20de\x20datos\x20EDPLUS\x20ya\x20existe,\x20no\x20se\x20creó\x20nuevamente.');};createDatabase();const pgPool=new pg['Pool']({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress[_0x588cc4(0x182)](session({'secret':'FudSession','resave':![],'saveUninitialized':![],'store':new(require(_0x588cc4(0x1a9))(session))({'pool':pgPool,'tableName':_0x588cc4(0x1b0)})})),serverExpress[_0x588cc4(0x182)](flash()),serverExpress['use'](morgan(_0x588cc4(0x1a3))),serverExpress[_0x588cc4(0x182)](express[_0x588cc4(0x162)]({'extended':![]})),serverExpress[_0x588cc4(0x182)](express['json']()),serverExpress[_0x588cc4(0x182)](passport['initialize']()),serverExpress['use'](passport[_0x588cc4(0x1b0)]());const storage=multer[_0x588cc4(0x1a4)]({'destination':path[_0x588cc4(0x151)](__dirname,'public/img/uploads'),'filename':(_0x15765a,_0x5d38af,_0x313f76,_0x3a39c6)=>{const _0x42e6ec=_0x588cc4;_0x313f76(null,uuid()+path[_0x42e6ec(0x187)](_0x5d38af[_0x42e6ec(0x139)]));}});serverExpress[_0x588cc4(0x182)](multer({'storage':storage})['single'](_0x588cc4(0x147))),serverExpress[_0x588cc4(0x182)]((_0x3c349f,_0x31c1d2,_0x2679ad)=>{const _0x49bcd8=_0x588cc4;serverExpress[_0x49bcd8(0x152)][_0x49bcd8(0x16c)]=_0x3c349f['flash'](_0x49bcd8(0x16c)),serverExpress[_0x49bcd8(0x152)][_0x49bcd8(0x19a)]=_0x3c349f[_0x49bcd8(0x141)]('message'),serverExpress[_0x49bcd8(0x152)][_0x49bcd8(0x14c)]=_0x3c349f[_0x49bcd8(0x14c)],serverExpress['locals']['company']=_0x3c349f[_0x49bcd8(0x161)],serverExpress[_0x49bcd8(0x152)][_0x49bcd8(0x15d)]=0x0,serverExpress[_0x49bcd8(0x152)]['pack_branch']=0x0,_0x2679ad();});const http=require('http'),serverSocket=http[_0x588cc4(0x18e)](serverExpress),{Server}=require('socket.io'),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require(_0x588cc4(0x17b));serverSocket[_0x588cc4(0x189)](serverExpress[_0x588cc4(0x176)]('port'),()=>{const _0x22e4f8=_0x588cc4;console[_0x22e4f8(0x160)](_0x22e4f8(0x155)+serverExpress[_0x22e4f8(0x176)](_0x22e4f8(0x163)));}),io['on'](_0x588cc4(0x1ac),async _0x50f25b=>{const _0x1e64c5=_0x588cc4;console[_0x1e64c5(0x160)](_0x1e64c5(0x183)),_0x50f25b['on']('registerUser',async(_0x1214e8,_0x3400b6)=>{const _0x1db1d7=_0x1e64c5,_0x2d44f8=connectedEmployees[_0x3400b6]||[],_0x317986=_0x2d44f8[_0x1db1d7(0x191)](_0x451705=>_0x451705[_0x1db1d7(0x195)]===_0x1214e8);if(_0x317986){_0x50f25b[_0x1db1d7(0x13b)]('connectionRejected','Ups,\x20parece\x20que\x20ya\x20estás\x20conectado\x20en\x20otro\x20dispositivo.');return;}if(system!='desktop'){!companyLimitsCache[_0x3400b6]&&(companyLimitsCache[_0x3400b6]=await chat[_0x1db1d7(0x13a)](_0x3400b6));const _0x2bde70=companyLimitsCache[_0x3400b6];if(_0x2d44f8[_0x1db1d7(0x15b)]>=_0x2bde70){_0x50f25b[_0x1db1d7(0x13b)](_0x1db1d7(0x165),'Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20límite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresía.');return;}}_0x50f25b['companyId']=_0x3400b6,_0x2d44f8[_0x1db1d7(0x16b)]({'userId':_0x1214e8,'socketId':_0x50f25b['id']}),connectedEmployees[_0x3400b6]=_0x2d44f8;const _0x5ab47b=await chat[_0x1db1d7(0x16e)](_0x1214e8,0xa);io['to'](_0x1214e8)[_0x1db1d7(0x13b)](_0x1db1d7(0x198),{'notifications':_0x5ab47b});});async function _0x4f1ac0(_0x449dbf){const _0x4f491a=_0x1e64c5,_0x5d528b=users[_0x449dbf];let _0x4dd354=_0x5d528b;!_0x5d528b&&(_0x4dd354=await chat[_0x4f491a(0x178)](toUserId));const _0x59d48d={'canSend':_0x4dd354,'theUserIsConnect':_0x5d528b};return _0x59d48d;}_0x50f25b['on'](_0x1e64c5(0x199),async({userEmail:_0x37d1b0,toUserEmail:_0x26876e,message:_0x25ea52})=>{const _0xd5fc69=_0x1e64c5,_0x2fec3b=await _0x4f1ac0(_0x26876e);_0x2fec3b[_0xd5fc69(0x1a0)]?await chat[_0xd5fc69(0x1ae)](_0x37d1b0,_0x26876e,_0x25ea52)?(_0x2fec3b[_0xd5fc69(0x1b5)]&&io['to'](recipientSocketId)[_0xd5fc69(0x13b)](_0xd5fc69(0x174),{'userId':userId,'message':_0x25ea52}),_0x50f25b[_0xd5fc69(0x13b)]('messageStatus',{'success':!![],'message':_0xd5fc69(0x180)})):_0x50f25b[_0xd5fc69(0x13b)]('messageStatus',{'success':![],'message':_0xd5fc69(0x14f)+_0x26876e+_0xd5fc69(0x1aa)}):_0x50f25b[_0xd5fc69(0x13b)]('messageStatus',{'success':![],'message':_0xd5fc69(0x169)+_0x26876e+_0xd5fc69(0x17a)});}),_0x50f25b['on'](_0x1e64c5(0x192),async({userEmail:_0xbf265f})=>{const _0x8f825f=_0x1e64c5,_0x2f7e8b=await chat[_0x8f825f(0x16e)](_0xbf265f,0xa);io['to'](recipientSocketId)[_0x8f825f(0x13b)](_0x8f825f(0x198),{'notifications':_0x2f7e8b});}),_0x50f25b['on'](_0x1e64c5(0x185),async({userId:_0x211dfc,toUserId:_0x5c9c70,message:_0x2ece2d})=>{const _0x216f98=_0x1e64c5,_0x4fb261=users[_0x5c9c70];let _0x488b70=_0x4fb261;!_0x4fb261&&(_0x488b70=await chat[_0x216f98(0x178)](_0x5c9c70));if(_0x488b70){const _0x4fec35=await chat['create_new_chat'](_0x211dfc,_0x5c9c70);await chat['send_new_message'](_0x4fec35,_0x211dfc,_0x2ece2d)&&(_0x4fb261&&io['to'](_0x4fb261)[_0x216f98(0x13b)]('privateMessage',{'userId':_0x211dfc,'message':_0x2ece2d})),_0x50f25b[_0x216f98(0x13b)](_0x216f98(0x19c),{'success':!![],'message':_0x216f98(0x18d)});}else _0x50f25b[_0x216f98(0x13b)]('messageStatus',{'success':![],'message':_0x216f98(0x19f)+_0x5c9c70+'\x27\x20no\x20existe\x20🤔'});}),_0x50f25b['on'](_0x1e64c5(0x156),()=>{const _0x3a63c3=_0x1e64c5,{companyId:_0x32d0bd}=_0x50f25b;_0x32d0bd&&connectedEmployees[_0x32d0bd]?(connectedEmployees[_0x32d0bd]=connectedEmployees[_0x32d0bd][_0x3a63c3(0x1a2)](_0x2410a1=>_0x2410a1[_0x3a63c3(0x18b)]!==_0x50f25b['id']),connectedEmployees[_0x32d0bd]['length']===0x0&&delete connectedEmployees[_0x32d0bd]):console[_0x3a63c3(0x160)](_0x3a63c3(0x1b4)+_0x50f25b['id']+'\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.');}),_0x50f25b['on'](_0x1e64c5(0x168),_0x56536e=>{const _0x2822ff=_0x1e64c5;console[_0x2822ff(0x160)](_0x2822ff(0x1a7),_0x56536e),_0x50f25b[_0x2822ff(0x16a)]['emit'](_0x2822ff(0x1b3),_0x56536e);}),_0x50f25b['on']('sendAllTheOrders',_0x3726c4=>{const _0x1a4b91=_0x1e64c5;_0x50f25b[_0x1a4b91(0x13b)](_0x1a4b91(0x153),{'orderKitchen':orderKitchen});}),_0x50f25b['on'](_0x1e64c5(0x15c),_0xf5919f=>{const _0x185fbc=_0x1e64c5,_0x4e626e=JSON[_0x185fbc(0x1b2)](_0xf5919f);_0x4e626e['id']=orderKitchen['length']+0x1,orderKitchen[_0x185fbc(0x16b)](_0x4e626e);});});const companyName='/links';serverExpress[_0x588cc4(0x182)](require('./router')),serverExpress['use'](require(_0x588cc4(0x1a6))),serverExpress[_0x588cc4(0x182)](companyName,require(_0x588cc4(0x177))),serverExpress[_0x588cc4(0x182)](companyName,require('./router/links/fudone')),serverExpress[_0x588cc4(0x182)](companyName,require(_0x588cc4(0x145))),serverExpress['use'](companyName,require(_0x588cc4(0x186))),serverExpress[_0x588cc4(0x182)](companyName,require('./router/links/subscription')),serverExpress[_0x588cc4(0x182)](companyName,require('./router/links/store')),serverExpress['use'](companyName,require(_0x588cc4(0x1a8))),serverExpress['use'](companyName,require(_0x588cc4(0x16f))),serverExpress[_0x588cc4(0x182)](companyName,require(_0x588cc4(0x1af))),serverExpress[_0x588cc4(0x182)](companyName,require('./router/links/desktop')),serverExpress[_0x588cc4(0x182)](companyName,require(_0x588cc4(0x181))),serverExpress[_0x588cc4(0x182)](companyName,require('./router/links/cashCut')),serverExpress[_0x588cc4(0x182)](companyName,require(_0x588cc4(0x137))),serverExpress[_0x588cc4(0x182)](companyName,require(_0x588cc4(0x1ab))),serverExpress['use'](require(_0x588cc4(0x166))),serverExpress[_0x588cc4(0x182)](express[_0x588cc4(0x1a1)](path[_0x588cc4(0x151)](__dirname,_0x588cc4(0x15e))));const os=require('os');function _0x5ad3(_0x1d682e,_0x13d43c){const _0x2b870a=_0x2b87();return _0x5ad3=function(_0x5ad348,_0x5f3c0a){_0x5ad348=_0x5ad348-0x137;let _0x44d51c=_0x2b870a[_0x5ad348];return _0x44d51c;},_0x5ad3(_0x1d682e,_0x13d43c);}function _0x2b87(){const _0x1b9e0f=['16DyQpeW','793735WpWfJK','privateMessage','546372VtXcAi','get','./router/links','this_email_exist','main','\x27\x20no\x20existe.\x20🤔','./services/chat.js','split','1439570YUaQWE','address','0.0.0.0','Mensaje\x20enviado\x20con\x20éxito.\x20👌','./router/links/boutique','use','Un\x20usuario\x20se\x20ha\x20conectado','./lib/editFrom','sendMessageToUser','./router/links/branch','extname','partials','listen','express','socketId','family','Mensaje\x20enviado\x20con\x20éxito','createServer','./keys','postgres','some','getTheFirstTenNotifications','CREATE\x20DATABASE\x20edplus','express-handlebars','userId','express-recaptcha','networkInterfaces','privateNotifications','sendNotificationToUser','message','views','messageStatus','utf8','SELECT\x201\x20FROM\x20pg_database\x20WHERE\x20datname\x20=\x20\x27edplus\x27','Este\x20email\x20\x27','canSend','static','filter','dev','diskStorage','28266xiogVl','./router/authentication','Nueva\x20notificación:','./router/links/delivery','connect-pg-simple','\x27.\x20Inténtalo\x20de\x20nuevo.\x20😳','./router/links/prescription','connection','readFileSync','create_notification','./router/links/CRM','session','env','parse','newNotification','Socket\x20','theUserIsConnect','view\x20engine','query','./router/links/orders','1050352RrjHnU','originalname','get_max_employee_of_this_company','emit','connect-flash','❌\x20Error\x20ejecutando\x20SQL:','database','layouts','connect','flash','map','path','trim','./router/links/ceo','internal','image','✅\x20SQL\x20ejecutado\x20correctamente','release','set','📦\x20Base\x20de\x20datos\x20EDPLUS\x20creada','user','engine','127.0.0.1','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27','dotenv','join','locals','getAllTheOrders','./lib/passport','Server\x20running\x20on\x20port\x20','disconnect','passport','Pool','272HQHWpC','error','length','saveANewOrder','pack_company','public','1815474JjZNkc','log','company','urlencoded','port','11920rXNEHm','connectionRejected','./lib/addFrom','./lib/handlebars','sendNotification','El\x20usuario\x20\x27','broadcast','push','success','6012cdHIyG','get_the_first_notification','./router/links/app','.hbs','morgan'];_0x2b87=function(){return _0x1b9e0f;};return _0x2b87();}function getLocalIP(){const _0x310adc=_0x588cc4,_0x3a91cc=os[_0x310adc(0x197)]();for(let _0x2456ec in _0x3a91cc){for(let _0x28d47b=0x0;_0x28d47b<_0x3a91cc[_0x2456ec][_0x310adc(0x15b)];_0x28d47b++){const _0xf72cb7=_0x3a91cc[_0x2456ec][_0x28d47b];if(_0xf72cb7[_0x310adc(0x18c)]==='IPv4'&&!_0xf72cb7[_0x310adc(0x146)])return _0xf72cb7[_0x310adc(0x17e)];}}return _0x310adc(0x14e);}serverExpress['listen'](serverExpress['get'](_0x588cc4(0x163)),_0x588cc4(0x17f),()=>{const _0x4006a1=_0x588cc4;console['log']('Server\x20running\x20on\x20http://'+getLocalIP()+':'+serverExpress['get'](_0x4006a1(0x163)));});