const _0x3b2eab=_0x27ca;(function(_0x5574f3,_0x2997a1){const _0x47a04c=_0x27ca,_0x5b37b7=_0x5574f3();while(!![]){try{const _0x158711=parseInt(_0x47a04c(0x18b))/0x1+parseInt(_0x47a04c(0x1bc))/0x2+parseInt(_0x47a04c(0x16f))/0x3+parseInt(_0x47a04c(0x1a4))/0x4*(parseInt(_0x47a04c(0x19a))/0x5)+-parseInt(_0x47a04c(0x198))/0x6+parseInt(_0x47a04c(0x1a9))/0x7*(-parseInt(_0x47a04c(0x1c2))/0x8)+-parseInt(_0x47a04c(0x191))/0x9;if(_0x158711===_0x2997a1)break;else _0x5b37b7['push'](_0x5b37b7['shift']());}catch(_0x5e169d){_0x5b37b7['push'](_0x5b37b7['shift']());}}}(_0x414d,0x639dd));const system=require(_0x3b2eab(0x18c)),express=require(_0x3b2eab(0x178)),morgan=require(_0x3b2eab(0x1a1)),{engine}=require(_0x3b2eab(0x183)),multer=require('multer'),flash=require(_0x3b2eab(0x16e)),session=require(_0x3b2eab(0x19f)),passport=require(_0x3b2eab(0x190)),{database}=require(_0x3b2eab(0x1d2)),{v4:uuid}=require(_0x3b2eab(0x1a8)),path=require(_0x3b2eab(0x181)),{RecaptchaV2}=require('express-recaptcha'),serverExpress=express();require(_0x3b2eab(0x175)),require('./lib/editFrom'),serverExpress[_0x3b2eab(0x1cb)](_0x3b2eab(0x188),process[_0x3b2eab(0x174)][_0x3b2eab(0x1b5)]||0xfa0),serverExpress[_0x3b2eab(0x1cb)]('views',path['join'](__dirname,_0x3b2eab(0x19c))),serverExpress[_0x3b2eab(0x1d1)]('.hbs',engine({'defaultLayout':'main','layoutsDir':path[_0x3b2eab(0x18d)](serverExpress[_0x3b2eab(0x1ab)](_0x3b2eab(0x19c)),_0x3b2eab(0x1d9)),'partialsDir':path['join'](serverExpress[_0x3b2eab(0x1ab)]('views'),_0x3b2eab(0x19d)),'extname':_0x3b2eab(0x1af),'helpers':require(_0x3b2eab(0x16c))})),serverExpress[_0x3b2eab(0x1cb)](_0x3b2eab(0x1c7),_0x3b2eab(0x1af)),require(_0x3b2eab(0x195))[_0x3b2eab(0x1c6)]();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process[_0x3b2eab(0x174)],pg=require('pg'),pgPool=new pg[(_0x3b2eab(0x1b0))]({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress[_0x3b2eab(0x1b4)](session({'secret':_0x3b2eab(0x1cf),'resave':![],'saveUninitialized':![],'store':new(require(_0x3b2eab(0x197))(session))({'pool':pgPool,'tableName':_0x3b2eab(0x173)})})),serverExpress[_0x3b2eab(0x1b4)](flash()),serverExpress['use'](morgan(_0x3b2eab(0x1d5))),serverExpress[_0x3b2eab(0x1b4)](express[_0x3b2eab(0x1b3)]({'extended':![]})),serverExpress[_0x3b2eab(0x1b4)](express[_0x3b2eab(0x17d)]()),serverExpress[_0x3b2eab(0x1b4)](passport[_0x3b2eab(0x1a0)]()),serverExpress[_0x3b2eab(0x1b4)](passport[_0x3b2eab(0x173)]());const storage=multer[_0x3b2eab(0x16d)]({'destination':path[_0x3b2eab(0x18d)](__dirname,_0x3b2eab(0x1b2)),'filename':(_0x45dd50,_0x3c2c90,_0x38722b,_0x4f1735)=>{const _0x3d38bd=_0x3b2eab;_0x38722b(null,uuid()+path[_0x3d38bd(0x1c8)](_0x3c2c90[_0x3d38bd(0x1ac)]));}});serverExpress[_0x3b2eab(0x1b4)](multer({'storage':storage})[_0x3b2eab(0x1c9)]('image')),serverExpress['use']((_0x2a409d,_0x5bd0ea,_0x2a7bb1)=>{const _0x16b721=_0x3b2eab;serverExpress[_0x16b721(0x17b)][_0x16b721(0x199)]=_0x2a409d[_0x16b721(0x17e)]('success'),serverExpress[_0x16b721(0x17b)][_0x16b721(0x192)]=_0x2a409d[_0x16b721(0x17e)]('message'),serverExpress[_0x16b721(0x17b)]['user']=_0x2a409d[_0x16b721(0x185)],serverExpress[_0x16b721(0x17b)]['company']=_0x2a409d[_0x16b721(0x1bb)],serverExpress[_0x16b721(0x17b)][_0x16b721(0x179)]=0x0,serverExpress[_0x16b721(0x17b)][_0x16b721(0x1ce)]=0x0,_0x2a7bb1();});const http=require(_0x3b2eab(0x1c1)),server=http[_0x3b2eab(0x176)](serverExpress),{Server}=require('socket.io'),io=new Server(server),users={},connectedEmployees={},companyLimitsCache={},chat=require(_0x3b2eab(0x1d8));io['on'](_0x3b2eab(0x18e),async _0x229b81=>{const _0x15c2c6=_0x3b2eab;_0x229b81['on'](_0x15c2c6(0x1ad),async(_0x2ae377,_0x5d051b)=>{const _0x1fb7c2=_0x15c2c6,_0x352d16=connectedEmployees[_0x5d051b]||[],_0x292bd6=_0x352d16['some'](_0x339b19=>_0x339b19['userId']===_0x2ae377);if(_0x292bd6){_0x229b81[_0x1fb7c2(0x1be)]('connectionRejected',_0x1fb7c2(0x1b1));return;}if(system!=_0x1fb7c2(0x1cd)){!companyLimitsCache[_0x5d051b]&&(companyLimitsCache[_0x5d051b]=await chat[_0x1fb7c2(0x1cc)](_0x5d051b));const _0x19d1c3=companyLimitsCache[_0x5d051b];if(_0x352d16[_0x1fb7c2(0x1ba)]>=_0x19d1c3){_0x229b81[_0x1fb7c2(0x1be)]('connectionRejected','Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20lÃ­mite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresÃ­a.');return;}}_0x229b81['companyId']=_0x5d051b,_0x352d16[_0x1fb7c2(0x187)]({'userId':_0x2ae377,'socketId':_0x229b81['id']}),connectedEmployees[_0x5d051b]=_0x352d16;const _0x19d66e=await chat[_0x1fb7c2(0x19b)](_0x2ae377,0xa);io['to'](_0x2ae377)['emit'](_0x1fb7c2(0x1c5),{'notifications':_0x19d66e});});async function _0x27dba7(_0x5adecb){const _0x34ca48=users[_0x5adecb];let _0x4bbf8b=_0x34ca48;!_0x34ca48&&(_0x4bbf8b=await chat['this_email_exist'](toUserId));const _0x519275={'canSend':_0x4bbf8b,'theUserIsConnect':_0x34ca48};return _0x519275;}_0x229b81['on']('sendNotificationToUser',async({userEmail:_0x1f1d9d,toUserEmail:_0x14406e,message:_0x4e9ff8})=>{const _0x536f45=_0x15c2c6,_0x3a0199=await _0x27dba7(_0x14406e);_0x3a0199[_0x536f45(0x1bf)]?await chat[_0x536f45(0x1aa)](_0x1f1d9d,_0x14406e,_0x4e9ff8)?(_0x3a0199[_0x536f45(0x1b8)]&&io['to'](recipientSocketId)[_0x536f45(0x1be)](_0x536f45(0x182),{'userId':userId,'message':_0x4e9ff8}),_0x229b81[_0x536f45(0x1be)](_0x536f45(0x17a),{'success':!![],'message':_0x536f45(0x186)})):_0x229b81[_0x536f45(0x1be)]('messageStatus',{'success':![],'message':_0x536f45(0x184)+_0x14406e+_0x536f45(0x172)}):_0x229b81['emit']('messageStatus',{'success':![],'message':_0x536f45(0x1d0)+_0x14406e+_0x536f45(0x1a6)});}),_0x229b81['on'](_0x15c2c6(0x1d3),async({userEmail:_0x12f69a})=>{const _0x4ad779=_0x15c2c6,_0xefdf8a=await chat['get_the_first_notification'](_0x12f69a,0xa);io['to'](recipientSocketId)['emit'](_0x4ad779(0x1c5),{'notifications':_0xefdf8a});}),_0x229b81['on'](_0x15c2c6(0x1b9),async({userId:_0x49e7ed,toUserId:_0x52ba16,message:_0x1f43c9})=>{const _0x1a8b8b=_0x15c2c6,_0x368bde=users[_0x52ba16];let _0x438a82=_0x368bde;!_0x368bde&&(_0x438a82=await chat['this_email_exist'](_0x52ba16));if(_0x438a82){const _0x28923a=await chat[_0x1a8b8b(0x17f)](_0x49e7ed,_0x52ba16);await chat[_0x1a8b8b(0x16b)](_0x28923a,_0x49e7ed,_0x1f43c9)&&(_0x368bde&&io['to'](_0x368bde)[_0x1a8b8b(0x1be)](_0x1a8b8b(0x182),{'userId':_0x49e7ed,'message':_0x1f43c9})),_0x229b81[_0x1a8b8b(0x1be)](_0x1a8b8b(0x17a),{'success':!![],'message':_0x1a8b8b(0x1d7)});}else _0x229b81[_0x1a8b8b(0x1be)](_0x1a8b8b(0x17a),{'success':![],'message':_0x1a8b8b(0x1b7)+_0x52ba16+_0x1a8b8b(0x17c)});}),_0x229b81['on'](_0x15c2c6(0x1ae),()=>{const _0x4d8745=_0x15c2c6,{companyId:_0x360bcf}=_0x229b81;_0x360bcf&&connectedEmployees[_0x360bcf]?(connectedEmployees[_0x360bcf]=connectedEmployees[_0x360bcf][_0x4d8745(0x194)](_0x13fb7f=>_0x13fb7f[_0x4d8745(0x1a7)]!==_0x229b81['id']),connectedEmployees[_0x360bcf][_0x4d8745(0x1ba)]===0x0&&delete connectedEmployees[_0x360bcf]):console['log']('Socket\x20'+_0x229b81['id']+'\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.');}),_0x229b81['on']('sendNotification',_0x8db529=>{const _0x2de531=_0x15c2c6;console[_0x2de531(0x1d4)]('Nueva\x20notificaciÃ³n:',_0x8db529),_0x229b81['broadcast'][_0x2de531(0x1be)](_0x2de531(0x1c0),_0x8db529);});});function _0x414d(){const _0x1886cf=['set','get_max_employee_of_this_company','desktop','pack_branch','FudSession','El\x20usuario\x20\x27','engine','./keys','getTheFirstTenNotifications','log','dev','./router','Mensaje\x20enviado\x20con\x20Ã©xito','./services/chat.js','layouts','send_new_message','./lib/handlebars','diskStorage','connect-flash','2291919kdsLzC','Server\x20running\x20on\x20http://','./router/links/fudone','\x27.\x20IntÃ©ntalo\x20de\x20nuevo.\x20ðŸ˜³','session','env','./lib/passport','createServer','./router/links/delivery','express','pack_company','messageStatus','locals','\x27\x20no\x20existe\x20ðŸ¤”','json','flash','create_new_chat','public','path','privateMessage','express-handlebars','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27','user','Mensaje\x20enviado\x20con\x20Ã©xito.\x20ðŸ‘Œ','push','port','internal','listen','615747HKlUjr','./lib/system','join','connection','./router/links/ceo','passport','4940388YTMFtH','message','./router/authentication','filter','dotenv','./router/links/cashCut','connect-pg-simple','2598828HjgxcJ','success','95EBwwxq','get_the_first_notification','views','partials','networkInterfaces','express-session','initialize','morgan','./router/links/CRM','address','71588yKRZGL','127.0.0.1','\x27\x20no\x20existe.\x20ðŸ¤”','socketId','uuid','4942rZcHWz','create_notification','get','originalname','registerUser','disconnect','.hbs','Pool','Ups,\x20parece\x20que\x20ya\x20estÃ¡s\x20conectado\x20en\x20otro\x20dispositivo.','public/img/uploads','urlencoded','use','PORT','family','Este\x20email\x20\x27','theUserIsConnect','sendMessageToUser','length','company','737140deoWVT','/links','emit','canSend','newNotification','http','7912yKFlyZ','./router/links/boutique','./lib/addFrom','privateNotifications','config','view\x20engine','extname','single','./router/links/subscription'];_0x414d=function(){return _0x1886cf;};return _0x414d();}function _0x27ca(_0x3b5774,_0x37c138){const _0x414d4e=_0x414d();return _0x27ca=function(_0x27cac6,_0x3d280f){_0x27cac6=_0x27cac6-0x16b;let _0x3f0962=_0x414d4e[_0x27cac6];return _0x3f0962;},_0x27ca(_0x3b5774,_0x37c138);}const companyName=_0x3b2eab(0x1bd);serverExpress[_0x3b2eab(0x1b4)](require(_0x3b2eab(0x1d6))),serverExpress[_0x3b2eab(0x1b4)](require(_0x3b2eab(0x193))),serverExpress[_0x3b2eab(0x1b4)](companyName,require('./router/links')),serverExpress[_0x3b2eab(0x1b4)](companyName,require(_0x3b2eab(0x171))),serverExpress[_0x3b2eab(0x1b4)](companyName,require(_0x3b2eab(0x18f))),serverExpress['use'](companyName,require('./router/links/branch')),serverExpress[_0x3b2eab(0x1b4)](companyName,require(_0x3b2eab(0x1ca))),serverExpress[_0x3b2eab(0x1b4)](companyName,require('./router/links/store')),serverExpress[_0x3b2eab(0x1b4)](companyName,require(_0x3b2eab(0x177))),serverExpress['use'](companyName,require('./router/links/app')),serverExpress[_0x3b2eab(0x1b4)](companyName,require(_0x3b2eab(0x1a2))),serverExpress['use'](companyName,require('./router/links/desktop')),serverExpress[_0x3b2eab(0x1b4)](companyName,require(_0x3b2eab(0x1c3))),serverExpress['use'](companyName,require(_0x3b2eab(0x196))),serverExpress[_0x3b2eab(0x1b4)](require(_0x3b2eab(0x1c4))),serverExpress[_0x3b2eab(0x1b4)](express['static'](path[_0x3b2eab(0x18d)](__dirname,_0x3b2eab(0x180))));const os=require('os');function getLocalIP(){const _0x56035c=_0x3b2eab,_0x5721a7=os[_0x56035c(0x19e)]();for(let _0x5b80e2 in _0x5721a7){for(let _0x3430dd=0x0;_0x3430dd<_0x5721a7[_0x5b80e2]['length'];_0x3430dd++){const _0x1e4be6=_0x5721a7[_0x5b80e2][_0x3430dd];if(_0x1e4be6[_0x56035c(0x1b6)]==='IPv4'&&!_0x1e4be6[_0x56035c(0x189)])return _0x1e4be6[_0x56035c(0x1a3)];}}return _0x56035c(0x1a5);}serverExpress[_0x3b2eab(0x18a)](serverExpress[_0x3b2eab(0x1ab)](_0x3b2eab(0x188)),'0.0.0.0',()=>{const _0x43518a=_0x3b2eab;console[_0x43518a(0x1d4)](_0x43518a(0x170)+getLocalIP()+':'+serverExpress['get'](_0x43518a(0x188)));});