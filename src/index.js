const _0x569951=_0x1137;(function(_0xe4bb74,_0x3b9063){const _0x35446a=_0x1137,_0x52ce4d=_0xe4bb74();while(!![]){try{const _0x109a6a=-parseInt(_0x35446a(0x1b3))/0x1+-parseInt(_0x35446a(0x1b1))/0x2*(parseInt(_0x35446a(0x1d2))/0x3)+-parseInt(_0x35446a(0x168))/0x4*(parseInt(_0x35446a(0x19d))/0x5)+parseInt(_0x35446a(0x194))/0x6*(-parseInt(_0x35446a(0x19b))/0x7)+-parseInt(_0x35446a(0x184))/0x8*(-parseInt(_0x35446a(0x1a7))/0x9)+-parseInt(_0x35446a(0x1c3))/0xa*(-parseInt(_0x35446a(0x173))/0xb)+parseInt(_0x35446a(0x1aa))/0xc;if(_0x109a6a===_0x3b9063)break;else _0x52ce4d['push'](_0x52ce4d['shift']());}catch(_0x28c0de){_0x52ce4d['push'](_0x52ce4d['shift']());}}}(_0x9f61,0x27866));const system=require('./lib/system'),express=require('express'),morgan=require('morgan'),{engine}=require(_0x569951(0x182)),multer=require('multer'),flash=require('connect-flash'),session=require(_0x569951(0x1c0)),passport=require(_0x569951(0x18f)),{database}=require(_0x569951(0x1bd)),{v4:uuid}=require(_0x569951(0x196)),path=require(_0x569951(0x1c8)),{RecaptchaV2}=require('express-recaptcha'),serverExpress=express();function _0x1137(_0xd70911,_0x517d9d){const _0x9f6131=_0x9f61();return _0x1137=function(_0x11379c,_0x11b3e9){_0x11379c=_0x11379c-0x165;let _0x50bd1d=_0x9f6131[_0x11379c];return _0x50bd1d;},_0x1137(_0xd70911,_0x517d9d);}require(_0x569951(0x171)),require(_0x569951(0x1bc)),serverExpress[_0x569951(0x180)]('port',process['env'][_0x569951(0x18a)]||0xfa0),serverExpress[_0x569951(0x180)](_0x569951(0x19c),path['join'](__dirname,_0x569951(0x19c))),serverExpress[_0x569951(0x1cb)](_0x569951(0x1cc),engine({'defaultLayout':'main','layoutsDir':path['join'](serverExpress[_0x569951(0x170)](_0x569951(0x19c)),_0x569951(0x1a3)),'partialsDir':path['join'](serverExpress[_0x569951(0x170)]('views'),_0x569951(0x199)),'extname':_0x569951(0x1cc),'helpers':require('./lib/handlebars')})),serverExpress['set']('view\x20engine','.hbs'),require(_0x569951(0x16f))['config']();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process[_0x569951(0x191)],pg=require('pg'),pgPool=new pg[(_0x569951(0x1a6))]({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});function _0x9f61(){const _0x2c9bb5=['./lib/addFrom','2210UeJXgZ','join','./services/chat.js','public/img/uploads','registerUser','path','push','dev','engine','.hbs','/links','Un\x20usuario\x20se\x20ha\x20conectado','sendNotificationToUser','sendMessageToUser','saveANewOrder','4173lTovYp','Nueva\x20notificaciÃ³n:','success','session','1604kAZZYv','get_the_first_notification','connection','0.0.0.0','socket.io','initialize','this_email_exist','dotenv','get','./lib/passport','extname','4301hidAIN','user','get_max_employee_of_this_company','\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.','./router/links/orders','length','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27','\x27\x20no\x20existe.\x20ðŸ¤”','./router/links/boutique','message','Server\x20running\x20on\x20http://','theUserIsConnect','canSend','set','company','express-handlebars','family','8eAuMtd','parse','privateNotifications','El\x20usuario\x20\x27','listen','privateMessage','PORT','internal','emit','static','./router/links/branch','passport','create_notification','env','./router/links/fudone','address','6rWJFYj','public','uuid','json','./router/links/cashCut','partials','port','923314rWOYni','views','145FHxsrE','urlencoded','single','log','locals','disconnect','layouts','sendAllTheOrders','IPv4','Pool','1757322GHyzJR','./router','FudSession','1644384IgVjjY','./router/links','messageStatus','Ups,\x20parece\x20que\x20ya\x20estÃ¡s\x20conectado\x20en\x20otro\x20dispositivo.','networkInterfaces','createServer','getTheFirstTenNotifications','66oCDAMc','companyId','67373YrtEeE','image','sendNotification','./router/links/store','create_new_chat','Este\x20email\x20\x27','pack_branch','./router/links/CRM','use','./lib/editFrom','./keys','Socket\x20','flash','express-session','\x27\x20no\x20existe\x20ðŸ¤”'];_0x9f61=function(){return _0x2c9bb5;};return _0x9f61();}serverExpress[_0x569951(0x1bb)](session({'secret':_0x569951(0x1a9),'resave':![],'saveUninitialized':![],'store':new(require('connect-pg-simple')(session))({'pool':pgPool,'tableName':_0x569951(0x167)})})),serverExpress[_0x569951(0x1bb)](flash()),serverExpress[_0x569951(0x1bb)](morgan(_0x569951(0x1ca))),serverExpress[_0x569951(0x1bb)](express[_0x569951(0x19e)]({'extended':![]})),serverExpress['use'](express[_0x569951(0x197)]()),serverExpress[_0x569951(0x1bb)](passport[_0x569951(0x16d)]()),serverExpress[_0x569951(0x1bb)](passport[_0x569951(0x167)]());const storage=multer['diskStorage']({'destination':path[_0x569951(0x1c4)](__dirname,_0x569951(0x1c6)),'filename':(_0x1884e7,_0x4705ca,_0x3341ab,_0x404dd3)=>{const _0x4026fb=_0x569951;_0x3341ab(null,uuid()+path[_0x4026fb(0x172)](_0x4705ca['originalname']));}});serverExpress['use'](multer({'storage':storage})[_0x569951(0x19f)](_0x569951(0x1b4))),serverExpress['use']((_0x53850a,_0xa7a283,_0x281ad9)=>{const _0x1a98bc=_0x569951;serverExpress[_0x1a98bc(0x1a1)][_0x1a98bc(0x166)]=_0x53850a[_0x1a98bc(0x1bf)]('success'),serverExpress['locals'][_0x1a98bc(0x17c)]=_0x53850a[_0x1a98bc(0x1bf)](_0x1a98bc(0x17c)),serverExpress[_0x1a98bc(0x1a1)][_0x1a98bc(0x174)]=_0x53850a[_0x1a98bc(0x174)],serverExpress[_0x1a98bc(0x1a1)][_0x1a98bc(0x181)]=_0x53850a[_0x1a98bc(0x181)],serverExpress[_0x1a98bc(0x1a1)]['pack_company']=0x0,serverExpress['locals'][_0x1a98bc(0x1b9)]=0x0,_0x281ad9();});const http=require('http'),serverSocket=http[_0x569951(0x1af)](serverExpress),{Server}=require(_0x569951(0x16c)),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require(_0x569951(0x1c5));serverSocket[_0x569951(0x188)](serverExpress['get'](_0x569951(0x19a)),()=>{const _0x27d78c=_0x569951;console['log']('Server\x20running\x20on\x20port\x20'+serverExpress['get'](_0x27d78c(0x19a)));}),io['on'](_0x569951(0x16a),async _0x3ed549=>{const _0x5b0961=_0x569951;console['log'](_0x5b0961(0x1ce)),_0x3ed549['on'](_0x5b0961(0x1c7),async(_0x1b2c57,_0x52450d)=>{const _0x2e82aa=_0x5b0961,_0x53cd96=connectedEmployees[_0x52450d]||[],_0x445315=_0x53cd96['some'](_0x421a0c=>_0x421a0c['userId']===_0x1b2c57);if(_0x445315){_0x3ed549[_0x2e82aa(0x18c)]('connectionRejected',_0x2e82aa(0x1ad));return;}if(system!='desktop'){!companyLimitsCache[_0x52450d]&&(companyLimitsCache[_0x52450d]=await chat[_0x2e82aa(0x175)](_0x52450d));const _0x2a0833=companyLimitsCache[_0x52450d];if(_0x53cd96[_0x2e82aa(0x178)]>=_0x2a0833){_0x3ed549[_0x2e82aa(0x18c)]('connectionRejected','Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20lÃ­mite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresÃ­a.');return;}}_0x3ed549[_0x2e82aa(0x1b2)]=_0x52450d,_0x53cd96[_0x2e82aa(0x1c9)]({'userId':_0x1b2c57,'socketId':_0x3ed549['id']}),connectedEmployees[_0x52450d]=_0x53cd96;const _0x313bae=await chat[_0x2e82aa(0x169)](_0x1b2c57,0xa);io['to'](_0x1b2c57)[_0x2e82aa(0x18c)](_0x2e82aa(0x186),{'notifications':_0x313bae});});async function _0x58594f(_0x47c365){const _0x22aaeb=_0x5b0961,_0x41f7ee=users[_0x47c365];let _0x222549=_0x41f7ee;!_0x41f7ee&&(_0x222549=await chat[_0x22aaeb(0x16e)](toUserId));const _0x49132b={'canSend':_0x222549,'theUserIsConnect':_0x41f7ee};return _0x49132b;}_0x3ed549['on'](_0x5b0961(0x1cf),async({userEmail:_0x2fb19a,toUserEmail:_0x39aa67,message:_0x14aec2})=>{const _0x131b6f=_0x5b0961,_0x2e9f47=await _0x58594f(_0x39aa67);_0x2e9f47[_0x131b6f(0x17f)]?await chat[_0x131b6f(0x190)](_0x2fb19a,_0x39aa67,_0x14aec2)?(_0x2e9f47[_0x131b6f(0x17e)]&&io['to'](recipientSocketId)[_0x131b6f(0x18c)](_0x131b6f(0x189),{'userId':userId,'message':_0x14aec2}),_0x3ed549[_0x131b6f(0x18c)](_0x131b6f(0x1ac),{'success':!![],'message':'Mensaje\x20enviado\x20con\x20Ã©xito.\x20ðŸ‘Œ'})):_0x3ed549['emit'](_0x131b6f(0x1ac),{'success':![],'message':_0x131b6f(0x179)+_0x39aa67+'\x27.\x20IntÃ©ntalo\x20de\x20nuevo.\x20ðŸ˜³'}):_0x3ed549['emit'](_0x131b6f(0x1ac),{'success':![],'message':_0x131b6f(0x187)+_0x39aa67+_0x131b6f(0x17a)});}),_0x3ed549['on'](_0x5b0961(0x1b0),async({userEmail:_0x1c262d})=>{const _0x3dbde1=_0x5b0961,_0x21b69a=await chat[_0x3dbde1(0x169)](_0x1c262d,0xa);io['to'](recipientSocketId)['emit'](_0x3dbde1(0x186),{'notifications':_0x21b69a});}),_0x3ed549['on'](_0x5b0961(0x1d0),async({userId:_0x238581,toUserId:_0x16a00f,message:_0x175bd6})=>{const _0x2d2612=_0x5b0961,_0xe42efd=users[_0x16a00f];let _0x37e38d=_0xe42efd;!_0xe42efd&&(_0x37e38d=await chat['this_email_exist'](_0x16a00f));if(_0x37e38d){const _0x40e8a7=await chat[_0x2d2612(0x1b7)](_0x238581,_0x16a00f);await chat['send_new_message'](_0x40e8a7,_0x238581,_0x175bd6)&&(_0xe42efd&&io['to'](_0xe42efd)[_0x2d2612(0x18c)](_0x2d2612(0x189),{'userId':_0x238581,'message':_0x175bd6})),_0x3ed549[_0x2d2612(0x18c)](_0x2d2612(0x1ac),{'success':!![],'message':'Mensaje\x20enviado\x20con\x20Ã©xito'});}else _0x3ed549['emit'](_0x2d2612(0x1ac),{'success':![],'message':_0x2d2612(0x1b8)+_0x16a00f+_0x2d2612(0x1c1)});}),_0x3ed549['on'](_0x5b0961(0x1a2),()=>{const _0x5da2ce=_0x5b0961,{companyId:_0x53ff0c}=_0x3ed549;_0x53ff0c&&connectedEmployees[_0x53ff0c]?(connectedEmployees[_0x53ff0c]=connectedEmployees[_0x53ff0c]['filter'](_0x5e7aea=>_0x5e7aea['socketId']!==_0x3ed549['id']),connectedEmployees[_0x53ff0c]['length']===0x0&&delete connectedEmployees[_0x53ff0c]):console[_0x5da2ce(0x1a0)](_0x5da2ce(0x1be)+_0x3ed549['id']+_0x5da2ce(0x176));}),_0x3ed549['on'](_0x5b0961(0x1b5),_0xea695e=>{const _0x2c6e74=_0x5b0961;console[_0x2c6e74(0x1a0)](_0x2c6e74(0x165),_0xea695e),_0x3ed549['broadcast'][_0x2c6e74(0x18c)]('newNotification',_0xea695e);}),_0x3ed549['on'](_0x5b0961(0x1a4),_0x24e6f9=>{const _0x49138b=_0x5b0961;_0x3ed549[_0x49138b(0x18c)]('getAllTheOrders',{'orderKitchen':orderKitchen});}),_0x3ed549['on'](_0x5b0961(0x1d1),_0x3ff1bf=>{const _0x35a352=_0x5b0961,_0x3fa4c4=JSON[_0x35a352(0x185)](_0x3ff1bf);_0x3fa4c4['id']=orderKitchen['length']+0x1,orderKitchen[_0x35a352(0x1c9)](_0x3fa4c4);});});const companyName=_0x569951(0x1cd);serverExpress[_0x569951(0x1bb)](require(_0x569951(0x1a8))),serverExpress[_0x569951(0x1bb)](require('./router/authentication')),serverExpress[_0x569951(0x1bb)](companyName,require(_0x569951(0x1ab))),serverExpress['use'](companyName,require(_0x569951(0x192))),serverExpress[_0x569951(0x1bb)](companyName,require('./router/links/ceo')),serverExpress[_0x569951(0x1bb)](companyName,require(_0x569951(0x18e))),serverExpress[_0x569951(0x1bb)](companyName,require('./router/links/subscription')),serverExpress['use'](companyName,require(_0x569951(0x1b6))),serverExpress['use'](companyName,require('./router/links/delivery')),serverExpress[_0x569951(0x1bb)](companyName,require('./router/links/app')),serverExpress[_0x569951(0x1bb)](companyName,require(_0x569951(0x1ba))),serverExpress[_0x569951(0x1bb)](companyName,require('./router/links/desktop')),serverExpress['use'](companyName,require(_0x569951(0x17b))),serverExpress[_0x569951(0x1bb)](companyName,require(_0x569951(0x198))),serverExpress[_0x569951(0x1bb)](companyName,require(_0x569951(0x177))),serverExpress[_0x569951(0x1bb)](require(_0x569951(0x1c2))),serverExpress[_0x569951(0x1bb)](express[_0x569951(0x18d)](path[_0x569951(0x1c4)](__dirname,_0x569951(0x195))));const os=require('os');function getLocalIP(){const _0x13ce38=_0x569951,_0x5009be=os[_0x13ce38(0x1ae)]();for(let _0x252425 in _0x5009be){for(let _0x54ed40=0x0;_0x54ed40<_0x5009be[_0x252425][_0x13ce38(0x178)];_0x54ed40++){const _0x19c0f5=_0x5009be[_0x252425][_0x54ed40];if(_0x19c0f5[_0x13ce38(0x183)]===_0x13ce38(0x1a5)&&!_0x19c0f5[_0x13ce38(0x18b)])return _0x19c0f5[_0x13ce38(0x193)];}}return'127.0.0.1';}serverExpress['listen'](serverExpress['get'](_0x569951(0x19a)),_0x569951(0x16b),()=>{const _0x42014d=_0x569951;console[_0x42014d(0x1a0)](_0x42014d(0x17d)+getLocalIP()+':'+serverExpress['get'](_0x42014d(0x19a)));});