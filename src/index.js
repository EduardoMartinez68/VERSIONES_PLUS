const _0x2af902=_0x39b8;(function(_0x143732,_0x5ac5a1){const _0x39e480=_0x39b8,_0x392ea6=_0x143732();while(!![]){try{const _0x3196f4=parseInt(_0x39e480(0x1bf))/0x1+-parseInt(_0x39e480(0x18e))/0x2*(-parseInt(_0x39e480(0x185))/0x3)+parseInt(_0x39e480(0x17d))/0x4+-parseInt(_0x39e480(0x1a0))/0x5*(-parseInt(_0x39e480(0x196))/0x6)+-parseInt(_0x39e480(0x161))/0x7*(parseInt(_0x39e480(0x15d))/0x8)+-parseInt(_0x39e480(0x179))/0x9+-parseInt(_0x39e480(0x1a7))/0xa;if(_0x3196f4===_0x5ac5a1)break;else _0x392ea6['push'](_0x392ea6['shift']());}catch(_0x127257){_0x392ea6['push'](_0x392ea6['shift']());}}}(_0x5403,0x35b66));const system=require(_0x2af902(0x177)),express=require('express'),morgan=require(_0x2af902(0x19b)),{engine}=require(_0x2af902(0x1c0)),multer=require(_0x2af902(0x174)),flash=require(_0x2af902(0x16a)),session=require(_0x2af902(0x1a1)),passport=require(_0x2af902(0x160)),{database}=require(_0x2af902(0x16f)),{v4:uuid}=require(_0x2af902(0x197)),path=require(_0x2af902(0x173)),{RecaptchaV2}=require('express-recaptcha'),serverExpress=express();require('./lib/passport'),require(_0x2af902(0x162)),serverExpress[_0x2af902(0x16c)](_0x2af902(0x178),process[_0x2af902(0x1ca)][_0x2af902(0x195)]||0xfa0),serverExpress[_0x2af902(0x16c)](_0x2af902(0x17a),path['join'](__dirname,_0x2af902(0x17a))),serverExpress[_0x2af902(0x1ae)]('.hbs',engine({'defaultLayout':'main','layoutsDir':path[_0x2af902(0x17c)](serverExpress['get'](_0x2af902(0x17a)),_0x2af902(0x1b6)),'partialsDir':path[_0x2af902(0x17c)](serverExpress[_0x2af902(0x1bd)](_0x2af902(0x17a)),_0x2af902(0x16d)),'extname':_0x2af902(0x1c4),'helpers':require(_0x2af902(0x183))})),serverExpress['set'](_0x2af902(0x170),_0x2af902(0x1c4)),require(_0x2af902(0x17f))[_0x2af902(0x1b8)]();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process[_0x2af902(0x1ca)],pg=require('pg'),pgPool=new pg[(_0x2af902(0x1b5))]({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress[_0x2af902(0x1b1)](session({'secret':_0x2af902(0x1b0),'resave':![],'saveUninitialized':![],'store':new(require(_0x2af902(0x184))(session))({'pool':pgPool,'tableName':'session'})})),serverExpress[_0x2af902(0x1b1)](flash()),serverExpress[_0x2af902(0x1b1)](morgan(_0x2af902(0x172))),serverExpress[_0x2af902(0x1b1)](express[_0x2af902(0x1a5)]({'extended':![]})),serverExpress['use'](express[_0x2af902(0x17b)]()),serverExpress[_0x2af902(0x1b1)](passport['initialize']()),serverExpress[_0x2af902(0x1b1)](passport['session']());const storage=multer[_0x2af902(0x1ab)]({'destination':path[_0x2af902(0x17c)](__dirname,_0x2af902(0x18b)),'filename':(_0x59d53d,_0x4b8359,_0x3e479f,_0x1c2c09)=>{const _0x137f31=_0x2af902;_0x3e479f(null,uuid()+path['extname'](_0x4b8359[_0x137f31(0x1c1)]));}});serverExpress[_0x2af902(0x1b1)](multer({'storage':storage})['single'](_0x2af902(0x1a9))),serverExpress['use']((_0x314e06,_0x392ade,_0x4413b6)=>{const _0x5292f4=_0x2af902;serverExpress[_0x5292f4(0x187)][_0x5292f4(0x1aa)]=_0x314e06[_0x5292f4(0x1b3)](_0x5292f4(0x1aa)),serverExpress['locals']['message']=_0x314e06[_0x5292f4(0x1b3)](_0x5292f4(0x1b4)),serverExpress[_0x5292f4(0x187)][_0x5292f4(0x164)]=_0x314e06[_0x5292f4(0x164)],serverExpress[_0x5292f4(0x187)][_0x5292f4(0x15f)]=_0x314e06[_0x5292f4(0x15f)],serverExpress['locals'][_0x5292f4(0x19d)]=0x0,serverExpress[_0x5292f4(0x187)]['pack_branch']=0x0,_0x4413b6();});const http=require('http'),serverSocket=http['createServer'](serverExpress),{Server}=require(_0x2af902(0x1ba)),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require('./services/chat.js');serverSocket[_0x2af902(0x194)](serverExpress[_0x2af902(0x1bd)](_0x2af902(0x178)),()=>{const _0x5d1dfe=_0x2af902;console[_0x5d1dfe(0x169)](_0x5d1dfe(0x1a8)+serverExpress[_0x5d1dfe(0x1bd)](_0x5d1dfe(0x178)));}),io['on'](_0x2af902(0x199),async _0x88a75d=>{const _0x4c4490=_0x2af902;console[_0x4c4490(0x169)](_0x4c4490(0x1b2)),_0x88a75d['on'](_0x4c4490(0x1bc),async(_0x10621a,_0x227a80)=>{const _0x43df37=_0x4c4490,_0x2c14c0=connectedEmployees[_0x227a80]||[],_0x126778=_0x2c14c0[_0x43df37(0x188)](_0x28bf64=>_0x28bf64['userId']===_0x10621a);if(_0x126778){_0x88a75d['emit'](_0x43df37(0x1a6),_0x43df37(0x15a));return;}if(system!=_0x43df37(0x15b)){!companyLimitsCache[_0x227a80]&&(companyLimitsCache[_0x227a80]=await chat[_0x43df37(0x181)](_0x227a80));const _0x47cf04=companyLimitsCache[_0x227a80];if(_0x2c14c0[_0x43df37(0x1c5)]>=_0x47cf04){_0x88a75d[_0x43df37(0x1ac)]('connectionRejected',_0x43df37(0x18c));return;}}_0x88a75d[_0x43df37(0x163)]=_0x227a80,_0x2c14c0['push']({'userId':_0x10621a,'socketId':_0x88a75d['id']}),connectedEmployees[_0x227a80]=_0x2c14c0;const _0x28a509=await chat['get_the_first_notification'](_0x10621a,0xa);io['to'](_0x10621a)['emit']('privateNotifications',{'notifications':_0x28a509});});async function _0x59a7b9(_0x55faec){const _0x230b0e=users[_0x55faec];let _0x53c225=_0x230b0e;!_0x230b0e&&(_0x53c225=await chat['this_email_exist'](toUserId));const _0x3ef5f2={'canSend':_0x53c225,'theUserIsConnect':_0x230b0e};return _0x3ef5f2;}_0x88a75d['on'](_0x4c4490(0x1c2),async({userEmail:_0x1aab77,toUserEmail:_0x333e23,message:_0x1b9692})=>{const _0x1376fa=_0x4c4490,_0x4bf420=await _0x59a7b9(_0x333e23);_0x4bf420['canSend']?await chat['create_notification'](_0x1aab77,_0x333e23,_0x1b9692)?(_0x4bf420[_0x1376fa(0x15c)]&&io['to'](recipientSocketId)[_0x1376fa(0x1ac)]('privateMessage',{'userId':userId,'message':_0x1b9692}),_0x88a75d['emit']('messageStatus',{'success':!![],'message':_0x1376fa(0x191)})):_0x88a75d['emit'](_0x1376fa(0x171),{'success':![],'message':_0x1376fa(0x16b)+_0x333e23+_0x1376fa(0x18f)}):_0x88a75d[_0x1376fa(0x1ac)]('messageStatus',{'success':![],'message':_0x1376fa(0x186)+_0x333e23+_0x1376fa(0x15e)});}),_0x88a75d['on'](_0x4c4490(0x17e),async({userEmail:_0x188748})=>{const _0x5bdf07=_0x4c4490,_0x494ac9=await chat[_0x5bdf07(0x1c8)](_0x188748,0xa);io['to'](recipientSocketId)[_0x5bdf07(0x1ac)](_0x5bdf07(0x167),{'notifications':_0x494ac9});}),_0x88a75d['on']('sendMessageToUser',async({userId:_0x4274dd,toUserId:_0x520f8b,message:_0x107fef})=>{const _0x431496=_0x4c4490,_0x2d6540=users[_0x520f8b];let _0xf05e5f=_0x2d6540;!_0x2d6540&&(_0xf05e5f=await chat['this_email_exist'](_0x520f8b));if(_0xf05e5f){const _0x45cb8c=await chat[_0x431496(0x168)](_0x4274dd,_0x520f8b);await chat['send_new_message'](_0x45cb8c,_0x4274dd,_0x107fef)&&(_0x2d6540&&io['to'](_0x2d6540)[_0x431496(0x1ac)]('privateMessage',{'userId':_0x4274dd,'message':_0x107fef})),_0x88a75d[_0x431496(0x1ac)](_0x431496(0x171),{'success':!![],'message':_0x431496(0x1c3)});}else _0x88a75d[_0x431496(0x1ac)](_0x431496(0x171),{'success':![],'message':_0x431496(0x193)+_0x520f8b+'\x27\x20no\x20existe\x20ðŸ¤”'});}),_0x88a75d['on'](_0x4c4490(0x1bb),()=>{const _0x216b84=_0x4c4490,{companyId:_0x12a466}=_0x88a75d;_0x12a466&&connectedEmployees[_0x12a466]?(connectedEmployees[_0x12a466]=connectedEmployees[_0x12a466]['filter'](_0x5f0405=>_0x5f0405[_0x216b84(0x1ad)]!==_0x88a75d['id']),connectedEmployees[_0x12a466][_0x216b84(0x1c5)]===0x0&&delete connectedEmployees[_0x12a466]):console['log'](_0x216b84(0x190)+_0x88a75d['id']+_0x216b84(0x1a3));}),_0x88a75d['on']('sendNotification',_0x59085f=>{const _0x2a68a9=_0x4c4490;console[_0x2a68a9(0x169)](_0x2a68a9(0x1a2),_0x59085f),_0x88a75d['broadcast'][_0x2a68a9(0x1ac)](_0x2a68a9(0x189),_0x59085f);}),_0x88a75d['on'](_0x4c4490(0x166),_0x224113=>{const _0x54d6b9=_0x4c4490;_0x88a75d[_0x54d6b9(0x1ac)](_0x54d6b9(0x19c),{'orderKitchen':orderKitchen});}),_0x88a75d['on']('saveANewOrder',_0x1f38b5=>{const _0xbe413=_0x4c4490,_0x573c83=JSON[_0xbe413(0x198)](_0x1f38b5);_0x573c83['id']=orderKitchen[_0xbe413(0x1c5)]+0x1,orderKitchen['push'](_0x573c83);});});function _0x5403(){const _0x5b07b0=['company','passport','7pTCfUJ','./lib/editFrom','companyId','user','./router/links/CRM','sendAllTheOrders','privateNotifications','create_new_chat','log','connect-flash','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27','set','partials','./router/links/orders','./keys','view\x20engine','messageStatus','dev','path','multer','networkInterfaces','./router/links/desktop','./lib/system','port','418626xlAdzm','views','json','join','877932vMlFqn','getTheFirstTenNotifications','dotenv','./router/links/boutique','get_max_employee_of_this_company','127.0.0.1','./lib/handlebars','connect-pg-simple','3xdOIDE','El\x20usuario\x20\x27','locals','some','newNotification','internal','public/img/uploads','Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20lÃ­mite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresÃ­a.','./router/links/subscription','768668zmDbUH','\x27.\x20IntÃ©ntalo\x20de\x20nuevo.\x20ðŸ˜³','Socket\x20','Mensaje\x20enviado\x20con\x20Ã©xito.\x20ðŸ‘Œ','./router/links/ceo','Este\x20email\x20\x27','listen','PORT','6ombUwo','uuid','parse','connection','./lib/addFrom','morgan','getAllTheOrders','pack_company','family','address','1157305AhbRVm','express-session','Nueva\x20notificaciÃ³n:','\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.','Server\x20running\x20on\x20http://','urlencoded','connectionRejected','4030180lNQhlE','Server\x20running\x20on\x20port\x20','image','success','diskStorage','emit','socketId','engine','./router/links','FudSession','use','Un\x20usuario\x20se\x20ha\x20conectado','flash','message','Pool','layouts','./router/links/branch','config','IPv4','socket.io','disconnect','registerUser','get','./router/links/delivery','122111yzJqkx','express-handlebars','originalname','sendNotificationToUser','Mensaje\x20enviado\x20con\x20Ã©xito','.hbs','length','static','./router','get_the_first_notification','/links','env','Ups,\x20parece\x20que\x20ya\x20estÃ¡s\x20conectado\x20en\x20otro\x20dispositivo.','desktop','theUserIsConnect','2302808DWQSxa','\x27\x20no\x20existe.\x20ðŸ¤”'];_0x5403=function(){return _0x5b07b0;};return _0x5403();}const companyName=_0x2af902(0x1c9);serverExpress[_0x2af902(0x1b1)](require(_0x2af902(0x1c7))),serverExpress[_0x2af902(0x1b1)](require('./router/authentication')),serverExpress[_0x2af902(0x1b1)](companyName,require(_0x2af902(0x1af))),serverExpress[_0x2af902(0x1b1)](companyName,require('./router/links/fudone')),serverExpress['use'](companyName,require(_0x2af902(0x192))),serverExpress['use'](companyName,require(_0x2af902(0x1b7))),serverExpress[_0x2af902(0x1b1)](companyName,require(_0x2af902(0x18d))),serverExpress[_0x2af902(0x1b1)](companyName,require('./router/links/store')),serverExpress[_0x2af902(0x1b1)](companyName,require(_0x2af902(0x1be))),serverExpress[_0x2af902(0x1b1)](companyName,require('./router/links/app')),serverExpress[_0x2af902(0x1b1)](companyName,require(_0x2af902(0x165))),serverExpress[_0x2af902(0x1b1)](companyName,require(_0x2af902(0x176))),serverExpress[_0x2af902(0x1b1)](companyName,require(_0x2af902(0x180))),serverExpress[_0x2af902(0x1b1)](companyName,require('./router/links/cashCut')),serverExpress[_0x2af902(0x1b1)](companyName,require(_0x2af902(0x16e))),serverExpress['use'](require(_0x2af902(0x19a))),serverExpress[_0x2af902(0x1b1)](express[_0x2af902(0x1c6)](path['join'](__dirname,'public')));function _0x39b8(_0x2bba7c,_0x3242a8){const _0x5403a9=_0x5403();return _0x39b8=function(_0x39b84d,_0x426653){_0x39b84d=_0x39b84d-0x15a;let _0x51e7de=_0x5403a9[_0x39b84d];return _0x51e7de;},_0x39b8(_0x2bba7c,_0x3242a8);}const os=require('os');function getLocalIP(){const _0xb35af0=_0x2af902,_0x27ab88=os[_0xb35af0(0x175)]();for(let _0x59e69f in _0x27ab88){for(let _0x415de5=0x0;_0x415de5<_0x27ab88[_0x59e69f]['length'];_0x415de5++){const _0x72037b=_0x27ab88[_0x59e69f][_0x415de5];if(_0x72037b[_0xb35af0(0x19e)]===_0xb35af0(0x1b9)&&!_0x72037b[_0xb35af0(0x18a)])return _0x72037b[_0xb35af0(0x19f)];}}return _0xb35af0(0x182);}serverExpress[_0x2af902(0x194)](serverExpress[_0x2af902(0x1bd)](_0x2af902(0x178)),'0.0.0.0',()=>{const _0x3dbee7=_0x2af902;console[_0x3dbee7(0x169)](_0x3dbee7(0x1a4)+getLocalIP()+':'+serverExpress[_0x3dbee7(0x1bd)](_0x3dbee7(0x178)));});