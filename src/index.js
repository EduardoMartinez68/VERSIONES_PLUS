const _0x1950e0=_0x21fb;(function(_0x296a81,_0x871c1b){const _0x60e96d=_0x21fb,_0x445a22=_0x296a81();while(!![]){try{const _0x4e07a6=-parseInt(_0x60e96d(0x222))/0x1*(-parseInt(_0x60e96d(0x20d))/0x2)+-parseInt(_0x60e96d(0x1d9))/0x3+parseInt(_0x60e96d(0x204))/0x4+-parseInt(_0x60e96d(0x1ce))/0x5+parseInt(_0x60e96d(0x1d8))/0x6+-parseInt(_0x60e96d(0x210))/0x7+-parseInt(_0x60e96d(0x207))/0x8;if(_0x4e07a6===_0x871c1b)break;else _0x445a22['push'](_0x445a22['shift']());}catch(_0x16ab56){_0x445a22['push'](_0x445a22['shift']());}}}(_0x3542,0x953a6));const system=require(_0x1950e0(0x1ad)),express=require('express'),morgan=require(_0x1950e0(0x1fa)),{engine}=require('express-handlebars'),multer=require('multer'),flash=require(_0x1950e0(0x1f5)),session=require('express-session'),passport=require(_0x1950e0(0x1fe)),{database}=require(_0x1950e0(0x209)),{v4:uuid}=require(_0x1950e0(0x1be)),path=require(_0x1950e0(0x1f1)),{RecaptchaV2}=require(_0x1950e0(0x221)),nodePersist=require(_0x1950e0(0x1eb));function _0x21fb(_0x39d03a,_0x3104a9){const _0x354256=_0x3542();return _0x21fb=function(_0x21fbf6,_0x5ac8d8){_0x21fbf6=_0x21fbf6-0x1a6;let _0x578add=_0x354256[_0x21fbf6];return _0x578add;},_0x21fb(_0x39d03a,_0x3104a9);}nodePersist[_0x1950e0(0x1af)]({'dir':path[_0x1950e0(0x211)](__dirname,_0x1950e0(0x1d0))});function _0x3542(){const _0x4a57a5=['main','locals','get_max_employee_of_this_company','user','./lib/passport','this_email_exist','message','error','.js','./services/chat.js','address','use','statSync','uuid','IPv4','❌\x20Error\x20ejecutando\x20SQL:','PORT','Server\x20running\x20on\x20port\x20','log','isFile','dotenv','json','saveANewOrder','registerUser','privateNotifications','readFileSync','Ups,\x20parece\x20que\x20ya\x20estás\x20conectado\x20en\x20otro\x20dispositivo.','partials','get_the_first_notification','1500160mMpakt','config','data','send_new_message','./router','emit','database','image','internal','messageStatus','190200jHbpBq','116052xLiaEr','disconnect','views','📦\x20Base\x20de\x20datos\x20EDPLUS\x20creada','\x27.\x20Inténtalo\x20de\x20nuevo.\x20😳','connectionRejected','filter','createServer','127.0.0.1','endsWith','diskStorage','\x27\x20no\x20existe.\x20🤔','map','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27','/links','utf8','sendNotification','✅\x20SQL\x20ejecutado\x20correctamente','node-persist','./router/links','El\x20usuario\x20\x27','static','Nueva\x20notificación:','.hbs','path','canSend','env','router/links','connect-flash','./lib/addFrom','edplus.sql','theUserIsConnect','pack_company','morgan','\x27\x20no\x20existe\x20🤔','FudSession','query','passport','./lib/editFrom','session','create_notification','SELECT\x201\x20FROM\x20pg_database\x20WHERE\x20datname\x20=\x20\x27edplus\x27','./router/authentication','4143556jxwWFC','Un\x20usuario\x20se\x20ha\x20conectado','get','3043368dpPDKM','connection','./keys','forEach','getTheFirstTenNotifications','Este\x20email\x20\x27','100fZpkqc','listen','originalname','4704448TQSmcm','join','flash','📂\x20La\x20base\x20de\x20datos\x20EDPLUS\x20ya\x20existe,\x20no\x20se\x20creó\x20nuevamente.','layouts','privateMessage','./lib/handlebars','family','companyId','push','userId','split','pack_branch','Server\x20running\x20on\x20http://','single','dev','length','express-recaptcha','18697Gfgydk','parse','port','Pool','company','success','set','view\x20engine','public','broadcast','newNotification','urlencoded','./lib/system','networkInterfaces','init','public/img/uploads'];_0x3542=function(){return _0x4a57a5;};return _0x3542();}const serverExpress=express();require(_0x1950e0(0x1b5)),require(_0x1950e0(0x1ff)),serverExpress[_0x1950e0(0x1a7)](_0x1950e0(0x224),process[_0x1950e0(0x1f3)][_0x1950e0(0x1c1)]||0xfa0),serverExpress['set']('views',path[_0x1950e0(0x211)](__dirname,_0x1950e0(0x1db))),serverExpress['engine']('.hbs',engine({'defaultLayout':_0x1950e0(0x1b1),'layoutsDir':path[_0x1950e0(0x211)](serverExpress[_0x1950e0(0x206)](_0x1950e0(0x1db)),_0x1950e0(0x214)),'partialsDir':path[_0x1950e0(0x211)](serverExpress[_0x1950e0(0x206)](_0x1950e0(0x1db)),_0x1950e0(0x1cc)),'extname':_0x1950e0(0x1f0),'helpers':require(_0x1950e0(0x216))})),serverExpress[_0x1950e0(0x1a7)](_0x1950e0(0x1a8),'.hbs'),require(_0x1950e0(0x1c5))[_0x1950e0(0x1cf)]();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process[_0x1950e0(0x1f3)],pg=require('pg'),fs=require('fs'),adminPool=new pg['Pool']({'user':APP_PG_USER,'host':APP_PG_HOST,'password':APP_PG_PASSWORD,'port':APP_PG_PORT,'database':'postgres'}),importSQLFile=async _0x48e62e=>{const _0x24c653=_0x1950e0,_0x2fb347=path['join'](__dirname,_0x24c653(0x1d4),_0x24c653(0x1f7)),_0x4406cc=fs[_0x24c653(0x1ca)](_0x2fb347,_0x24c653(0x1e8)),_0x5558a8=_0x4406cc[_0x24c653(0x21b)](/;\s*$/m)[_0x24c653(0x1e5)](_0x5d6a74=>_0x5d6a74['trim']())[_0x24c653(0x1df)](_0x116fdb=>_0x116fdb[_0x24c653(0x220)]>0x0),_0x5c7125=await _0x48e62e['connect']();try{for(const _0x5c1820 of _0x5558a8){await _0x5c7125['query'](_0x5c1820);}console[_0x24c653(0x1c3)](_0x24c653(0x1ea));}catch(_0x299f94){console[_0x24c653(0x1b8)](_0x24c653(0x1c0),_0x299f94[_0x24c653(0x1b7)]);}finally{_0x5c7125['release']();}},createDatabase=async()=>{const _0x5fa080=_0x1950e0,_0xe732cb=await adminPool[_0x5fa080(0x1fd)](_0x5fa080(0x202));_0xe732cb['rowCount']===0x0?(await adminPool[_0x5fa080(0x1fd)]('CREATE\x20DATABASE\x20edplus'),importSQLFile(adminPool),console[_0x5fa080(0x1c3)](_0x5fa080(0x1dc))):console[_0x5fa080(0x1c3)](_0x5fa080(0x213));};createDatabase();const pgPool=new pg[(_0x1950e0(0x225))]({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress[_0x1950e0(0x1bc)](session({'secret':_0x1950e0(0x1fc),'resave':![],'saveUninitialized':![],'store':new(require('connect-pg-simple')(session))({'pool':pgPool,'tableName':_0x1950e0(0x200)})})),serverExpress['use'](flash()),serverExpress[_0x1950e0(0x1bc)](morgan(_0x1950e0(0x21f))),serverExpress[_0x1950e0(0x1bc)](express[_0x1950e0(0x1ac)]({'extended':![]})),serverExpress[_0x1950e0(0x1bc)](express[_0x1950e0(0x1c6)]()),serverExpress[_0x1950e0(0x1bc)](passport['initialize']()),serverExpress[_0x1950e0(0x1bc)](passport['session']());const storage=multer[_0x1950e0(0x1e3)]({'destination':path[_0x1950e0(0x211)](__dirname,_0x1950e0(0x1b0)),'filename':(_0x11f6aa,_0x16714c,_0x3b5dc8,_0x8b6d59)=>{const _0xa95305=_0x1950e0;_0x3b5dc8(null,uuid()+path['extname'](_0x16714c[_0xa95305(0x20f)]));}});serverExpress[_0x1950e0(0x1bc)](multer({'storage':storage})[_0x1950e0(0x21e)](_0x1950e0(0x1d5))),serverExpress[_0x1950e0(0x1bc)]((_0x121789,_0x4f75b0,_0x6b153)=>{const _0x49406a=_0x1950e0;serverExpress[_0x49406a(0x1b2)][_0x49406a(0x1a6)]=_0x121789['flash']('success'),serverExpress['locals'][_0x49406a(0x1b7)]=_0x121789[_0x49406a(0x212)](_0x49406a(0x1b7)),serverExpress[_0x49406a(0x1b2)][_0x49406a(0x1b4)]=_0x121789[_0x49406a(0x1b4)],serverExpress[_0x49406a(0x1b2)][_0x49406a(0x226)]=_0x121789[_0x49406a(0x226)],serverExpress[_0x49406a(0x1b2)][_0x49406a(0x1f9)]=0x0,serverExpress['locals'][_0x49406a(0x21c)]=0x0,_0x6b153();});const http=require('http'),serverSocket=http[_0x1950e0(0x1e0)](serverExpress),{Server}=require('socket.io'),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require(_0x1950e0(0x1ba));serverSocket[_0x1950e0(0x20e)](serverExpress['get'](_0x1950e0(0x224)),()=>{const _0x1578c3=_0x1950e0;console[_0x1578c3(0x1c3)](_0x1578c3(0x1c2)+serverExpress[_0x1578c3(0x206)](_0x1578c3(0x224)));}),io['on'](_0x1950e0(0x208),async _0x3e8e75=>{const _0xb6dfb7=_0x1950e0;console[_0xb6dfb7(0x1c3)](_0xb6dfb7(0x205)),_0x3e8e75['on'](_0xb6dfb7(0x1c8),async(_0x4bc3b6,_0x5a698c)=>{const _0x1c40fd=_0xb6dfb7,_0x26aad2=connectedEmployees[_0x5a698c]||[],_0x3da29f=_0x26aad2['some'](_0x392db1=>_0x392db1[_0x1c40fd(0x21a)]===_0x4bc3b6);if(_0x3da29f){_0x3e8e75[_0x1c40fd(0x1d3)](_0x1c40fd(0x1de),_0x1c40fd(0x1cb));return;}if(system!='desktop'){!companyLimitsCache[_0x5a698c]&&(companyLimitsCache[_0x5a698c]=await chat[_0x1c40fd(0x1b3)](_0x5a698c));const _0x328265=companyLimitsCache[_0x5a698c];if(_0x26aad2[_0x1c40fd(0x220)]>=_0x328265){_0x3e8e75[_0x1c40fd(0x1d3)](_0x1c40fd(0x1de),'Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20límite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresía.');return;}}_0x3e8e75[_0x1c40fd(0x218)]=_0x5a698c,_0x26aad2[_0x1c40fd(0x219)]({'userId':_0x4bc3b6,'socketId':_0x3e8e75['id']}),connectedEmployees[_0x5a698c]=_0x26aad2;const _0x2f8ef5=await chat[_0x1c40fd(0x1cd)](_0x4bc3b6,0xa);io['to'](_0x4bc3b6)['emit'](_0x1c40fd(0x1c9),{'notifications':_0x2f8ef5});});async function _0x157f73(_0x2948bd){const _0x2e0a9b=_0xb6dfb7,_0x1f1c5b=users[_0x2948bd];let _0x3e0237=_0x1f1c5b;!_0x1f1c5b&&(_0x3e0237=await chat[_0x2e0a9b(0x1b6)](toUserId));const _0x599b95={'canSend':_0x3e0237,'theUserIsConnect':_0x1f1c5b};return _0x599b95;}_0x3e8e75['on']('sendNotificationToUser',async({userEmail:_0x2db53e,toUserEmail:_0x5d3c39,message:_0x25649f})=>{const _0x186bf6=_0xb6dfb7,_0x3c0977=await _0x157f73(_0x5d3c39);_0x3c0977[_0x186bf6(0x1f2)]?await chat[_0x186bf6(0x201)](_0x2db53e,_0x5d3c39,_0x25649f)?(_0x3c0977[_0x186bf6(0x1f8)]&&io['to'](recipientSocketId)[_0x186bf6(0x1d3)](_0x186bf6(0x215),{'userId':userId,'message':_0x25649f}),_0x3e8e75[_0x186bf6(0x1d3)](_0x186bf6(0x1d7),{'success':!![],'message':'Mensaje\x20enviado\x20con\x20éxito.\x20👌'})):_0x3e8e75[_0x186bf6(0x1d3)](_0x186bf6(0x1d7),{'success':![],'message':_0x186bf6(0x1e6)+_0x5d3c39+_0x186bf6(0x1dd)}):_0x3e8e75[_0x186bf6(0x1d3)]('messageStatus',{'success':![],'message':_0x186bf6(0x1ed)+_0x5d3c39+_0x186bf6(0x1e4)});}),_0x3e8e75['on'](_0xb6dfb7(0x20b),async({userEmail:_0x29e052})=>{const _0x352ab5=_0xb6dfb7,_0x904040=await chat[_0x352ab5(0x1cd)](_0x29e052,0xa);io['to'](recipientSocketId)[_0x352ab5(0x1d3)]('privateNotifications',{'notifications':_0x904040});}),_0x3e8e75['on']('sendMessageToUser',async({userId:_0x4cb851,toUserId:_0x4bdb84,message:_0x5f7fa2})=>{const _0x4e6aeb=_0xb6dfb7,_0x374271=users[_0x4bdb84];let _0x368675=_0x374271;!_0x374271&&(_0x368675=await chat[_0x4e6aeb(0x1b6)](_0x4bdb84));if(_0x368675){const _0x5553a4=await chat['create_new_chat'](_0x4cb851,_0x4bdb84);await chat[_0x4e6aeb(0x1d1)](_0x5553a4,_0x4cb851,_0x5f7fa2)&&(_0x374271&&io['to'](_0x374271)['emit'](_0x4e6aeb(0x215),{'userId':_0x4cb851,'message':_0x5f7fa2})),_0x3e8e75[_0x4e6aeb(0x1d3)](_0x4e6aeb(0x1d7),{'success':!![],'message':'Mensaje\x20enviado\x20con\x20éxito'});}else _0x3e8e75['emit'](_0x4e6aeb(0x1d7),{'success':![],'message':_0x4e6aeb(0x20c)+_0x4bdb84+_0x4e6aeb(0x1fb)});}),_0x3e8e75['on'](_0xb6dfb7(0x1da),()=>{const _0x294b76=_0xb6dfb7,{companyId:_0x4cee0f}=_0x3e8e75;_0x4cee0f&&connectedEmployees[_0x4cee0f]?(connectedEmployees[_0x4cee0f]=connectedEmployees[_0x4cee0f]['filter'](_0x191d5a=>_0x191d5a['socketId']!==_0x3e8e75['id']),connectedEmployees[_0x4cee0f][_0x294b76(0x220)]===0x0&&delete connectedEmployees[_0x4cee0f]):console[_0x294b76(0x1c3)]('Socket\x20'+_0x3e8e75['id']+'\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.');}),_0x3e8e75['on'](_0xb6dfb7(0x1e9),_0x3e122a=>{const _0x30c521=_0xb6dfb7;console[_0x30c521(0x1c3)](_0x30c521(0x1ef),_0x3e122a),_0x3e8e75[_0x30c521(0x1aa)][_0x30c521(0x1d3)](_0x30c521(0x1ab),_0x3e122a);}),_0x3e8e75['on']('sendAllTheOrders',_0x3cda6a=>{_0x3e8e75['emit']('getAllTheOrders',{'orderKitchen':orderKitchen});}),_0x3e8e75['on'](_0xb6dfb7(0x1c7),_0x442fd4=>{const _0x3da2bf=_0xb6dfb7,_0x21dc12=JSON[_0x3da2bf(0x223)](_0x442fd4);_0x21dc12['id']=orderKitchen['length']+0x1,orderKitchen[_0x3da2bf(0x219)](_0x21dc12);});});const companyName=_0x1950e0(0x1e7);serverExpress[_0x1950e0(0x1bc)](require(_0x1950e0(0x1d2))),serverExpress[_0x1950e0(0x1bc)](require(_0x1950e0(0x203))),serverExpress[_0x1950e0(0x1bc)](companyName,require(_0x1950e0(0x1ec)));const routesPath=path[_0x1950e0(0x211)](__dirname,_0x1950e0(0x1f4));fs['readdirSync'](routesPath)[_0x1950e0(0x20a)](_0x51e48d=>{const _0xd79304=_0x1950e0,_0x4ae801=path[_0xd79304(0x211)](routesPath,_0x51e48d);fs[_0xd79304(0x1bd)](_0x4ae801)[_0xd79304(0x1c4)]()&&_0x51e48d[_0xd79304(0x1e2)](_0xd79304(0x1b9))&&serverExpress[_0xd79304(0x1bc)](companyName,require(_0x4ae801));}),serverExpress[_0x1950e0(0x1bc)](require(_0x1950e0(0x1f6))),serverExpress['use'](express[_0x1950e0(0x1ee)](path['join'](__dirname,_0x1950e0(0x1a9))));const os=require('os');function getLocalIP(){const _0x2d74d7=_0x1950e0,_0x27d3f0=os[_0x2d74d7(0x1ae)]();for(let _0xeb79e1 in _0x27d3f0){for(let _0x4bf3c1=0x0;_0x4bf3c1<_0x27d3f0[_0xeb79e1][_0x2d74d7(0x220)];_0x4bf3c1++){const _0x2e4918=_0x27d3f0[_0xeb79e1][_0x4bf3c1];if(_0x2e4918[_0x2d74d7(0x217)]===_0x2d74d7(0x1bf)&&!_0x2e4918[_0x2d74d7(0x1d6)])return _0x2e4918[_0x2d74d7(0x1bb)];}}return _0x2d74d7(0x1e1);}serverExpress[_0x1950e0(0x20e)](serverExpress['get'](_0x1950e0(0x224)),'0.0.0.0',()=>{const _0x1025f1=_0x1950e0;console[_0x1025f1(0x1c3)](_0x1025f1(0x21d)+getLocalIP()+':'+serverExpress['get'](_0x1025f1(0x224)));});