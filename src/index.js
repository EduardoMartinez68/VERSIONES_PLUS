const _0xff68d6=_0xc3c3;(function(_0x58384e,_0x134e15){const _0x4281f3=_0xc3c3,_0x28117a=_0x58384e();while(!![]){try{const _0x33ff55=-parseInt(_0x4281f3(0x193))/0x1+-parseInt(_0x4281f3(0x146))/0x2+parseInt(_0x4281f3(0x14d))/0x3*(parseInt(_0x4281f3(0x116))/0x4)+parseInt(_0x4281f3(0x169))/0x5*(parseInt(_0x4281f3(0x152))/0x6)+-parseInt(_0x4281f3(0x119))/0x7+parseInt(_0x4281f3(0x11c))/0x8+parseInt(_0x4281f3(0x117))/0x9;if(_0x33ff55===_0x134e15)break;else _0x28117a['push'](_0x28117a['shift']());}catch(_0x585af3){_0x28117a['push'](_0x28117a['shift']());}}}(_0x3be2,0x7a6ff));const system=require('./lib/system'),express=require(_0xff68d6(0x125)),morgan=require(_0xff68d6(0x12d)),{engine}=require(_0xff68d6(0x16e)),multer=require(_0xff68d6(0x124)),flash=require(_0xff68d6(0x177)),session=require(_0xff68d6(0x141)),passport=require('passport'),{database}=require(_0xff68d6(0x175)),{v4:uuid}=require(_0xff68d6(0x112)),path=require('path'),{RecaptchaV2}=require(_0xff68d6(0x166)),nodePersist=require('node-persist');nodePersist[_0xff68d6(0x121)]({'dir':path[_0xff68d6(0x158)](__dirname,_0xff68d6(0x159))});const serverExpress=express();require(_0xff68d6(0x196)),require(_0xff68d6(0x128)),serverExpress[_0xff68d6(0x15c)](_0xff68d6(0x147),process['env'][_0xff68d6(0x12f)]||0xfa0),serverExpress[_0xff68d6(0x15c)](_0xff68d6(0x11f),path[_0xff68d6(0x158)](__dirname,_0xff68d6(0x11f))),serverExpress[_0xff68d6(0x18f)](_0xff68d6(0x155),engine({'defaultLayout':_0xff68d6(0x11e),'layoutsDir':path[_0xff68d6(0x158)](serverExpress['get'](_0xff68d6(0x11f)),_0xff68d6(0x114)),'partialsDir':path[_0xff68d6(0x158)](serverExpress[_0xff68d6(0x168)](_0xff68d6(0x11f)),'partials'),'extname':'.hbs','helpers':require('./lib/handlebars')})),serverExpress[_0xff68d6(0x15c)]('view\x20engine','.hbs');const fs=require('fs'),crypto=require(_0xff68d6(0x11d)),envPath=path[_0xff68d6(0x10d)](__dirname,_0xff68d6(0x134));let envContent=fs[_0xff68d6(0x11b)](envPath)?fs['readFileSync'](envPath,_0xff68d6(0x14e)):'';if(!envContent['includes'](_0xff68d6(0x186))){const newKey=crypto[_0xff68d6(0x13c)](0x20)['toString'](_0xff68d6(0x157));envContent+=_0xff68d6(0x17e)+newKey+'\x0a',fs[_0xff68d6(0x111)](envPath,envContent),console[_0xff68d6(0x15b)](_0xff68d6(0x19a));}else console[_0xff68d6(0x15b)](_0xff68d6(0x10c));require(_0xff68d6(0x118))[_0xff68d6(0x197)]();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process[_0xff68d6(0x11a)],pg=require('pg'),adminPool=new pg[(_0xff68d6(0x172))]({'user':APP_PG_USER,'host':APP_PG_HOST,'password':APP_PG_PASSWORD,'port':APP_PG_PORT,'database':_0xff68d6(0x13f)}),importSQLFile=async _0x11d89f=>{const _0xfc036b=_0xff68d6,_0x3c3d94=path[_0xfc036b(0x158)](__dirname,'database',_0xfc036b(0x165)),_0x39a791=fs['readFileSync'](_0x3c3d94,_0xfc036b(0x14e)),_0x42487f=_0x39a791[_0xfc036b(0x10f)](/;\s*$/m)[_0xfc036b(0x14a)](_0x3d8e96=>_0x3d8e96[_0xfc036b(0x13b)]())['filter'](_0x3ba8bd=>_0x3ba8bd[_0xfc036b(0x12b)]>0x0),_0x1217ef=await _0x11d89f[_0xfc036b(0x17c)]();try{for(const _0x3b67e4 of _0x42487f){await _0x1217ef[_0xfc036b(0x140)](_0x3b67e4);}console[_0xfc036b(0x15b)](_0xfc036b(0x192));}catch(_0x5d5917){console[_0xfc036b(0x127)](_0xfc036b(0x182),_0x5d5917[_0xfc036b(0x148)]);}finally{_0x1217ef[_0xfc036b(0x135)]();}},createDatabase=async()=>{const _0xf67df7=_0xff68d6,_0x5dbbe3=await adminPool[_0xf67df7(0x140)](_0xf67df7(0x194));_0x5dbbe3['rowCount']===0x0?(await adminPool[_0xf67df7(0x140)]('CREATE\x20DATABASE\x20edplus'),importSQLFile(adminPool),console[_0xf67df7(0x15b)](_0xf67df7(0x163))):console['log'](_0xf67df7(0x174));};createDatabase();const pgPool=new pg[(_0xff68d6(0x172))]({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress[_0xff68d6(0x15e)](session({'secret':_0xff68d6(0x14b),'resave':![],'saveUninitialized':![],'store':new(require(_0xff68d6(0x151))(session))({'pool':pgPool,'tableName':_0xff68d6(0x198)})})),serverExpress[_0xff68d6(0x15e)](flash()),serverExpress[_0xff68d6(0x15e)](morgan(_0xff68d6(0x17f))),serverExpress[_0xff68d6(0x15e)](express[_0xff68d6(0x16a)]({'extended':![]})),serverExpress[_0xff68d6(0x15e)](express[_0xff68d6(0x160)]()),serverExpress[_0xff68d6(0x15e)](passport['initialize']()),serverExpress[_0xff68d6(0x15e)](passport[_0xff68d6(0x198)]());function _0xc3c3(_0x37a6bd,_0x16ab4b){const _0x3be25a=_0x3be2();return _0xc3c3=function(_0xc3c3cc,_0x2985aa){_0xc3c3cc=_0xc3c3cc-0x10a;let _0x21bdfd=_0x3be25a[_0xc3c3cc];return _0x21bdfd;},_0xc3c3(_0x37a6bd,_0x16ab4b);}const storageImages=multer[_0xff68d6(0x16c)]({'destination':path[_0xff68d6(0x158)](__dirname,_0xff68d6(0x12c)),'filename':(_0x5b03a0,_0x3474a4,_0x14d4c1)=>{const _0x55b3b4=_0xff68d6;_0x14d4c1(null,uuid()+path[_0x55b3b4(0x120)](_0x3474a4[_0x55b3b4(0x123)]));}});serverExpress[_0xff68d6(0x15e)](multer({'storage':storageImages})['single'](_0xff68d6(0x13e))),serverExpress[_0xff68d6(0x15e)]((_0x3973e5,_0x1455dd,_0xa372dc)=>{const _0x82f6d2=_0xff68d6;serverExpress[_0x82f6d2(0x181)][_0x82f6d2(0x16f)]=_0x3973e5[_0x82f6d2(0x12e)]('success'),serverExpress[_0x82f6d2(0x181)][_0x82f6d2(0x148)]=_0x3973e5[_0x82f6d2(0x12e)](_0x82f6d2(0x148)),serverExpress[_0x82f6d2(0x181)][_0x82f6d2(0x149)]=_0x3973e5[_0x82f6d2(0x149)],serverExpress[_0x82f6d2(0x181)][_0x82f6d2(0x14c)]=_0x3973e5[_0x82f6d2(0x14c)],serverExpress['locals'][_0x82f6d2(0x137)]=0x0,serverExpress[_0x82f6d2(0x181)][_0x82f6d2(0x187)]=0x0,_0xa372dc();});const http=require(_0xff68d6(0x15f)),serverSocket=http[_0xff68d6(0x10e)](serverExpress),{Server}=require('socket.io'),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require(_0xff68d6(0x126));serverSocket[_0xff68d6(0x18e)](serverExpress['get'](_0xff68d6(0x147)),()=>{const _0x2a7b47=_0xff68d6;console[_0x2a7b47(0x15b)]('Server\x20running\x20on\x20port\x20'+serverExpress['get'](_0x2a7b47(0x147)));}),io['on'](_0xff68d6(0x173),async _0x1412ab=>{const _0x28905d=_0xff68d6;console[_0x28905d(0x15b)](_0x28905d(0x176)),_0x1412ab['on'](_0x28905d(0x133),async(_0x2d927f,_0x946ccb)=>{const _0x25cf99=_0x28905d,_0x3256d6=connectedEmployees[_0x946ccb]||[],_0x2e4223=_0x3256d6[_0x25cf99(0x189)](_0x2e4ebe=>_0x2e4ebe[_0x25cf99(0x178)]===_0x2d927f);if(_0x2e4223){_0x1412ab[_0x25cf99(0x115)](_0x25cf99(0x145),_0x25cf99(0x154));return;}if(system!=_0x25cf99(0x161)){!companyLimitsCache[_0x946ccb]&&(companyLimitsCache[_0x946ccb]=await chat[_0x25cf99(0x167)](_0x946ccb));const _0x1d64c8=companyLimitsCache[_0x946ccb];if(_0x3256d6[_0x25cf99(0x12b)]>=_0x1d64c8){_0x1412ab[_0x25cf99(0x115)](_0x25cf99(0x145),_0x25cf99(0x13a));return;}}_0x1412ab[_0x25cf99(0x17b)]=_0x946ccb,_0x3256d6['push']({'userId':_0x2d927f,'socketId':_0x1412ab['id']}),connectedEmployees[_0x946ccb]=_0x3256d6;const _0x545d8a=await chat[_0x25cf99(0x164)](_0x2d927f,0xa);io['to'](_0x2d927f)[_0x25cf99(0x115)](_0x25cf99(0x18a),{'notifications':_0x545d8a});});async function _0x2174fe(_0x3a0a89){const _0x2f3d1b=_0x28905d,_0xc36322=users[_0x3a0a89];let _0x1c2212=_0xc36322;!_0xc36322&&(_0x1c2212=await chat[_0x2f3d1b(0x191)](toUserId));const _0x200bc7={'canSend':_0x1c2212,'theUserIsConnect':_0xc36322};return _0x200bc7;}_0x1412ab['on'](_0x28905d(0x16d),async({userEmail:_0x42f0f2,toUserEmail:_0x32b0f9,message:_0xc208ab})=>{const _0x955ef9=_0x28905d,_0xbac317=await _0x2174fe(_0x32b0f9);_0xbac317[_0x955ef9(0x162)]?await chat['create_notification'](_0x42f0f2,_0x32b0f9,_0xc208ab)?(_0xbac317[_0x955ef9(0x130)]&&io['to'](recipientSocketId)[_0x955ef9(0x115)](_0x955ef9(0x153),{'userId':userId,'message':_0xc208ab}),_0x1412ab['emit'](_0x955ef9(0x122),{'success':!![],'message':_0x955ef9(0x18b)})):_0x1412ab[_0x955ef9(0x115)]('messageStatus',{'success':![],'message':_0x955ef9(0x132)+_0x32b0f9+_0x955ef9(0x195)}):_0x1412ab['emit'](_0x955ef9(0x122),{'success':![],'message':'El\x20usuario\x20\x27'+_0x32b0f9+'\x27\x20no\x20existe.\x20🤔'});}),_0x1412ab['on'](_0x28905d(0x15a),async({userEmail:_0x10ac2d})=>{const _0x1949c3=_0x28905d,_0x5db5cc=await chat[_0x1949c3(0x164)](_0x10ac2d,0xa);io['to'](recipientSocketId)[_0x1949c3(0x115)]('privateNotifications',{'notifications':_0x5db5cc});}),_0x1412ab['on'](_0x28905d(0x190),async({userId:_0x390d34,toUserId:_0xdeaf75,message:_0x2a5ee0})=>{const _0x252c89=_0x28905d,_0x5012db=users[_0xdeaf75];let _0x18b43e=_0x5012db;!_0x5012db&&(_0x18b43e=await chat[_0x252c89(0x191)](_0xdeaf75));if(_0x18b43e){const _0x2edb9f=await chat[_0x252c89(0x14f)](_0x390d34,_0xdeaf75);await chat['send_new_message'](_0x2edb9f,_0x390d34,_0x2a5ee0)&&(_0x5012db&&io['to'](_0x5012db)[_0x252c89(0x115)]('privateMessage',{'userId':_0x390d34,'message':_0x2a5ee0})),_0x1412ab['emit'](_0x252c89(0x122),{'success':!![],'message':_0x252c89(0x179)});}else _0x1412ab[_0x252c89(0x115)](_0x252c89(0x122),{'success':![],'message':_0x252c89(0x10a)+_0xdeaf75+_0x252c89(0x180)});}),_0x1412ab['on'](_0x28905d(0x16b),()=>{const _0x24ced9=_0x28905d,{companyId:_0x2ebc62}=_0x1412ab;_0x2ebc62&&connectedEmployees[_0x2ebc62]?(connectedEmployees[_0x2ebc62]=connectedEmployees[_0x2ebc62][_0x24ced9(0x136)](_0x386299=>_0x386299[_0x24ced9(0x18c)]!==_0x1412ab['id']),connectedEmployees[_0x2ebc62][_0x24ced9(0x12b)]===0x0&&delete connectedEmployees[_0x2ebc62]):console[_0x24ced9(0x15b)](_0x24ced9(0x138)+_0x1412ab['id']+_0x24ced9(0x185));}),_0x1412ab['on'](_0x28905d(0x18d),_0x3cd12b=>{const _0x5a2866=_0x28905d;console[_0x5a2866(0x15b)](_0x5a2866(0x183),_0x3cd12b),_0x1412ab['broadcast'][_0x5a2866(0x115)](_0x5a2866(0x188),_0x3cd12b);}),_0x1412ab['on'](_0x28905d(0x171),_0x11ceaf=>{const _0x3d011f=_0x28905d;_0x1412ab[_0x3d011f(0x115)](_0x3d011f(0x15d),{'orderKitchen':orderKitchen});}),_0x1412ab['on'](_0x28905d(0x13d),_0x322b99=>{const _0x24f3bd=_0x28905d,_0x58d871=JSON[_0x24f3bd(0x12a)](_0x322b99);_0x58d871['id']=orderKitchen[_0x24f3bd(0x12b)]+0x1,orderKitchen[_0x24f3bd(0x131)](_0x58d871);});});const companyName=_0xff68d6(0x150);serverExpress['use'](require(_0xff68d6(0x199))),serverExpress['use'](require(_0xff68d6(0x129))),serverExpress['use'](companyName,require(_0xff68d6(0x110)));function _0x3be2(){const _0x1fd1d3=['statSync','forEach','public','connectionRejected','1959934nOBRDz','port','message','user','map','FudSession','company','1647675qyxHuU','utf8','create_new_chat','/links','connect-pg-simple','3306NfkgTk','privateMessage','Ups,\x20parece\x20que\x20ya\x20estás\x20conectado\x20en\x20otro\x20dispositivo.','.hbs','0.0.0.0','hex','join','data','getTheFirstTenNotifications','log','set','getAllTheOrders','use','http','json','desktop','canSend','📦\x20Base\x20de\x20datos\x20EDPLUS\x20creada','get_the_first_notification','edplus.sql','express-recaptcha','get_max_employee_of_this_company','get','1420lbzxKQ','urlencoded','disconnect','diskStorage','sendNotificationToUser','express-handlebars','success','endsWith','sendAllTheOrders','Pool','connection','📂\x20La\x20base\x20de\x20datos\x20EDPLUS\x20ya\x20existe,\x20no\x20se\x20creó\x20nuevamente.','./keys','Un\x20usuario\x20se\x20ha\x20conectado','connect-flash','userId','Mensaje\x20enviado\x20con\x20éxito','127.0.0.1','companyId','connect','readdirSync','\x0aENCRYPTION_KEY=','dev','\x27\x20no\x20existe\x20🤔','locals','❌\x20Error\x20ejecutando\x20SQL:','Nueva\x20notificación:','router/links','\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.','ENCRYPTION_KEY=','pack_branch','newNotification','some','privateNotifications','Mensaje\x20enviado\x20con\x20éxito.\x20👌','socketId','sendNotification','listen','engine','sendMessageToUser','this_email_exist','✅\x20SQL\x20ejecutado\x20correctamente','983480YsmXwt','SELECT\x201\x20FROM\x20pg_database\x20WHERE\x20datname\x20=\x20\x27edplus\x27','\x27.\x20Inténtalo\x20de\x20nuevo.\x20😳','./lib/passport','config','session','./router','✅\x20ENCRYPTION_KEY\x20generado\x20y\x20guardado\x20en\x20.env','Este\x20email\x20\x27','address','🔐\x20ENCRYPTION_KEY\x20ya\x20existe\x20en\x20.env','resolve','createServer','split','./router/links','writeFileSync','uuid','networkInterfaces','layouts','emit','4eGpEul','11494278WOPvMg','dotenv','2468690tUKdik','env','existsSync','6678152TfzqaH','crypto','main','views','extname','init','messageStatus','originalname','multer','express','./services/chat.js','error','./lib/editFrom','./router/authentication','parse','length','public/img/uploads','morgan','flash','PORT','theUserIsConnect','push','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27','registerUser','../.env','release','filter','pack_company','Socket\x20','./lib/addFrom','Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20límite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresía.','trim','randomBytes','saveANewOrder','image','postgres','query','express-session'];_0x3be2=function(){return _0x1fd1d3;};return _0x3be2();}const routesPath=path[_0xff68d6(0x158)](__dirname,_0xff68d6(0x184));fs[_0xff68d6(0x17d)](routesPath)[_0xff68d6(0x143)](_0x587fca=>{const _0x3a00f4=_0xff68d6,_0x252cd7=path[_0x3a00f4(0x158)](routesPath,_0x587fca);fs[_0x3a00f4(0x142)](_0x252cd7)['isFile']()&&_0x587fca[_0x3a00f4(0x170)]('.js')&&serverExpress['use'](companyName,require(_0x252cd7));}),serverExpress[_0xff68d6(0x15e)](require(_0xff68d6(0x139))),serverExpress[_0xff68d6(0x15e)](express['static'](path[_0xff68d6(0x158)](__dirname,_0xff68d6(0x144))));const os=require('os');function getLocalIP(){const _0x50028b=_0xff68d6,_0x1f5dc1=os[_0x50028b(0x113)]();for(let _0x4f7813 in _0x1f5dc1){for(let _0x4d5a4f=0x0;_0x4d5a4f<_0x1f5dc1[_0x4f7813][_0x50028b(0x12b)];_0x4d5a4f++){const _0x1fc8d6=_0x1f5dc1[_0x4f7813][_0x4d5a4f];if(_0x1fc8d6['family']==='IPv4'&&!_0x1fc8d6['internal'])return _0x1fc8d6[_0x50028b(0x10b)];}}return _0x50028b(0x17a);}serverExpress[_0xff68d6(0x18e)](serverExpress[_0xff68d6(0x168)](_0xff68d6(0x147)),_0xff68d6(0x156),()=>{const _0x2ac719=_0xff68d6;console[_0x2ac719(0x15b)]('Server\x20running\x20on\x20http://'+getLocalIP()+':'+serverExpress[_0x2ac719(0x168)](_0x2ac719(0x147)));});