const _0x329a66=_0x2fad;(function(_0x57c8ca,_0x484494){const _0x4f5ffd=_0x2fad,_0x20ec31=_0x57c8ca();while(!![]){try{const _0x2d03a0=parseInt(_0x4f5ffd(0x19a))/0x1+-parseInt(_0x4f5ffd(0x150))/0x2*(parseInt(_0x4f5ffd(0x165))/0x3)+-parseInt(_0x4f5ffd(0x1c7))/0x4+-parseInt(_0x4f5ffd(0x155))/0x5+parseInt(_0x4f5ffd(0x1b6))/0x6+-parseInt(_0x4f5ffd(0x18d))/0x7*(-parseInt(_0x4f5ffd(0x159))/0x8)+parseInt(_0x4f5ffd(0x191))/0x9;if(_0x2d03a0===_0x484494)break;else _0x20ec31['push'](_0x20ec31['shift']());}catch(_0x2b43cc){_0x20ec31['push'](_0x20ec31['shift']());}}}(_0x1331,0x404e3));const system=require(_0x329a66(0x16c)),express=require(_0x329a66(0x1d4)),morgan=require('morgan'),{engine}=require('express-handlebars'),multer=require(_0x329a66(0x174)),flash=require(_0x329a66(0x16b)),session=require('express-session'),passport=require(_0x329a66(0x1bf)),{database}=require('./keys'),{v4:uuid}=require(_0x329a66(0x18e)),path=require(_0x329a66(0x1aa)),{RecaptchaV2}=require(_0x329a66(0x151)),nodePersist=require('node-persist');nodePersist[_0x329a66(0x192)]({'dir':path['join'](__dirname,_0x329a66(0x152))});const serverExpress=express();require(_0x329a66(0x1d9)),require(_0x329a66(0x160)),serverExpress[_0x329a66(0x1c8)](_0x329a66(0x1c1),process[_0x329a66(0x16d)][_0x329a66(0x1bc)]||0xfa0),serverExpress['set'](_0x329a66(0x1c0),path[_0x329a66(0x1b2)](__dirname,_0x329a66(0x1c0))),serverExpress[_0x329a66(0x193)](_0x329a66(0x1a1),engine({'defaultLayout':_0x329a66(0x16a),'layoutsDir':path[_0x329a66(0x1b2)](serverExpress[_0x329a66(0x1a7)]('views'),_0x329a66(0x158)),'partialsDir':path[_0x329a66(0x1b2)](serverExpress['get'](_0x329a66(0x1c0)),_0x329a66(0x197)),'extname':'.hbs','helpers':require(_0x329a66(0x1a9))})),serverExpress[_0x329a66(0x1c8)]('view\x20engine',_0x329a66(0x1a1));const fs=require('fs'),crypto=require(_0x329a66(0x1d8)),envPath=path['resolve'](__dirname,_0x329a66(0x1a2));let envContent=fs[_0x329a66(0x1ad)](envPath)?fs['readFileSync'](envPath,_0x329a66(0x17a)):'';if(!envContent[_0x329a66(0x1ab)](_0x329a66(0x18c))){const newKey=crypto['randomBytes'](0x20)[_0x329a66(0x177)](_0x329a66(0x1b1));envContent+=_0x329a66(0x1cb)+newKey+'\x0a',fs[_0x329a66(0x1d3)](envPath,envContent),console[_0x329a66(0x16e)]('✅\x20ENCRYPTION_KEY\x20generado\x20y\x20guardado\x20en\x20.env');}else console['log']('🔐\x20ENCRYPTION_KEY\x20ya\x20existe\x20en\x20.env');require(_0x329a66(0x184))[_0x329a66(0x1d1)]();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT}=process['env'],pg=require('pg'),adminPool=new pg[(_0x329a66(0x1d6))]({'user':APP_PG_USER,'host':APP_PG_HOST,'password':APP_PG_PASSWORD,'port':APP_PG_PORT,'database':APP_PG_DATABASE}),importSQLFile=async _0x3fd627=>{const _0x2f2649=_0x329a66,_0x5ebe52=path[_0x2f2649(0x1b2)](__dirname,'database',_0x2f2649(0x1d0)),_0x3304f8=fs[_0x2f2649(0x1b7)](_0x5ebe52,_0x2f2649(0x17a)),_0x59f11a=_0x3304f8[_0x2f2649(0x195)](/;\s*$/m)[_0x2f2649(0x173)](_0x5324ad=>_0x5324ad[_0x2f2649(0x170)]())['filter'](_0x3d59cf=>_0x3d59cf[_0x2f2649(0x175)]>0x0),_0x119292=await _0x3fd627[_0x2f2649(0x15b)]();try{for(const _0x227a67 of _0x59f11a){await _0x119292[_0x2f2649(0x1bd)](_0x227a67);}console[_0x2f2649(0x16e)](_0x2f2649(0x1da));}catch(_0x1a6921){console[_0x2f2649(0x17d)](_0x2f2649(0x179),_0x1a6921['message']);}finally{_0x119292[_0x2f2649(0x17b)]();}},{create_update_of_the_database}=require('./characterDatabase'),createDatabase=async()=>{const _0x56fa2c=_0x329a66,_0x1b7fb6=await adminPool[_0x56fa2c(0x1bd)](_0x56fa2c(0x166));_0x1b7fb6[_0x56fa2c(0x171)]===0x0?(await adminPool[_0x56fa2c(0x1bd)](_0x56fa2c(0x19d)),importSQLFile(adminPool),console[_0x56fa2c(0x16e)]('📦\x20Base\x20de\x20datos\x20EDPLUS\x20creada')):(console[_0x56fa2c(0x16e)](_0x56fa2c(0x1b9)),await create_update_of_the_database(adminPool));};createDatabase();const pgPool=new pg[(_0x329a66(0x1d6))]({'user':APP_PG_USER,'host':APP_PG_HOST,'database':'postgres','password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress[_0x329a66(0x178)](session({'secret':_0x329a66(0x164),'resave':![],'saveUninitialized':![],'store':new(require(_0x329a66(0x14e))(session))({'pool':pgPool,'tableName':_0x329a66(0x1b8)})})),serverExpress['use'](flash()),serverExpress[_0x329a66(0x178)](morgan('dev')),serverExpress['use'](express[_0x329a66(0x186)]({'extended':![]})),serverExpress['use'](express[_0x329a66(0x17c)]()),serverExpress[_0x329a66(0x178)](passport[_0x329a66(0x1ae)]()),serverExpress['use'](passport[_0x329a66(0x1b8)]());const storageImages=multer['diskStorage']({'destination':path[_0x329a66(0x1b2)](__dirname,_0x329a66(0x19f)),'filename':(_0x216e54,_0x49a45b,_0x425663)=>{const _0x1896e1=_0x329a66;_0x425663(null,uuid()+path['extname'](_0x49a45b[_0x1896e1(0x17e)]));}});serverExpress[_0x329a66(0x178)](multer({'storage':storageImages})[_0x329a66(0x1d7)](_0x329a66(0x1cf))),serverExpress['use']((_0x5ac0b8,_0x23b884,_0x5619c6)=>{const _0xbc13e5=_0x329a66;serverExpress['locals'][_0xbc13e5(0x1b0)]=_0x5ac0b8['flash'](_0xbc13e5(0x1b0)),serverExpress['locals']['message']=_0x5ac0b8[_0xbc13e5(0x196)]('message'),serverExpress['locals'][_0xbc13e5(0x156)]=_0x5ac0b8[_0xbc13e5(0x156)],serverExpress[_0xbc13e5(0x1a3)][_0xbc13e5(0x167)]=_0x5ac0b8['company'],serverExpress['locals'][_0xbc13e5(0x1af)]=0x0,serverExpress[_0xbc13e5(0x1a3)][_0xbc13e5(0x157)]=0x0,_0x5619c6();});const http=require('http'),serverSocket=http[_0x329a66(0x162)](serverExpress),{Server}=require(_0x329a66(0x1a5)),io=new Server(serverSocket),users={},connectedEmployees={},companyLimitsCache={},orderKitchen={},chat=require(_0x329a66(0x1cc));serverSocket[_0x329a66(0x181)](serverExpress[_0x329a66(0x1a7)](_0x329a66(0x1c1)),()=>{const _0x1b24ce=_0x329a66;console['log'](_0x1b24ce(0x199)+serverExpress['get'](_0x1b24ce(0x1c1)));}),io['on']('connection',async _0x1e5998=>{const _0x4fd405=_0x329a66;console[_0x4fd405(0x16e)](_0x4fd405(0x18b)),_0x1e5998['on'](_0x4fd405(0x17f),async(_0x26da05,_0x4c4dd2)=>{const _0x46010d=_0x4fd405,_0x59bd0a=connectedEmployees[_0x4c4dd2]||[],_0x57c513=_0x59bd0a[_0x46010d(0x19b)](_0x760fe5=>_0x760fe5['userId']===_0x26da05);if(_0x57c513){_0x1e5998[_0x46010d(0x1c4)](_0x46010d(0x15f),_0x46010d(0x1a6));return;}if(system!='desktop'){!companyLimitsCache[_0x4c4dd2]&&(companyLimitsCache[_0x4c4dd2]=await chat[_0x46010d(0x1d5)](_0x4c4dd2));const _0x21b8ef=companyLimitsCache[_0x4c4dd2];if(_0x59bd0a[_0x46010d(0x175)]>=_0x21b8ef){_0x1e5998[_0x46010d(0x1c4)](_0x46010d(0x15f),_0x46010d(0x15d));return;}}_0x1e5998[_0x46010d(0x198)]=_0x4c4dd2,_0x59bd0a['push']({'userId':_0x26da05,'socketId':_0x1e5998['id']}),connectedEmployees[_0x4c4dd2]=_0x59bd0a;const _0x595154=await chat[_0x46010d(0x18a)](_0x26da05,0xa);io['to'](_0x26da05)[_0x46010d(0x1c4)](_0x46010d(0x153),{'notifications':_0x595154});});async function _0x154c1e(_0x2d50b2){const _0x1ec09d=users[_0x2d50b2];let _0x6b33e9=_0x1ec09d;!_0x1ec09d&&(_0x6b33e9=await chat['this_email_exist'](toUserId));const _0x473ed2={'canSend':_0x6b33e9,'theUserIsConnect':_0x1ec09d};return _0x473ed2;}_0x1e5998['on'](_0x4fd405(0x1b4),async({userEmail:_0x5e09ef,toUserEmail:_0x23c5b2,message:_0x4372d0})=>{const _0x3175f2=_0x4fd405,_0x195537=await _0x154c1e(_0x23c5b2);_0x195537[_0x3175f2(0x14f)]?await chat[_0x3175f2(0x1c9)](_0x5e09ef,_0x23c5b2,_0x4372d0)?(_0x195537[_0x3175f2(0x176)]&&io['to'](recipientSocketId)['emit']('privateMessage',{'userId':userId,'message':_0x4372d0}),_0x1e5998[_0x3175f2(0x1c4)](_0x3175f2(0x1bb),{'success':!![],'message':'Mensaje\x20enviado\x20con\x20éxito.\x20👌'})):_0x1e5998['emit'](_0x3175f2(0x1bb),{'success':![],'message':_0x3175f2(0x1ca)+_0x23c5b2+'\x27.\x20Inténtalo\x20de\x20nuevo.\x20😳'}):_0x1e5998[_0x3175f2(0x1c4)]('messageStatus',{'success':![],'message':_0x3175f2(0x1b3)+_0x23c5b2+_0x3175f2(0x183)});}),_0x1e5998['on'](_0x4fd405(0x1c6),async({userEmail:_0x269ed0})=>{const _0x2737df=_0x4fd405,_0x16bff9=await chat['get_the_first_notification'](_0x269ed0,0xa);io['to'](recipientSocketId)['emit'](_0x2737df(0x153),{'notifications':_0x16bff9});}),_0x1e5998['on']('sendMessageToUser',async({userId:_0x242bb9,toUserId:_0x14ae02,message:_0x31b7c0})=>{const _0x3662e2=_0x4fd405,_0x3dbda3=users[_0x14ae02];let _0x1ab729=_0x3dbda3;!_0x3dbda3&&(_0x1ab729=await chat[_0x3662e2(0x1cd)](_0x14ae02));if(_0x1ab729){const _0x500d92=await chat[_0x3662e2(0x187)](_0x242bb9,_0x14ae02);await chat[_0x3662e2(0x168)](_0x500d92,_0x242bb9,_0x31b7c0)&&(_0x3dbda3&&io['to'](_0x3dbda3)[_0x3662e2(0x1c4)](_0x3662e2(0x1c2),{'userId':_0x242bb9,'message':_0x31b7c0})),_0x1e5998[_0x3662e2(0x1c4)](_0x3662e2(0x1bb),{'success':!![],'message':_0x3662e2(0x1d2)});}else _0x1e5998[_0x3662e2(0x1c4)](_0x3662e2(0x1bb),{'success':![],'message':_0x3662e2(0x15c)+_0x14ae02+'\x27\x20no\x20existe\x20🤔'});}),_0x1e5998['on']('disconnect',()=>{const _0x4a0534=_0x4fd405,{companyId:_0x4103b3}=_0x1e5998;_0x4103b3&&connectedEmployees[_0x4103b3]?(connectedEmployees[_0x4103b3]=connectedEmployees[_0x4103b3][_0x4a0534(0x182)](_0x538f03=>_0x538f03['socketId']!==_0x1e5998['id']),connectedEmployees[_0x4103b3][_0x4a0534(0x175)]===0x0&&delete connectedEmployees[_0x4103b3]):console[_0x4a0534(0x16e)](_0x4a0534(0x194)+_0x1e5998['id']+_0x4a0534(0x19e));}),_0x1e5998['on'](_0x4fd405(0x1a4),_0x445ada=>{const _0x5c1771=_0x4fd405;console[_0x5c1771(0x16e)](_0x5c1771(0x1ba),_0x445ada),_0x1e5998[_0x5c1771(0x169)][_0x5c1771(0x1c4)](_0x5c1771(0x1a0),_0x445ada);}),_0x1e5998['on'](_0x4fd405(0x18f),_0x132c96=>{const _0x43be67=_0x4fd405;_0x1e5998[_0x43be67(0x1c4)](_0x43be67(0x185),{'orderKitchen':orderKitchen});}),_0x1e5998['on'](_0x4fd405(0x15e),_0x1e443f=>{const _0x313b75=_0x4fd405,_0x256f87=JSON[_0x313b75(0x189)](_0x1e443f);_0x256f87['id']=orderKitchen[_0x313b75(0x175)]+0x1,orderKitchen[_0x313b75(0x1ce)](_0x256f87);});});const companyName=_0x329a66(0x19c);serverExpress[_0x329a66(0x178)](require('./router')),serverExpress['use'](require('./router/authentication')),serverExpress[_0x329a66(0x178)](companyName,require(_0x329a66(0x1be)));const routesPath=path[_0x329a66(0x1b2)](__dirname,_0x329a66(0x1c5));function _0x2fad(_0x569d0a,_0x4c5183){const _0x13313a=_0x1331();return _0x2fad=function(_0x2fadd7,_0x23e2b8){_0x2fadd7=_0x2fadd7-0x14d;let _0x2104c0=_0x13313a[_0x2fadd7];return _0x2104c0;},_0x2fad(_0x569d0a,_0x4c5183);}fs[_0x329a66(0x161)](routesPath)[_0x329a66(0x190)](_0x597019=>{const _0xe97240=_0x329a66,_0x54ecad=path[_0xe97240(0x1b2)](routesPath,_0x597019);fs[_0xe97240(0x14d)](_0x54ecad)[_0xe97240(0x1ac)]()&&_0x597019['endsWith'](_0xe97240(0x15a))&&serverExpress[_0xe97240(0x178)](companyName,require(_0x54ecad));}),serverExpress['use'](require(_0x329a66(0x1a8))),serverExpress[_0x329a66(0x178)](express[_0x329a66(0x1c3)](path[_0x329a66(0x1b2)](__dirname,_0x329a66(0x172))));const os=require('os');function getLocalIP(){const _0x53ee11=_0x329a66,_0xf56a2c=os[_0x53ee11(0x1b5)]();for(let _0x13bddf in _0xf56a2c){for(let _0x55203b=0x0;_0x55203b<_0xf56a2c[_0x13bddf][_0x53ee11(0x175)];_0x55203b++){const _0x39b316=_0xf56a2c[_0x13bddf][_0x55203b];if(_0x39b316[_0x53ee11(0x163)]===_0x53ee11(0x16f)&&!_0x39b316['internal'])return _0x39b316[_0x53ee11(0x188)];}}return _0x53ee11(0x154);}serverExpress[_0x329a66(0x181)](serverExpress[_0x329a66(0x1a7)](_0x329a66(0x1c1)),_0x329a66(0x180),()=>{const _0x1b88f8=_0x329a66;console[_0x1b88f8(0x16e)]('Server\x20running\x20on\x20http://'+getLocalIP()+':'+serverExpress[_0x1b88f8(0x1a7)]('port'));});function _0x1331(){const _0x2480b9=['saveANewOrder','connectionRejected','./lib/editFrom','readdirSync','createServer','family','FudSession','30513WAAtKp','SELECT\x201\x20FROM\x20pg_database\x20WHERE\x20datname\x20=\x20\x27edplus\x27','company','send_new_message','broadcast','main','connect-flash','./lib/system','env','log','IPv4','trim','rowCount','public','map','multer','length','theUserIsConnect','toString','use','❌\x20Error\x20ejecutando\x20SQL:','utf8','release','json','error','originalname','registerUser','0.0.0.0','listen','filter','\x27\x20no\x20existe.\x20🤔','dotenv','getAllTheOrders','urlencoded','create_new_chat','address','parse','get_the_first_notification','Un\x20usuario\x20se\x20ha\x20conectado','ENCRYPTION_KEY=','9275ztqCgv','uuid','sendAllTheOrders','forEach','6410889QfVlut','init','engine','Socket\x20','split','flash','partials','companyId','Server\x20running\x20on\x20port\x20','416344yMJjHm','some','/links','CREATE\x20DATABASE\x20edplus','\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.','public/img/uploads','newNotification','.hbs','../.env','locals','sendNotification','socket.io','Ups,\x20parece\x20que\x20ya\x20estás\x20conectado\x20en\x20otro\x20dispositivo.','get','./lib/addFrom','./lib/handlebars','path','includes','isFile','existsSync','initialize','pack_company','success','hex','join','El\x20usuario\x20\x27','sendNotificationToUser','networkInterfaces','523200rTANzm','readFileSync','session','📂\x20La\x20base\x20de\x20datos\x20EDPLUS\x20ya\x20existe,\x20no\x20se\x20creó\x20nuevamente.','Nueva\x20notificación:','messageStatus','PORT','query','./router/links','passport','views','port','privateMessage','static','emit','router/links','getTheFirstTenNotifications','1155448iAmknb','set','create_notification','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27','\x0aENCRYPTION_KEY=','./services/chat.js','this_email_exist','push','image','edplus.sql','config','Mensaje\x20enviado\x20con\x20éxito','writeFileSync','express','get_max_employee_of_this_company','Pool','single','crypto','./lib/passport','✅\x20SQL\x20ejecutado\x20correctamente','statSync','connect-pg-simple','canSend','54DrwNvm','express-recaptcha','data','privateNotifications','127.0.0.1','1958205UviKbd','user','pack_branch','layouts','16yqoANH','.js','connect','Este\x20email\x20\x27','Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20límite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membresía.'];_0x1331=function(){return _0x2480b9;};return _0x1331();}