const _0x5c0a2a=_0xe83f;(function(_0x795467,_0x1bbd31){const _0x2db697=_0xe83f,_0x47ef02=_0x795467();while(!![]){try{const _0x3d37fc=-parseInt(_0x2db697(0x197))/0x1+-parseInt(_0x2db697(0xfe))/0x2+-parseInt(_0x2db697(0xef))/0x3+parseInt(_0x2db697(0x105))/0x4*(-parseInt(_0x2db697(0xfc))/0x5)+parseInt(_0x2db697(0x102))/0x6*(parseInt(_0x2db697(0xe3))/0x7)+-parseInt(_0x2db697(0x1a4))/0x8+parseInt(_0x2db697(0x163))/0x9*(parseInt(_0x2db697(0x143))/0xa);if(_0x3d37fc===_0x1bbd31)break;else _0x47ef02['push'](_0x47ef02['shift']());}catch(_0x3c7ed9){_0x47ef02['push'](_0x47ef02['shift']());}}}(_0x1466,0x93a5b));const system=require(_0x5c0a2a(0x191)),thiIsADemo=![],{app,BrowserWindow,dialog,ipcMain}=require(_0x5c0a2a(0x146)),express=require(_0x5c0a2a(0x132)),morgan=require('morgan'),{engine}=require(_0x5c0a2a(0xe1)),multer=require(_0x5c0a2a(0x19f)),flash=require(_0x5c0a2a(0x162)),session=require('express-session'),passport=require(_0x5c0a2a(0x181)),{database}=require('./keys'),{v4:uuid}=require(_0x5c0a2a(0x14b)),path=require('path'),{RecaptchaV2}=require(_0x5c0a2a(0x12a)),nodePersist=require(_0x5c0a2a(0x179));nodePersist[_0x5c0a2a(0x124)]({'dir':path[_0x5c0a2a(0x175)](__dirname,_0x5c0a2a(0x15d))});async function initialize_software(){const _0x411228=_0x5c0a2a,_0x5a840b=await nodePersist[_0x411228(0x176)](_0x411228(0x154));!_0x5a840b&&await nodePersist[_0x411228(0x1ab)](_0x411228(0x154),_0x411228(0x1a6));}async function the_software_have_a_token(){const _0x3f5c67=_0x5c0a2a,_0xd538f1=await nodePersist[_0x3f5c67(0x176)](_0x3f5c67(0x154));if(!_0xd538f1)return![];return _0xd538f1!='false';}async function create_expiration_date_of_the_token(_0xa1a039){const _0x5f5049=_0x5c0a2a,_0x48dfc4=await nodePersist[_0x5f5049(0x176)](_0x5f5049(0x1a0));!_0x48dfc4&&await nodePersist[_0x5f5049(0x1ab)]('expirationDateOFTheToken',_0xa1a039);}async function token_expired(){const _0xc9c528=await nodePersist['get']('expirationDateOFTheToken'),_0x21b1ea=new Date(_0xc9c528),_0x5c4e45=new Date();return _0x5c4e45<_0x21b1ea;}async function remove_install_token(){const _0x25dba5=_0x5c0a2a;await nodePersist['removeItem'](_0x25dba5(0x154)),await nodePersist[_0x25dba5(0x184)](_0x25dba5(0x1a0)),console[_0x25dba5(0xe6)](_0x25dba5(0x159));}async function initialize_token(_0x1ad5a2){const _0xc01d82=_0x5c0a2a,_0x1127f6=await nodePersist['get']('installToken');await nodePersist[_0xc01d82(0x1ab)](_0xc01d82(0x154),_0x1ad5a2);}async function initialize_demo(){const _0x4d1989=_0x5c0a2a,_0xd26352=await nodePersist[_0x4d1989(0x176)]('installDemo');if(!_0xd26352){const _0x510eb8=new Date()[_0x4d1989(0x187)]();await nodePersist[_0x4d1989(0x1ab)](_0x4d1989(0x1a2),_0x510eb8),console[_0x4d1989(0xe6)](_0x4d1989(0xf1),_0x510eb8);}else console[_0x4d1989(0xe6)](_0x4d1989(0x129),_0xd26352);}async function is_demo_expired(){const _0x216571=_0x5c0a2a,_0x316e8a=await nodePersist[_0x216571(0x176)]('installDemo');if(!_0x316e8a)return console['log'](_0x216571(0x144)),![];const _0x1d4747=new Date(_0x316e8a),_0x9aaff6=new Date(),_0x5f5788=_0x9aaff6-_0x1d4747,_0x437ccc=_0x5f5788/(0x3e8*0x3c*0x3c*0x18);return _0x437ccc>0x1e?(console[_0x216571(0xe6)](_0x216571(0x172)),!![]):(console['log'](_0x216571(0x141)),![]);}async function this_software_count_have_a_count(){}async function the_user_have_a_token_active_in_the_database(){}function _0x1466(){const _0x3dcd34=['message','release','connect-pg-simple','get_max_employee_of_this_company','password','La\x20demo\x20ha\x20expirado.','get_information_of_the_user.php','pack_branch','join','get','post','origin','node-persist','see_if_exist_this_token_in_the_database_of_the_web.php','dataToken','image','send_new_message','darwin','activation.html','Suscripci贸n\x20expirada.\x20Por\x20favor,\x20vuelve\x20a\x20activar\x20tu\x20membres铆a.','passport','edplus.sql','\x20Base\x20de\x20datos\x20EDPLUS\x20creada','removeItem','El\x20token\x20no\x20est谩\x20activo\x20o\x20no\x20existe.','locals','toISOString','simple-git','appendFileSync','0.0.0.0','Ocurrio\x20un\x20error\x20al\x20verificar\x20tu\x20Token\x20en\x20el\x20ultimo\x20paso,\x20intentalo\x20otra\x20vez.','./router/authentication','Nueva\x20notificaci贸n:','sendMessageToUser','Pool','query','./lib/system','views','session','length','window-all-closed','stack','155526DSeePC','some','.hbs','ready','setFullYear','internal','login-from-render-token','bcrypt','multer','expirationDateOFTheToken','Demo\x20Expirada','installDate','use','3721864iNNjaU','./lib/addFrom','false','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20*\x20FROM\x20pagos\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20token\x20=\x20?\x0a\x20\x20\x20\x20','maximize','\x20Petici贸n\x20recibida\x20para\x20obtener\x20el\x20deviceId','hash','set','company','logfile.txt','Contrase帽a\x20incorrecta.','networkInterfaces','catch','platform','endsWith','public','create_new_chat','privateMessage','express-handlebars','sendNotificationToUser','16387MPpMqI','\x20SQL\x20ejecutado\x20correctamente','statSync','log','axios','compare','./lib/handlebars','\x20La\x20aplicaci贸n\x20ya\x20est谩\x20actualizada.','address','trim','messageStatus','\x27.\x20Int茅ntalo\x20de\x20nuevo.\x20','698913thqigM','readFileSync','Fecha\x20de\x20instalaci贸n\x20guardada:','main','companyId','node-machine-id','token','Ups,\x20parece\x20que\x20alcanzaste\x20tu\x20l铆mite\x20de\x20dispositivos\x20conectados.\x20Por\x20favor,\x20actualiza\x20tu\x20membres铆a.','dotenv','Error\x20verificando\x20actualizaciones:\x20','\x20La\x20base\x20de\x20datos\x20EDPLUS\x20ya\x20existe,\x20no\x20se\x20cre贸\x20nuevamente.','setDate','loadFile','147880BBKrfv','port','1475312DMbICc','Este\x20usuario\x20ya\x20tiene\x20un\x20TOKEN\x20registrado\x20en\x20un\x20equipo.','\x27\x20no\x20existe\x20','\x27\x20no\x20existe.\x20','942PxCFnr','engine','error','52fwTjBu','json','this_email_exist','Reiniciar\x20ahora','https://github.com/EduardoMartinez68/VERSIONES_PLUS','push','getDate','/links','success','listen','extname','\x20Error\x20verificando\x20actualizaciones:','/main','newNotification','http://localhost:','https://www.pluspuntodeventa.com/api/','partials','Datos\x20actualizados\x20con\x20茅xito.\x20Cierra\x20y\x20vuelve\x20a\x20abrir\x20el\x20programa\x20','relaunch','\x0a\x20\x20\x20\x20\x20\x20\x20\x20--\x20Crear\x20tabla\x20solo\x20si\x20no\x20existe\x0a\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20\x22Box\x22.reachange_services\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20bigserial\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id_companies\x20bigint,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id_branches\x20bigint,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id_employees\x20bigint,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id_customers\x20bigint,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20service_name\x20varchar(500)\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20key_services\x20text,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20service_money\x20double\x20precision\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20money_received\x20double\x20precision\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20change\x20double\x20precision\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CONSTRAINT\x20id_key_reachange_services\x20PRIMARY\x20KEY\x20(id)\x0a\x20\x20\x20\x20\x20\x20\x20\x20);\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20--\x20Comentarios\x20descriptivos\x0a\x20\x20\x20\x20\x20\x20\x20\x20COMMENT\x20ON\x20COLUMN\x20\x22Box\x22.reachange_services.key_services\x20IS\x20\x27this\x20is\x20the\x20key\x20that\x20the\x20customer\x20show\x20to\x20the\x20employee\x20for\x20buy\x20his\x20service\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20COMMENT\x20ON\x20COLUMN\x20\x22Box\x22.reachange_services.service_money\x20IS\x20\x27this\x20is\x20the\x20money\x20that\x20the\x20customer\x20would\x20like\x20buy\x27;\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20--\x20Agregar\x20claves\x20for谩neas\x20(si\x20no\x20existen\x20ya)\x0a\x20\x20\x20\x20\x20\x20\x20\x20DO\x20$$\x0a\x20\x20\x20\x20\x20\x20\x20\x20BEGIN\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20IF\x20NOT\x20EXISTS\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x201\x20FROM\x20pg_constraint\x20WHERE\x20conname\x20=\x20\x27employees_fk\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x20THEN\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ALTER\x20TABLE\x20\x22Box\x22.reachange_services\x20ADD\x20CONSTRAINT\x20employees_fk\x20FOREIGN\x20KEY\x20(id_employees)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20REFERENCES\x20\x22Company\x22.employees\x20(id)\x20MATCH\x20FULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20DELETE\x20SET\x20NULL\x20ON\x20UPDATE\x20CASCADE;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20END\x20IF;\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20IF\x20NOT\x20EXISTS\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x201\x20FROM\x20pg_constraint\x20WHERE\x20conname\x20=\x20\x27customers_fk\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x20THEN\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ALTER\x20TABLE\x20\x22Box\x22.reachange_services\x20ADD\x20CONSTRAINT\x20customers_fk\x20FOREIGN\x20KEY\x20(id_customers)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20REFERENCES\x20\x22Company\x22.customers\x20(id)\x20MATCH\x20FULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20DELETE\x20SET\x20NULL\x20ON\x20UPDATE\x20CASCADE;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20END\x20IF;\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20IF\x20NOT\x20EXISTS\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x201\x20FROM\x20pg_constraint\x20WHERE\x20conname\x20=\x20\x27companies_fk\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x20THEN\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ALTER\x20TABLE\x20\x22Box\x22.reachange_services\x20ADD\x20CONSTRAINT\x20companies_fk\x20FOREIGN\x20KEY\x20(id_companies)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20REFERENCES\x20\x22User\x22.companies\x20(id)\x20MATCH\x20FULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20DELETE\x20SET\x20NULL\x20ON\x20UPDATE\x20CASCADE;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20END\x20IF;\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20IF\x20NOT\x20EXISTS\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x201\x20FROM\x20pg_constraint\x20WHERE\x20conname\x20=\x20\x27branches_fk\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x20THEN\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ALTER\x20TABLE\x20\x22Box\x22.reachange_services\x20ADD\x20CONSTRAINT\x20branches_fk\x20FOREIGN\x20KEY\x20(id_branches)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20REFERENCES\x20\x22Company\x22.branches\x20(id)\x20MATCH\x20FULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20DELETE\x20SET\x20NULL\x20ON\x20UPDATE\x20CASCADE;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20END\x20IF;\x0a\x20\x20\x20\x20\x20\x20\x20\x20END\x0a\x20\x20\x20\x20\x20\x20\x20\x20$$;\x0a\x0a\x20\x20\x20\x20','create_notification','device_id','public/img/uploads','Mensaje\x20enviado\x20con\x20茅xito','HEAD','Tu\x20demo\x20de\x2030\x20d铆as\x20ha\x20expirado.\x20Por\x20favor,\x20compra\x20la\x20versi贸n\x20completa\x20y\x20sigue\x20creciendo\x20con\x20ED\x20PLUS\x20.','isFile','flash','env','fetch','Usuario\x20autenticado\x20con\x20茅xito.','init','0000-00-00','type_membresy','IPv4','raw','Fecha\x20de\x20instalaci贸n\x20existente:','express-recaptcha','socketId','PORT','No\x20pudimos\x20enviar\x20el\x20mensaje\x20al\x20usuario\x20\x27','connect','database','quit','latest','express','ENTRE','.js','dev','pull','getFullYear','Repositorio\x20remoto\x20configurado\x20correctamente','layouts','initialize','./lib/passport','broadcast','get_data_of_the_token_with_the_user_id.php','createServer','preload.js','activation_date','La\x20demo\x20a煤n\x20est谩\x20activa.','view\x20engine','2213100FhfFun','No\x20se\x20encontr贸\x20la\x20fecha\x20de\x20instalaci贸n','user','electron','desktop','Socket\x20','rowCount','static','uuid','urlencoded','Hubo\x20un\x20error\x20al\x20hacer\x20la\x20solicitud.','Ups,\x20parece\x20que\x20ya\x20est谩s\x20conectado\x20en\x20otro\x20dispositivo.','privateNotifications','family','addRemote','warning','readdirSync','installToken','forEach','FudSession','split','Error\x20al\x20verificar\x20el\x20token:','installToken\x20eliminado','showMessageBoxSync','getTheFirstTenNotifications','router/links','data','utf8','reply','Este\x20email\x20\x27','diskStorage','connect-flash','90wuQCLc','emit','get_my_deviceId','filter','update_activation_date.php','connectionRejected','\x20Error\x20ejecutando\x20SQL:','sendNotification','update_data_of_the_token_in_this_drive','get_the_first_notification'];_0x1466=function(){return _0x3dcd34;};return _0x1466();}async function verify_membership_of_user(){initialize_software();if(await the_software_have_a_token())return await token_expired();return![];}const simpleGit=require(_0x5c0a2a(0x188)),fs=require('fs'),repoPath=path[_0x5c0a2a(0x175)](__dirname),git=simpleGit(repoPath),repoURL=_0x5c0a2a(0x109),remote=_0x5c0a2a(0x178);git[_0x5c0a2a(0x151)](remote,repoURL)['then'](()=>{const _0x5c3508=_0x5c0a2a;console[_0x5c3508(0xe6)](_0x5c3508(0x138));})[_0x5c0a2a(0xdb)](_0x4bd552=>{const _0x362a40=_0x5c0a2a;console[_0x362a40(0x104)]('Error\x20al\x20agregar\x20el\x20repositorio\x20remoto',_0x4bd552);});async function check_if_exist_updates(){const _0x360663=_0x5c0a2a;try{await git[_0x360663(0x122)](remote);const _0x205fca=await git[_0x360663(0xe6)]([remote+'/main','-1']),_0x39d345=await git[_0x360663(0xe6)]([_0x360663(0x11d),'-1']);_0x205fca['latest'][_0x360663(0x1aa)]!==_0x39d345[_0x360663(0x131)][_0x360663(0x1aa)]?(console[_0x360663(0xe6)]('\x20Nueva\x20versi贸n\x20encontrada,\x20actualizando...'),await git[_0x360663(0x128)](['reset','--hard',remote+_0x360663(0x111)]),await git[_0x360663(0x136)]('origin',_0x360663(0xf2),{'--rebase':null}),dialog[_0x360663(0x15a)]({'type':'info','title':'Actualizaci贸n','message':'Se\x20ha\x20descargado\x20una\x20nueva\x20versi贸n.\x20Reinicia\x20la\x20aplicaci贸n\x20para\x20aplicar\x20los\x20cambios.','buttons':[_0x360663(0x108)]}),app[_0x360663(0x117)](),app[_0x360663(0x130)]()):console[_0x360663(0xe6)](_0x360663(0xea));}catch(_0x78b9a3){const _0x2cc1c6=path['join'](__dirname,_0x360663(0xd8));fs['appendFileSync'](_0x2cc1c6,_0x360663(0xf8)+_0x78b9a3[_0x360663(0x16d)]+'\x0a'+_0x78b9a3[_0x360663(0x196)]+'\x0a\x0a',_0x360663(0x15e)),console[_0x360663(0x104)](_0x360663(0x110),_0x78b9a3),dialog[_0x360663(0x15a)]({'type':'warning','title':'Error\x20verificando\x20actualizaciones!','message':_0x360663(0xf8)+_0x78b9a3[_0x360663(0x16d)]+'\x0a'+_0x78b9a3[_0x360663(0x196)]+'\x0a\x0a'});}}const serverExpress=express();require(_0x5c0a2a(0x13b)),require('./lib/editFrom'),serverExpress[_0x5c0a2a(0x1ab)](_0x5c0a2a(0xfd),process[_0x5c0a2a(0x121)][_0x5c0a2a(0x12c)]||0xfa0),serverExpress[_0x5c0a2a(0x1ab)](_0x5c0a2a(0x192),path[_0x5c0a2a(0x175)](__dirname,_0x5c0a2a(0x192))),serverExpress[_0x5c0a2a(0x103)](_0x5c0a2a(0x199),engine({'defaultLayout':_0x5c0a2a(0xf2),'layoutsDir':path[_0x5c0a2a(0x175)](serverExpress[_0x5c0a2a(0x176)](_0x5c0a2a(0x192)),_0x5c0a2a(0x139)),'partialsDir':path[_0x5c0a2a(0x175)](serverExpress['get']('views'),_0x5c0a2a(0x115)),'extname':_0x5c0a2a(0x199),'helpers':require(_0x5c0a2a(0xe9))})),serverExpress[_0x5c0a2a(0x1ab)](_0x5c0a2a(0x142),_0x5c0a2a(0x199)),require(_0x5c0a2a(0xf7))['config']();const {APP_PG_USER,APP_PG_HOST,APP_PG_DATABASE,APP_PG_PASSWORD,APP_PG_PORT,TOKEN}=process['env'],pg=require('pg'),adminPool=new pg[(_0x5c0a2a(0x18f))]({'user':APP_PG_USER,'host':APP_PG_HOST,'password':APP_PG_PASSWORD,'port':APP_PG_PORT,'database':'postgres'}),importSQLFile=async _0x54a077=>{const _0x34b64c=_0x5c0a2a,_0x1e031e=path[_0x34b64c(0x175)](__dirname,_0x34b64c(0x12f),_0x34b64c(0x182)),_0x3e3194=fs[_0x34b64c(0xf0)](_0x1e031e,_0x34b64c(0x15e)),_0x19e69d=_0x3e3194[_0x34b64c(0x157)](/;\s*$/m)['map'](_0x441fd7=>_0x441fd7[_0x34b64c(0xec)]())[_0x34b64c(0x166)](_0x25c7dc=>_0x25c7dc['length']>0x0),_0x11b24e=await _0x54a077[_0x34b64c(0x12e)]();try{for(const _0x2dd8a4 of _0x19e69d){await _0x11b24e[_0x34b64c(0x190)](_0x2dd8a4);}console[_0x34b64c(0xe6)](_0x34b64c(0xe4));}catch(_0x3b7fe6){console['error'](_0x34b64c(0x169),_0x3b7fe6[_0x34b64c(0x16d)]);}finally{_0x11b24e[_0x34b64c(0x16e)]();}};async function create_update_of_the_database(){const _0x23dcc3=_0x5c0a2a;var _0x25879a=_0x23dcc3(0x118);await adminPool[_0x23dcc3(0x190)](_0x25879a),console[_0x23dcc3(0xe6)]('\x20La\x20base\x20de\x20datos\x20EDPLUS\x20fue\x20actualizada.');}const createDatabase=async()=>{const _0x46e09b=_0x5c0a2a,_0x156233=await adminPool[_0x46e09b(0x190)]('SELECT\x201\x20FROM\x20pg_database\x20WHERE\x20datname\x20=\x20\x27edplus\x27');_0x156233[_0x46e09b(0x149)]===0x0?(await adminPool['query']('CREATE\x20DATABASE\x20edplus'),importSQLFile(adminPool),console[_0x46e09b(0xe6)](_0x46e09b(0x183))):(console[_0x46e09b(0xe6)](_0x46e09b(0xf9)),await create_update_of_the_database());};createDatabase();const pgPool=new pg['Pool']({'user':APP_PG_USER,'host':APP_PG_HOST,'database':APP_PG_DATABASE,'password':APP_PG_PASSWORD,'port':APP_PG_PORT});serverExpress['use'](session({'secret':_0x5c0a2a(0x156),'resave':![],'saveUninitialized':![],'store':new(require(_0x5c0a2a(0x16f))(session))({'pool':pgPool,'tableName':_0x5c0a2a(0x193)})})),serverExpress[_0x5c0a2a(0x1a3)](flash()),serverExpress[_0x5c0a2a(0x1a3)](morgan(_0x5c0a2a(0x135))),serverExpress[_0x5c0a2a(0x1a3)](express[_0x5c0a2a(0x14c)]({'extended':![]})),serverExpress[_0x5c0a2a(0x1a3)](express[_0x5c0a2a(0x106)]()),serverExpress[_0x5c0a2a(0x1a3)](passport[_0x5c0a2a(0x13a)]()),serverExpress[_0x5c0a2a(0x1a3)](passport['session']());const storage=multer[_0x5c0a2a(0x161)]({'destination':path[_0x5c0a2a(0x175)](__dirname,_0x5c0a2a(0x11b)),'filename':(_0x586c36,_0x160a4c,_0x1c198c,_0x1bac56)=>{const _0x4994d6=_0x5c0a2a;_0x1c198c(null,uuid()+path[_0x4994d6(0x10f)](_0x160a4c['originalname']));}});serverExpress['use'](multer({'storage':storage})['single'](_0x5c0a2a(0x17c))),serverExpress[_0x5c0a2a(0x1a3)]((_0x118f6b,_0x3a34b6,_0x2e7a63)=>{const _0x422879=_0x5c0a2a;serverExpress[_0x422879(0x186)][_0x422879(0x10d)]=_0x118f6b['flash']('success'),serverExpress[_0x422879(0x186)][_0x422879(0x16d)]=_0x118f6b[_0x422879(0x120)]('message'),serverExpress[_0x422879(0x186)][_0x422879(0x145)]=_0x118f6b['user'],serverExpress[_0x422879(0x186)][_0x422879(0xd7)]=_0x118f6b[_0x422879(0xd7)],serverExpress[_0x422879(0x186)]['pack_company']=0x0,serverExpress[_0x422879(0x186)][_0x422879(0x174)]=0x0,_0x2e7a63();});const http=require('http'),server=http[_0x5c0a2a(0x13e)](serverExpress),{Server}=require('socket.io'),io=new Server(server),users={},connectedEmployees={},companyLimitsCache={},chat=require('./services/chat.js');io['on']('connection',async _0x3ddf6b=>{const _0x3b4010=_0x5c0a2a;_0x3ddf6b['on']('registerUser',async(_0x5a9646,_0x579135)=>{const _0x12f540=_0xe83f,_0x54c550=connectedEmployees[_0x579135]||[],_0x47cc8e=_0x54c550[_0x12f540(0x198)](_0x3ba155=>_0x3ba155['userId']===_0x5a9646);if(_0x47cc8e){_0x3ddf6b[_0x12f540(0x164)](_0x12f540(0x168),_0x12f540(0x14e));return;}if(system!=_0x12f540(0x147)){!companyLimitsCache[_0x579135]&&(companyLimitsCache[_0x579135]=await chat[_0x12f540(0x170)](_0x579135));const _0x510a4c=companyLimitsCache[_0x579135];if(_0x54c550[_0x12f540(0x194)]>=_0x510a4c){_0x3ddf6b[_0x12f540(0x164)](_0x12f540(0x168),_0x12f540(0xf6));return;}}_0x3ddf6b[_0x12f540(0xf3)]=_0x579135,_0x54c550[_0x12f540(0x10a)]({'userId':_0x5a9646,'socketId':_0x3ddf6b['id']}),connectedEmployees[_0x579135]=_0x54c550;const _0x220266=await chat[_0x12f540(0x16c)](_0x5a9646,0xa);io['to'](_0x5a9646)[_0x12f540(0x164)](_0x12f540(0x14f),{'notifications':_0x220266});});async function _0x567a92(_0x289203){const _0x4d26df=_0xe83f,_0x11f872=users[_0x289203];let _0x11220d=_0x11f872;!_0x11f872&&(_0x11220d=await chat[_0x4d26df(0x107)](toUserId));const _0x8cc199={'canSend':_0x11220d,'theUserIsConnect':_0x11f872};return _0x8cc199;}_0x3ddf6b['on'](_0x3b4010(0xe2),async({userEmail:_0x4d6167,toUserEmail:_0x50a6b4,message:_0x3a71ab})=>{const _0x16d39b=_0x3b4010,_0x4da54e=await _0x567a92(_0x50a6b4);_0x4da54e['canSend']?await chat[_0x16d39b(0x119)](_0x4d6167,_0x50a6b4,_0x3a71ab)?(_0x4da54e['theUserIsConnect']&&io['to'](recipientSocketId)[_0x16d39b(0x164)]('privateMessage',{'userId':userId,'message':_0x3a71ab}),_0x3ddf6b[_0x16d39b(0x164)](_0x16d39b(0xed),{'success':!![],'message':'Mensaje\x20enviado\x20con\x20茅xito.\x20'})):_0x3ddf6b[_0x16d39b(0x164)](_0x16d39b(0xed),{'success':![],'message':_0x16d39b(0x12d)+_0x50a6b4+_0x16d39b(0xee)}):_0x3ddf6b[_0x16d39b(0x164)]('messageStatus',{'success':![],'message':'El\x20usuario\x20\x27'+_0x50a6b4+_0x16d39b(0x101)});}),_0x3ddf6b['on'](_0x3b4010(0x15b),async({userEmail:_0x20e5ad})=>{const _0x503efb=_0x3b4010,_0x49d198=await chat[_0x503efb(0x16c)](_0x20e5ad,0xa);io['to'](recipientSocketId)[_0x503efb(0x164)](_0x503efb(0x14f),{'notifications':_0x49d198});}),_0x3ddf6b['on'](_0x3b4010(0x18e),async({userId:_0x4cefab,toUserId:_0x59bdc4,message:_0x209b33})=>{const _0x2249dc=_0x3b4010,_0x58920f=users[_0x59bdc4];let _0x47559b=_0x58920f;!_0x58920f&&(_0x47559b=await chat['this_email_exist'](_0x59bdc4));if(_0x47559b){const _0x793e3f=await chat[_0x2249dc(0xdf)](_0x4cefab,_0x59bdc4);await chat[_0x2249dc(0x17d)](_0x793e3f,_0x4cefab,_0x209b33)&&(_0x58920f&&io['to'](_0x58920f)[_0x2249dc(0x164)](_0x2249dc(0xe0),{'userId':_0x4cefab,'message':_0x209b33})),_0x3ddf6b[_0x2249dc(0x164)]('messageStatus',{'success':!![],'message':_0x2249dc(0x11c)});}else _0x3ddf6b[_0x2249dc(0x164)](_0x2249dc(0xed),{'success':![],'message':_0x2249dc(0x160)+_0x59bdc4+_0x2249dc(0x100)});}),_0x3ddf6b['on']('disconnect',()=>{const _0x47d0bc=_0x3b4010,{companyId:_0x5d1adb}=_0x3ddf6b;_0x5d1adb&&connectedEmployees[_0x5d1adb]?(connectedEmployees[_0x5d1adb]=connectedEmployees[_0x5d1adb][_0x47d0bc(0x166)](_0x11f385=>_0x11f385[_0x47d0bc(0x12b)]!==_0x3ddf6b['id']),connectedEmployees[_0x5d1adb][_0x47d0bc(0x194)]===0x0&&delete connectedEmployees[_0x5d1adb]):console['log'](_0x47d0bc(0x148)+_0x3ddf6b['id']+'\x20desconectado,\x20pero\x20no\x20estaba\x20asociado\x20a\x20ninguna\x20empresa.');}),_0x3ddf6b['on'](_0x3b4010(0x16a),_0x25e3ee=>{const _0x5b0acb=_0x3b4010;console['log'](_0x5b0acb(0x18d),_0x25e3ee),_0x3ddf6b[_0x5b0acb(0x13c)][_0x5b0acb(0x164)](_0x5b0acb(0x112),_0x25e3ee);});});const companyName=_0x5c0a2a(0x10c);serverExpress['use'](require('./router')),serverExpress[_0x5c0a2a(0x1a3)](require(_0x5c0a2a(0x18c))),serverExpress[_0x5c0a2a(0x1a3)](companyName,require('./router/links'));const routesPath=path[_0x5c0a2a(0x175)](__dirname,_0x5c0a2a(0x15c));fs[_0x5c0a2a(0x153)](routesPath)[_0x5c0a2a(0x155)](_0x2dad43=>{const _0x4bbc3c=_0x5c0a2a,_0x39c246=path['join'](routesPath,_0x2dad43);fs[_0x4bbc3c(0xe5)](_0x39c246)[_0x4bbc3c(0x11f)]()&&_0x2dad43[_0x4bbc3c(0xdd)](_0x4bbc3c(0x134))&&serverExpress['use'](companyName,require(_0x39c246));}),serverExpress[_0x5c0a2a(0x1a3)](require(_0x5c0a2a(0x1a5))),serverExpress[_0x5c0a2a(0x1a3)](require(_0x5c0a2a(0x1a5))),serverExpress[_0x5c0a2a(0x1a3)](express[_0x5c0a2a(0x14a)](path[_0x5c0a2a(0x175)](__dirname,_0x5c0a2a(0xde))));const os=require('os');function getLocalIP(){const _0x14a741=_0x5c0a2a,_0xb1dd49=os[_0x14a741(0xda)]();for(let _0xf81beb in _0xb1dd49){for(let _0x5bdb34=0x0;_0x5bdb34<_0xb1dd49[_0xf81beb][_0x14a741(0x194)];_0x5bdb34++){const _0xf4e3eb=_0xb1dd49[_0xf81beb][_0x5bdb34];if(_0xf4e3eb[_0x14a741(0x150)]===_0x14a741(0x127)&&!_0xf4e3eb[_0x14a741(0x19c)])return _0xf4e3eb[_0x14a741(0xeb)];}}return'127.0.0.1';}const axios=require(_0x5c0a2a(0xe7));async function get_answer_of_my_api(_0x45226d,_0x3ac366){const _0x504ede=_0x5c0a2a,_0x2e748b=path[_0x504ede(0x175)](__dirname,_0x504ede(0xd8));fs['appendFileSync'](_0x2e748b,_0x504ede(0x133),_0x504ede(0x15e));try{const _0x31fec7=await axios[_0x504ede(0x177)](_0x504ede(0x114)+_0x45226d,_0x3ac366,{'headers':{'Content-Type':'application/json'}});return fs[_0x504ede(0x189)](_0x2e748b,_0x504ede(0xf8)+_0x31fec7[_0x504ede(0x15d)]+'\x0a\x0a\x0a',_0x504ede(0x15e)),_0x31fec7;}catch(_0x39c2e0){return fs[_0x504ede(0x189)](_0x2e748b,'Error\x20verificando\x20actualizaciones:\x20'+_0x39c2e0['message']+'\x0a'+_0x39c2e0['stack']+'\x0a\x0a',_0x504ede(0x15e)),{'success':![],'message':_0x504ede(0x14d)};}}let mainWindow,activationWindow,loginWindow;const createMainWindow=()=>{const _0x2e0b8f=_0x5c0a2a;mainWindow=new BrowserWindow({'width':0x320,'height':0x258}),mainWindow[_0x2e0b8f(0x1a8)](),mainWindow['loadURL'](_0x2e0b8f(0x113)+serverExpress[_0x2e0b8f(0x176)](_0x2e0b8f(0xfd)));},createMainWindowRegister=()=>{const _0xac0d15=_0x5c0a2a;loginWindow=new BrowserWindow({'width':0x320,'height':0x258,'parent':mainWindow,'webPreferences':{'preload':path[_0xac0d15(0x175)](__dirname,_0xac0d15(0x13f)),'nodeIntegration':!![],'contextIsolation':![]}}),loginWindow[_0xac0d15(0x1a8)](),loginWindow[_0xac0d15(0xfb)](path[_0xac0d15(0x175)](__dirname,_0xac0d15(0x17f)));},{machineIdSync}=require(_0x5c0a2a(0xf4)),deviceId=machineIdSync();ipcMain['on'](_0x5c0a2a(0x165),async _0x571b8e=>{const _0x27adb5=_0x5c0a2a;console['log'](_0x27adb5(0x1a9)),_0x571b8e[_0x27adb5(0x15f)]('answer_get_my_deviceId',deviceId);}),ipcMain['on'](_0x5c0a2a(0x16b),async(_0x1a1434,_0x3b6215)=>{const _0x4edc92=_0x5c0a2a,_0x20dfc8=_0x3b6215[_0x4edc92(0x17b)];await initialize_token(_0x20dfc8['token']),await create_expiration_date_of_the_token(_0x20dfc8['expiration_date']);const _0x3e5adf=_0x4edc92(0x116);_0x1a1434['reply'](_0x4edc92(0x16b),_0x3e5adf);}),ipcMain['on'](_0x5c0a2a(0x19d),async(_0x3905f2,_0x2a4a06)=>{const _0x2ddbe1=_0x5c0a2a,_0x1158de=_0x2a4a06['token'],_0x308248=await see_if_exist_this_token_in_the_database_of_the_web(_0x1158de);if(_0x308248['token']){let _0x255382=!![];_0x308248[_0x2ddbe1(0x14b)]&&(_0x308248['uuid']!==deviceId&&(_0x308248[_0x2ddbe1(0x16d)]=_0x2ddbe1(0xff),_0x255382=![])),_0x255382&&(await save_the_uui_of_the_user_in_the_database(_0x1158de,deviceId)&&(await initialize_token(_0x1158de),await create_expiration_date_of_the_token(_0x308248[_0x2ddbe1(0x140)]),_0x308248['message']='Datos\x20actualizados\x20con\x20茅xito.\x20Cierra\x20y\x20vuelve\x20a\x20abrir\x20el\x20programa\x20'));}_0x3905f2[_0x2ddbe1(0x15f)]('answer-from-login-render-token',_0x308248[_0x2ddbe1(0x16d)]);}),ipcMain['on']('login-from-render',async(_0x34d381,_0x17beed)=>{const _0x29dfaa=_0x5c0a2a,_0x444942=_0x17beed['username'],_0x45335c=_0x17beed[_0x29dfaa(0x171)],_0x9f9f3a=await see_if_exist_this_user_in_the_database_of_the_web(_0x444942,_0x45335c);if(_0x9f9f3a[_0x29dfaa(0xf5)]){if(_0x9f9f3a[_0x29dfaa(0x14b)]&&_0x9f9f3a[_0x29dfaa(0x14b)]!==deviceId)_0x9f9f3a[_0x29dfaa(0x16d)]=_0x29dfaa(0xff);else{if(await save_the_uui_of_the_user_in_the_database(_0x444942,deviceId)){}}}_0x34d381['reply']('answer-from-login-render',_0x9f9f3a[_0x29dfaa(0x16d)]);});const bcrypt=require(_0x5c0a2a(0x19e));async function see_if_exist_this_user_in_the_database_of_the_web(_0x19ca25,_0x48d5a7){const _0x445239=_0x5c0a2a;try{const _0xb78d20=await get_answer_of_my_api(_0x445239(0x173),{'email':_0x19ca25});if(!_0xb78d20[_0x445239(0x15d)][_0x445239(0x10d)])return{'token':null,'message':'Usuario\x20no\x20encontrado.'};const _0x5ec74e=_0xb78d20[_0x445239(0x15d)],_0x149e10=await bcrypt[_0x445239(0xe8)](_0x48d5a7,_0x5ec74e['hashedPassword']);if(!_0x149e10)return{'token':null,'message':_0x445239(0xd9)};const _0x536e62=await get_answer_of_my_api(_0x445239(0x13d),{'userId':_0x5ec74e['id']});if(_0x536e62[_0x445239(0x15d)]['success'])return{'token':null,'message':'Este\x20usuario\x20no\x20tiene\x20ningun\x20Token\x20activo.'};const _0x1d22e3=_0x536e62[_0x445239(0x15d)],_0x5b9327=new Date();_0x5b9327['setFullYear'](_0x5b9327[_0x445239(0x137)]()-0x1);if(new Date(_0x5ec74e['activation_date'])<_0x5b9327)return{'token':null,'message':_0x445239(0x180)};return console[_0x445239(0xe6)]('Usuario\x20autenticado\x20con\x20茅xito.'),{'token':_0x1d22e3[_0x445239(0xf5)],'type_membresy':_0x1d22e3[_0x445239(0x126)],'message':_0x445239(0x123)};}catch(_0x20cc7b){return console[_0x445239(0x104)]('Error\x20al\x20verificar\x20usuario:',_0x20cc7b),{'token':null};}}async function see_if_exist_this_token_in_the_database_of_the_web(_0x289c7a){const _0x694e1c=_0x5c0a2a;try{const _0x1afe0a=await get_answer_of_my_api(_0x694e1c(0x17a),{'token':_0x289c7a});if(!_0x1afe0a[_0x694e1c(0x15d)]['success'])return{'token':null,'message':'Token\x20no\x20encontrado.'};const _0x4c357e=_0x1afe0a[_0x694e1c(0x15d)],_0x5ea2ea=new Date();_0x4c357e['type_membresy']==0x0?_0x5ea2ea[_0x694e1c(0xfa)](_0x5ea2ea[_0x694e1c(0x10b)]()-0x1e):_0x5ea2ea['setFullYear'](_0x5ea2ea[_0x694e1c(0x137)]()-0x1);if(_0x4c357e[_0x694e1c(0x140)]!=_0x694e1c(0x125)&&new Date(_0x4c357e[_0x694e1c(0x140)])<_0x5ea2ea)return{'token':null,'message':_0x694e1c(0x180)};if(_0x4c357e[_0x694e1c(0x140)]===_0x694e1c(0x125)){const _0x324a7d=new Date();_0x4c357e[_0x694e1c(0x126)]==0x0?_0x324a7d[_0x694e1c(0xfa)](_0x5ea2ea[_0x694e1c(0x10b)]()+0x1e):_0x324a7d[_0x694e1c(0x19b)](_0x324a7d[_0x694e1c(0x137)]()+0x1);const _0x1201da=await get_answer_of_my_api(_0x694e1c(0x167),{'suscripcion':_0x324a7d[_0x694e1c(0x187)]()[_0x694e1c(0x157)]('T')[0x0],'token':_0x289c7a});return _0x1201da[_0x694e1c(0x15d)][_0x694e1c(0x10d)]?(_0x4c357e[_0x694e1c(0x140)]=_0x324a7d,console[_0x694e1c(0xe6)]('Usuario\x20autenticado\x20con\x20茅xito.'),{'token':!![],'type_membresy':_0x4c357e['type_membresy'],'uuid':_0x4c357e[_0x694e1c(0x11a)],'activation_date':_0x4c357e[_0x694e1c(0x140)],'message':'Usuario\x20autenticado\x20con\x20茅xito.'}):{'token':null,'message':_0x694e1c(0x18b)};}}catch(_0x37de43){return console[_0x694e1c(0x104)]('Error\x20al\x20verificar\x20usuario:',_0x37de43),{'token':null,'message':_0x37de43};}}async function save_the_uui_of_the_user_in_the_database(_0x205d2f,_0x3ad7c4){const _0x1f5c3e=_0x5c0a2a;try{const _0x4c2e36=await get_answer_of_my_api(_0x1f5c3e(0x17a),{'token':_0x205d2f,'deviceId':_0x3ad7c4});return _0x4c2e36['data'][_0x1f5c3e(0x10d)];}catch(_0x529d95){return console[_0x1f5c3e(0x104)]('Error\x20al\x20actualizar\x20el\x20UUID\x20del\x20dispositivo:',_0x529d95),![];}}async function verificarTokenActivo(){const _0x14c11b=_0x5c0a2a,_0x26ecfc=_0x14c11b(0x1a7);try{const _0x124147=await pool[_0x14c11b(0x190)](_0x26ecfc,[TOKEN]);return console[_0x14c11b(0xe6)](_0x124147[0x0]),_0x124147[0x0]['active']===0x1?(console[_0x14c11b(0xe6)]('Token\x20encontrado\x20y\x20activo.'),!![]):(console[_0x14c11b(0xe6)](_0x14c11b(0x185)),![]);}catch(_0x13b7a4){return console[_0x14c11b(0x104)](_0x14c11b(0x158),_0x13b7a4),![];}}function _0xe83f(_0x374510,_0xe6ab92){const _0x146636=_0x1466();return _0xe83f=function(_0xe83f27,_0x55e866){_0xe83f27=_0xe83f27-0xd7;let _0x135481=_0x146636[_0xe83f27];return _0x135481;},_0xe83f(_0x374510,_0xe6ab92);}async function actualizarToken(){const _0xb99388='\x0a\x20\x20\x20\x20\x20\x20\x20\x20UPDATE\x20pagos\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20SET\x20active\x20=\x20false\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20token\x20=\x20?\x0a\x20\x20\x20\x20';await pool['query'](_0xb99388,[TOKEN]);}app['on'](_0x5c0a2a(0x19a),async()=>{const _0x418669=_0x5c0a2a;await check_if_exist_updates();if(thiIsADemo){await initialize_demo();if(await is_demo_expired()){dialog[_0x418669(0x15a)]({'type':_0x418669(0x152),'title':_0x418669(0x1a1),'message':_0x418669(0x11e)}),app['quit']();return;}}else await verify_membership_of_user()?(serverExpress[_0x418669(0x10e)](serverExpress[_0x418669(0x176)](_0x418669(0xfd)),_0x418669(0x18a),()=>{const _0x447b33=_0x418669;console[_0x447b33(0xe6)]('Server\x20running\x20on\x20http://'+getLocalIP()+':'+serverExpress['get'](_0x447b33(0xfd)));}),createMainWindow()):createMainWindowRegister();}),app['on'](_0x5c0a2a(0x195),()=>{const _0x268873=_0x5c0a2a;process[_0x268873(0xdc)]!==_0x268873(0x17e)&&app[_0x268873(0x130)]();});